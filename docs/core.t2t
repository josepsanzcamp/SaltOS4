Main Documentation
SaltOS 4.0 r1923
March 2025



+Actions+

++Add log action++

```
api/php/action/add.php
```

This file implements the addlog action, requires a POST JSON request
with an element in the json that contains the message to be added

- @msg => message that you want to add to the log file


Add error action

This file implements the adderror action, requires a POST JSON request
with the follow elements: jserror, details and backtrace, this action
is called from window.onerror in order to store the details of the js
error

- @jserror   => text used as title in the error report
- @details   => text used as details in the error report
- @backtrace => array with the backtrace used in the error report


++Application action++

```
api/php/action/app.php
```

This file implements the app action, requires a GET REST request
and the order of the elements are:

- @1 => the app that you want to execute
- @2 => the action that tou want to use, if the app only contains
      one action, this parameter is not necesary
- @3 => the id used in some actions, for example, to get the data
      of specific customer using the id


List action (triggered when type attr is table or list)

This action tries to facility the creation of lists with the tipicals
features suck as rows, actions for each row, and other improvements as
the list with count and without count.

TODO: pending to add the order by from the list header


++Authentication helper module++

```
api/php/action/auth.php
```

This file contains all needed code to do authentications with all features suck as the
main authentication using a user and password pair, the checktoken and the deauthtoken
to control it.


++Garbage Collector action++

```
api/php/action/cron.php
```

This action executes the gc_exec function in the gc.php library, the execution
of this accion only is allowed from the command line


++Garbage Collector action++

```
api/php/action/gc.php
```

This action executes the gc_exec function in the gc.php library, the execution
of this accion only is allowed from the command line


++BarCode action++

```
api/php/action/image.php
```

This action allow to generate a barcode, you can pass the desired
message that you want to convert in barcode

- @msg    => the msg that you want to codify in the qrcode
- @format => the format used to the result, only can be png or json


- @w => width of each unit's bar of the barcode
- @h => height of the barcode (without margins and text footer)
- @m => margin of the barcode (white area that surround the barcode)
- @s => size of the footer text, not used if zero
- @t => type of the barcode, C128 is the most common type used


QRCode action

This action allow to generate a qrcode with the SaltOS logo embedded
in the center of the image, you can pass the desired message that you
want to convert in qrcode.

- @msg    => the msg that you want to codify in the qrcode
- @format => the format used to the result, only can be png or json


- @s => size of each pixel used in the qrcode
- @m => margin of the qrcode (white area that that surround the qrcode)
- @l => level error correction: L (low), M (medium), Q (better), H (best)


Captcha action

This action allo to retrieve the captcha of a randomly number or math
operation, used to prevent massive requests, can perform the action of
create the captcha image and return the result as a simple image or as
a json image

- @type   => the type used to the result, only can be number or math
- @format => the format used to the result, only can be png or json


- @width     => the width of the generated image
- @height    => the height of the generated image
- @letter    => the size of the letters of the generated image
- @number    => the size of the numbers of the generated image
- @angle     => the angle allowed to rotate the letters and numbers
- @color     => the color user to paint the code
- @bgcolor   => the background color of the image
- @fgcolor   => the color used to paint the letters of the background of the image
- @period    => parameter for the wave transformation
- @amplitude => parameter for the wave transformation
- @blur      => true or false to enable or disable the blur effect


Score action

This action allo to retrieve the score of a password, intended to be used
as helper previously to the authupdate call, can perform the action of
compute the score and return the result as a simple image or as a json
image

- @pass   => the password that you want to compute the score
- @format => the format used to the result, only can be png or json


- @width  => the width of the generated image
- @height => the height of the generated image
- @size   => the size of the font of the generated image


++Make indexing action++

```
api/php/action/indexing.php
```

This fie contains useful functions related to the indexing action that internally uses the
mroonga engine to search in the fulltext string generated by this action


++Make indexing action++

```
api/php/action/integrity.php
```

This fie contains useful functions related to the indexing action that internally uses the
mroonga engine to search in the fulltext string generated by this action


++Ping action++

```
api/php/action/ping.php
```

This file implements the ping action, intended to be used by the check_network
feature from the web app that expects this specific output


++Garbage Collector action++

```
api/php/action/push.php
```

This action executes the gc_exec function in the gc.php library, the execution
of this accion only is allowed from the command line


++DB Schema action++

```
api/php/action/setup.php
```

This action executes the db_schema and db_static functions in the dbschema.php
library, the execution of this accion only is allowed from the command line


++Add files action++

```
api/php/action/upload.php
```

This file implements the delete files action, requires a POST JSON request
with an array of files, and each array must contain the follow entries:
id, name, size, type, data, error, file, hash

This action checks that not error is found, get the data and clear the
data element of the array, check the prefix of the data using the type,
check the size of the data, and then, set the file and hash to the
array and store the file in the upload directory

This action checks that not error is found, checks the file element, the
size of the file, the hash of the file, and then, remove the file and
clear the file and hash element of the array

- @file  => array that contains the follow elements:
- @id    => unique id that is used by the client to identify the response
- @app   => the hash, used to know the app from where the file is uploaded
- @name  => the name of the file
- @size  => the size of the file
- @type  => the type of the file
- @data  => the contents of the file encoded as inline base64
- @error => the error in case of errors
- @file  => this field is used here to put the local filename used in the file
- @hash  => this field contains the hash of the contents of the file


+Autoload+

++Apps helper module++

```
api/php/autoload/apps.php
```

This file contains functions intended to be used as hepers of other functions, allowing to convert
between formats as the name of the app to and app id, or viceversa


+++Apps helper function+++

```
function __apps($fn, $arg)
```

This function is used by the XXX2YYY functions as helper, it stores the
dictionary of all conversions and resolves the data using it

- @fn  => the caller function
- @arg => the argument passed to the function


+++Subtables helper+++

```
function __apps_subtables_helper($subtables)
```

This function helps the follow apps to returns the subtables information into
a structure instead of string, this is very helpfull by the code that consumes
this information, allow to use it quickly without parsing the original string.

- @subtables => the string that contains the subtables specification


+++Id to App+++

```
function id2app($id)
```

This function resolves the code of the app from the app id

- @id => the app id used to resolve the code


+++App to Id+++

```
function app2id($app)
```

This function resolves the id of the app from the app code

- @app => the code used to resolve the id


+++Id to Table+++

```
function id2table($id)
```

This function resolves the table of the app from the app id

- @id => the app id used to resolve the table


+++App to Table+++

```
function app2table($app)
```

This function resolves the table of the app from the app code

- @app => the app code used to resolve the table


+++Table to Id+++

```
function table2id($table)
```

This function resolves the id of the app from the app table

- @table => the app table used to resolve the id


+++Table to App+++

```
function table2app($table)
```

This function resolves the code of the app from the app table

- @table => the app table used to resolve the app code


+++Id to Subtables+++

```
function id2subtables($id)
```

This function resolves the subtables of the app from the app id

- @id => the app id used to resolve the subtables


+++App to Subtables+++

```
function app2subtables($app)
```

This function resolves the subtables of the app from the app code

- @app => the app code used to resolve the subtables


+++Table to Subtables+++

```
function table2subtables($table)
```

This function resolves the subtables of the app from the app table

- @table => the app table used to resolve the subtables


+++App Exists+++

```
function app_exists($app)
```

This function detect if an app exists

- @app => the app that you want to check if exists


+++App to Index+++

```
function app2index($app)
```

This function returns the has_index of the app

- @app => the app code used to resolve the index


+++App to Control+++

```
function app2control($app)
```

This function returns the has_control of the app

- @app => the app code used to resolve the control


+++App to Version+++

```
function app2version($app)
```

This function returns the has_version of the app

- @app => the app code used to resolve the version


+++App to Files+++

```
function app2files($app)
```

This function returns the has_files of the app

- @app => the app code used to resolve the files


+++App to Notes+++

```
function app2notes($app)
```

This function returns the has_notes of the app

- @app => the app code used to resolve the notes


+++App to Log+++

```
function app2log($app)
```

This function returns the has_log of the app

- @app => the app code used to resolve the log


+++Subtable to Id+++

```
function subtable2id($subtable)
```

This function resolves the id of the app from the subtable

- @subtable => the app subtable used to resolve the id


+++Subtable to App+++

```
function subtable2app($subtable)
```

This function resolves the code of the app from the app subtable

- @subtable => the app subtable used to resolve the app code


+++Subtable to table+++

```
function subtable2table($subtable)
```

This function resolves the table of the app from the app subtable

- @subtable => the app subtable used to resolve the table


+++Table Exists+++

```
function table_exists($table)
```

This function detect if a table exists

- @table => the table that you want to check if exists


+++Subtable Exists+++

```
function subtable_exists($subtable)
```

This function detect if a subtable exists

- @subtable => the subtable that you want to check if exists


+++Id to Field+++

```
function id2field($id)
```

This function resolves the field of the app from the app id

- @id => the app id used to resolve the field


+++App to Field+++

```
function app2field($app)
```

This function resolves the field of the app from the app code

- @app => the app code used to resolve the field


+++Table to Field+++

```
function table2field($table)
```

This function resolves the field of the app from the app table

- @table => the app table used to resolve the field


+++Id to Name+++

```
function id2name($id)
```

This function resolves the name of the app from the app id

- @id => the app id used to resolve the name


+++App to Name+++

```
function app2name($app)
```

This function resolves the name of the app from the app code

- @app => the app code used to resolve the name


+++Table to Name+++

```
function table2name($table)
```

This function resolves the name of the app from the app table

- @table => the app table used to resolve the name


+++Detect apps files+++

```
function detect_apps_files($file)
```

This function returns the files found in the main path and in the apps path

- @file => the pattern used to search files


+++Current app+++

```
function current_app()
```

This function returns the current app as string


+++Detect app file+++

```
function detect_app_file($app)
```

This function returns the path found for the requested app

- @app => the app that wants to retrieve the file path


Notes:

If the app uses the yaml specification instead of the xml, this
function call the make_app_file_helper function with the yaml file
to get the xml file that must to be used in the app layer


+++Detect app folder+++

```
function detect_app_folder($app)
```

This function returns the path found for the requested app

- @app => the app that wants to retrieve the folder path


+++Make Apps File helper+++

```
function make_app_file_helper($yamlfile)
```

function call the make_app_file function defined in the required
field of the yaml file to generate the equivalent xml file used
as app file and returns the path to the cached file

- @yamlfile => the yaml file desired to be converted to xml


++Array helper module++

```
api/php/autoload/array.php
```

This file contain useful array functions, too we have added some features
that historically appear in the import module, they allow to modify arrays
using xpath notation, apply filters and patchs or simply, manipulate the
data stored in an array of the form row/rows.


+++Null to array converter+++

```
function array_protected($x)
```

This function convert all nulls into an array, is intended to be
used as helper for example in the glob output, to force to have
an array in all cases

- @arr => the input, generally must to be an array, if a null is passed,
        then a void array will be returned


+++Join attr value+++

```
function join_attr_value($array)
```

This function allow to join the #attr and value to get only an associative
array, it is intended to be used to simplify the specification of some elements
and to simplify the usage of this elements in the client side

- @array => the input that can contains an array with #attr and value


+++Get Node helper+++

```
function __array_getnode($path, $array)
```

This function is a helper used to get a node in a xml structure

- @path  => a path of the desired node
- @array => the array with nodes of the xml structure


Returns the contents of the node of the specified path


+++Get Value helper+++

```
function __array_getvalue($array)
```

This function is a helper used to get a value if exists of a node structure

- @array => an array


Retusn the value if exists, otherwise the same input


+++Get Attr helper+++

```
function __array_getattr($elem, $array)
```

This function is a helper used to get a attr element if exists of a node structure

- @elem  => a string representing an element
- @array => an array containing the node


Returns the attr if exists, otherwise null


+++Add Node helper+++

```
function __array_addnode($path, &$array, $value)
```

This function is used to add data into a xml structure

- @path  => the desired path where do you want to add the data
- @array => the array with the xml structure
- @value => the value that do you want to add


true if the function can add the data, false otherwise


+++Set Node helper+++

```
function __array_setnode($path, &$array, $value)
```

This function is used to set data into a xml structure

- @path  => the desired path where do you want to put the data,
- @array => the array with the xml structure
- @value => the value that do you want to put


Returns true if the function can set the value, false otherwise


+++Del Node helper+++

```
function __array_delnode($path, &$array)
```

This function is used to remove data of the xml structure

- @path  => the desired path where do you want to remove
- @array => the array with the xml structure


Returns true if the function can remove the path, false otherwise


+++Filter helper+++

```
function __array_filter($array, $filter, $eval = false)
```

This function tries to apply a filter to a tree array, too allow to use
the evaluation system to allow to pass as filter an expression like this
A=M23

- @array  => the tree array that you want to apply the filter
- @filter => the filter to apply
- @eval   => set to true if you want to enable the eval feature


+++Filter Recursive helper+++

```
function __array_filter_rec($node, $filter, $eval, $parent = [])
```

This function is a helper of the previous function and is able to to the
same but with recursivity

- @node   => the tree node that you want to filter
- @filter => the filter to apply
- @eval   => set to 1 if you want to enable the eval feature
- @parent => this parameter is intended to be used internaly by the function


+++Apply Patch+++

```
function __array_apply_patch(&$array, $key, $val)
```

This function is able to apply a patch in the tree array, this allow to
update the desired branch of the tree using a xpath notation

- @array => the array that you want to apply the patch
- @key   => the xpath where you want to apply the patch
- @val   => the val that you want to put in the desired xpath


+++Apply Patch Recursive helper+++

```
function __array_apply_patch_rec(&$array, $key, $val)
```

This function is a helper of the previous function and is able to to the
same but with recursivity

- @array => the array that you want to apply the patch
- @key   => the xpath where you want to apply the patch
- @val   => the val that you want to put in the desired xpath


+++Is attr value+++

```
function is_attr_value($array)
```

This function return true if the data argument is an array with #attr and value

- @array => the array that wants to check


+++Arrays to array+++

```
function arrays2array()
```

This function internally implements the old xml_join feature that allow to merge
multiple files into one using the fix_key of the keys in the first level as key
to join.

$args => This function process dynamically all arguments

Notes:
- This function is derived from the xmlfiles2array that get all files and process
  the contents to join with a certain logics
- In a commit, this function become to be the main joining function and xmlfiles2array
  uses it to do the real job


+++Xpath search array+++

```
function xpath_search_array($xpath, $array)
```

This function is intended to do searches using the xpath notation
like list[id=table]/actions, the main idea is that this function can
returns an array with all occurrences because the same xpath can choose
more that one result

- @xpath => the string containing the search xpath
- @array => the array that contains the search data


+++Xpath search first+++

```
function xpath_search_first($xpath, $array)
```

This function is intended to returns the first result
of the array returned by the xpath_search_first function

- @xpath => the string containing the search xpath
- @array => the array that contains the search data


Notes:

In case of not occurrences, null is returned


+++Xpath search first+++

```
function xpath_search_first_value($xpath, $array)
```

This function is intended to returns the value of the first
result obtained from the xpath_search_first function

- @xpath => the string containing the search xpath
- @array => the array that contains the search data


Notes:

In case of not occurrences, null is returned


+++Array transpose+++

```
function array_transpose($input)
```

This function returns a transposed array, intended to be used
when needs an array of cols instead of rows, for example, ideal
to be used in the excel widget

The expected output must to be the same input array but swaping
the first and second indeces level, in other words, this function
is able to convert arrays from A*B to B*A dimensions

- @input => the input array


+++Array lowercase+++

```
function array_lowercase($array)
```

This function do the same that strtolower but apply it to all array values

- @array => the array that you want to convert to lower case


+++Array key lowercase+++

```
function array_key_lowercase($array)
```

This function do the same that the array_lowercase but only apply to all
keys of the array

- @array => the array that you want to convert to lower case


+++Array key search+++

```
function array_key_search($needed, $array)
```

This function allow to search keys in the array using a case insensitive search

- @needed => the desired key used in the case insensitive search
- @array  => the array where do you want to found the key


Notes:

In case of not found the desired key, the original needed param is returned


+++Explode With Quotes+++

```
function explode_with_quotes($separator, $str, $limit = 0)
```

This function tries to do the same things that the original explode but add
the quotes feature, don't break an string contained in a single or double
quotes, this allow to implement features like a search that forces specific
strings with spaces

- @separator => the delimiter character used in the explode feature
- @str       => the string that you want to explode
- @limit     => the number of elements that can contains the result


+++Grep helper+++

```
function array_grep($input, $pattern, $invert = false)
```

This function emulates the grep command, is able to invert the pattern
selection and returns the same array with the grep applied, tries to do
the grep ignoring case and ignoring extended chars and is able to search
words ignoring accents

- @input   => the input array
- @pattern => the search pattern
- @invert  => default to false to search, true to invert the selection


++Compatibility helper module++

```
api/php/autoload/compat.php
```

This file add some functions used by SaltOS that can not be found in all allowed versions of PHP


+++Array Key Last+++

```
function array_key_last(array $array)
```

This function appear in PHP 7.3, and for previous version SaltOS
uses this code

- @array => the array where you want to obtain the last key


Notes:

Code copied from the follow web:
https://www.php.net/manual/es/function.array-key-last.php#124007


+++Array Key First+++

```
function array_key_first(array $arr)
```

This function appear in PHP 7.3, and for previous version SaltOS
uses this code

- @array => the array where you want to obtain the first key


Notes:

Code copied from the follow web:
https://www.php.net/manual/es/function.array-key-last.php#124007


++Config helper module++

```
api/php/autoload/config.php
```

This fie contains useful functions related to configuration features


+++Get config+++

```
function get_config($key, $user_id = -1)
```

This function is intended to be used to retrieve values from the config
system, as first level, the function try to get the value from the
tbl_config, and if it is not found, then the function try to get the
values from the config file.

- @key     => the key that you want to retrieve the value
- @user_id => the user_id used in the first search step


Notes:

This function is a new release of the olds getConfig and getDefault,
depending of the user_id argument, it tries to search in the config file or
in the database, for negative values the function uses the config file and
for zero or positive values, tries to search it in the database

To prevent errors in case of duplicates, we are using the ORDER BY id ASC
LIMIT 1, this allow to get and set only the first register found by the
select query


+++Set config+++

```
function set_config($key, $val, $user_id = -1)
```

This function sets a value to a config key, the data will be stored in the
database using the tbl_config for zero or positive values of user_id, and
in the memory of the config file for negative user_id values

- @key     => the key that you want to set
- @val     => the value that you want to set
- @user_id => the user_id used as filter


Notes:

If null val is passed as argument, then the entry of the config or database
is removed, the main idea is to use the same method used by the setcookie
that allow to remove entries by setting the value to null

To prevent errors in case of duplicates, we are using the ORDER BY id ASC
LIMIT 1, this allow to get and set only the first register found by the
select query


+++Detect config files+++

```
function detect_config_files($file)
```

This function returns the files found in the main path, in the apps path and in the files path

- @file => the pattern used to search files


+++Get config array+++

```
function get_config_array($prefix, $user_id)
```

This function is intended to retrieve the configuration associated to an user
using a prefix for all keys.

- @prefix  => the prefix used in the keys of the config
- @user_id => the user_id used in the search query


+++Prepare Config Files+++

```
function prepare_config_files($array)
```

This function tries to join all config files into one unique structure, to do it
joins nodes with the same key, for example, you can use the data/files/config.xml
file to set the specific database configuration and overwrite the db/pdo_mysql or
the db/type, the main idea is to replace the nodes of the second level because the
arrays2array function join previously the differents files into one structure usin
the first level to do the join, and only adds the repeated overload without take
decisions about overwrite the contents like this function do

- @array => the main array that you want to prepare as config array


++Database helper module++

```
api/php/autoload/database.php
```

This fie contains useful functions related to database, allow to connect, check queries, execute
queries, disconnect, retrieve rows and manipulate resultsets of the database


+++DB Connect+++

```
function db_connect($args = null)
```

This function is intended to stablish the connection to the database

- @args => is an array with key val pairs
- @host => the host for the connection
- @port => the port used for the connection
- @name => name of the database for the connection
- @user => user used to stablish the connection
- @pass => pass used to stablish the connection
- @file => the file that contains the database


Notes:

The parameters can be different depending of each database driver, in general the arguments can
be the host, port, name, user and pass for database's servers and only file for the sqlite database

If the args argument is null, the the function try to use the configuration stored in the config file
and depending of the argument presense, it will return the database object or store it in the config
to be used by the nexts functions of this php file


+++DB Check+++

```
function db_check($query, $params = [])
```

This function is intended to check that the query execution will not trigger an error

- @query => the query that you want to validate


+++DB Escape+++

```
function db_escape($str)
```

This function is intended to escape the special chars to sanitize the string to be used
in a sql query

- @str => the string that you want to sanitize


+++DB Query+++

```
function db_query($query, ...$args)
```

This public function is intended to execute the query and returns the resultset

- @query => the query that you want to execute
- @fetch => the type of fetch that you want to use, can be auto, query, column or concat


Notes:

The fetch argument can perform an speed up in the execution of the retrieve action, and
can modify how the result is returned

auto: this fetch method try to detect if the resultset contains one or more columns, and
sets the fetch to column (if the resultset only contains one column) or to query (otherwise)

query: this fetch method returns all resultset as an array of rows, and each row contain the
pair of key val with the name of the field and the value of the field

column: this fetch method returns an array where each element is each value of the field of
the each row, this is useful when for example do you want to get all ids of a query, with
this method you can obtain an array with each value of the array is an id of the resultset

concat: this fetch method is an special mode intended to speed up the retrieve of large
arrays, this is useful when you want to get all ids of a query and you want to get a big
sized array, in this case, is more efficient to get an string separated by commas with all
ids instead of an array where each element is an id


+++DB Fetch Row+++

```
function db_fetch_row(&$result)
```

This function returns the next row of the resultset queue

- @result => this argument is passed by reference and contains the resultset queue
           obtained by the db_query


+++DB Fetch All+++

```
function db_fetch_all(&$result)
```

This function returns all rows of the resultset queue

- @result => this argument is passed by reference and contains the resultset queue
           obtained by the db_query


+++DB Num Rows+++

```
function db_num_rows($result)
```

This function returns the total number of the results in the resultset queue

- @result => this argument is passed by reference and contains the resultset queue
           obtained by the db_query


+++DB Num Fields+++

```
function db_num_fields($result)
```

This function returns the number of fields of the resultset queue

- @result => this argument is passed by reference and contains the resultset queue
           obtained by the db_query


+++DB Field Name+++

```
function db_field_name($result, $index)
```

This function returns the name of the field identified by the index field

- @result => this argument is passed by reference and contains the resultset queue
           obtained by the db_query


+++DB Last Insert ID+++

```
function db_last_insert_id()
```

This function returns the last insert id


+++DB Free+++

```
function db_free(&$result)
```

This function releases all memory used by the resultset queue

- @result => this argument is passed by reference and contains the resultset queue
           obtained by the db_query


+++DB Disconnect+++

```
function db_disconnect()
```

This function close the database connection and sets the link to null


++Datetime helper module++

```
api/php/autoload/datetime.php
```

This fie contains useful functions related to datetime, allow to get current timestamp in various
formats, allow to evaluate timestamps and some helper more


+++Current Date+++

```
function current_date($offset = 0)
```

This function returns the current date in a YYYY-MM-DD format, this is used
by a lot of functions in SaltOS, allow to specify a bias used to move the
current time mark

- @offset => the bias added to the current time mark


+++Current Time+++

```
function current_time($offset = 0)
```

This function returns the current time in a HH:II:SS format, this is used
by a lot of functions in SaltOS, allow to specify a bias used to move the
current time mark

- @offset => the bias added to the current time mark


+++Current DateTime+++

```
function current_datetime($offset = 0)
```

This function returns the current date and time in a YYYY-MM-SS HH:II:SS format,
this is used by a lot of functions in SaltOS, allow to specify a bias used to
move the current time mark

- @offset => the bias added to the current time mark


+++Current Decimals+++

```
function current_decimals($offset = 0, $size = 4)
```

This function returns the current decimals to be added to the seconds as a
decimal part, this function uses the microtime function to get this level of
precision that can not be obtained using the original date and time functions

- @offset => the bias added to the current time mark
- @size   => the size of the returned decimal part


Notes:

This function is used by current_datetime_decimals, and don't have more uses
that provice more precision in the logs files


+++Current DateTime Decimals+++

```
function current_datetime_decimals($offset = 0, $size = 4)
```

This function returns the current date and time with decimals in the seconds
in a YYYY-MM-DD HH:II:SS.XXXX format, useful when do you want to log information
more accuracy to debug issues, for example

- @offset => the bias added to the current time mark
- @size   => the size used by the decimal part


+++Dateval+++

```
function dateval($value)
```

This function try to do the same thing that intval or strval, but for date
values, to do this, this function try to separate all elements and identify
the year position and the other elements, the result will be of the format
YYYY-MM-DD

- @value => the input value to validate


Notes:

This function try to cast the year, month and day from 0000-00-00 to valid
values, this is because the databases accepts the 0000-00-00 date and is used
as emulated null, the month are limited to 12 and the day is limited to the
days of the month and year, this is useful because the dates that are more
greather that zero, will have a valid and an existing value


+++Day of a Month helper+++

```
function __days_of_a_month($year, $month)
```

This function is a helper used by other date and datetime functions, this
is useful because allow to fix problems in dates that use days out of range

- @year  => year that you want to use in the validation
- @month => month that you want to use in the validation


+++Timeval+++

```
function timeval($value)
```

This function try to do the same thing that intval or strval, but for time
values, to do this, this function try to separate all elements and identify
the elements, the result will be of the format HH:II:SS

- @value => the input value to validate


+++Datetimeval+++

```
function datetimeval($value)
```

This function try to do the same thing that intval or strval, but for datetime
values, to do this, this function try to separate all elements and identify
the year position and the other elements, the result will be of the format
YYYY-MM-DD HH:II:SS

- @value => the input value to validate


Notes:

This function try to cast the year, month and day from 0000-00-00 to valid
values, this is because the databases accepts the 0000-00-00 date and is used
as emulated null, the month are limited to 12 and the day is limited to the
days of the month and year, this is useful because the dates that are more
greather that zero, will have a valid and an existing value


+++Time to Seconds+++

```
function __time2secs($time)
```

This function converts the time format into seconds

- @time => time to be converted into seconds, the format will be HH:II:SS


+++Seconds to Time+++

```
function __secs2time($secs)
```

This function converts the seconds into time format

- @secs => seconds to be converted to time format, the format will be a number


+++Current Day Of Week+++

```
function current_dow($offset = 0)
```

This function returns the current day of week as integer between 1 and 7
range, this is used by some functions in SaltOS, allow to specify a bias
used to move the current time mark

- @offset => the bias added to the current time mark


+++Datetime format+++

```
function datetime_format($x)
```

This function returns the datetime using the europe format for d/m/Y instead of Y-m-d

- @x => the datetime string that you want to convert


++Error helper module++

```
api/php/autoload/error.php
```

This fie contains useful functions related to error management, allow to trigger and manage
errors, too contains the code used for the error and exception handlers


+++Show PHP Error+++

```
function show_php_error($array)
```

This function allow to SaltOS to trigger the errors in a multiple levels:

1) Check if the error is caused by a memory allocation error, and in this case, try
to setup more memory to continue executing the error function, sometimes if the system
is using all memory, this function can not do all tasks and don't know whats be happening

2) Add some extra traces if they are not found in the input array

3) Create a human readable message in text and json format, the text will be used
to log the error using a regular file and the json will be used as stdout response

4) If the error is caused by a deprecation, the error will be logged in the log file
but the execution of the code will continue (if it can continue!!!)

5) Try to categorize the error and log the text in the specific log file, this part
is optimized to prevent the addition of repeated errors using a hash as a trick

6) Send a json to the stdout using the output handler.

THs input @array can contain pairs of key val:

- @dberror    => The text used in the DB Error section
- @phperror   => The text used in the PHP Error section
- @xmlerror   => The text used in the XML Error section
- @jserror    => The text used in the JS Error section
- @dbwarning  => The text used in the DB Warning section
- @phpwarning => The text used in the PHP Warning section
- @xmlwarning => The text used in the XML Warning section
- @jswarning  => The text used in the JS Warning section
- @source     => The text used in the Source section
- @exception  => The text used in the Exception section
- @details    => The text used in the Details section
- @query      => The text used in the Query section
- @backtrace  => The text used in the Backtrace section
- @debug      => The text used in the Debug section


Notes:

The unset for the pid and the time keys of the debug array is justificate
because each execution modify the pid and the time entries and break the
optimization of the hash with the checklog to prevent repetitions in the
log file


+++Do Message Error+++

```
function do_message_error($array)
```

This function acts as a helper of the show_php_error, is intended to build
the text and the json messages used to the log file and for the stdout channel

THs input @array can contain pairs of key val:

- @dberror    => The text used in the DB Error section
- @phperror   => The text used in the PHP Error section
- @xmlerror   => The text used in the XML Error section
- @jserror    => The text used in the JS Error section
- @dbwarning  => The text used in the DB Warning section
- @phpwarning => The text used in the PHP Warning section
- @xmlwarning => The text used in the XML Warning section
- @jswarning  => The text used in the JS Warning section
- @source     => The text used in the Source section
- @exception  => The text used in the Exception section
- @details    => The text used in the Details section
- @query      => The text used in the Query section
- @backtrace  => The text used in the Backtrace section
- @debug      => The text used in the Debug section


Returns an array with the text and the json formated output ready to be used
in the log file and in the stdout channel


+++Program Handlers+++

```
function program_handlers()
```

This function program all error handlers


+++Error Handler+++

```
function __error_handler($type, $message, $file, $line)
```

This function is the callback function used by the set_error_handler

Ths arguments are defined by the set_error_handler:

- @type    => The code of the error
- @message => The descriptive message of the error
- @file    => The filename of the file that trigger the error
- @line    => The line where the error will occurred


+++Exception Handler+++

```
function __exception_handler($e)
```

This function is the callback function used by the set_exception_handler

Ths arguments are defined by the set_exception_handler:

- @e => object that contains the getMessage, getCode, getFile, getLine and getTrace
      methods


+++Shutdown Handler+++

```
function __shutdown_handler()
```

This function is the callback function used by the register_shutdown_function, try to
detect if an error is the cause of the shutdown of the script, note that a correct
execution will execute this function and only it must to trigger an error if a real
error is in the stack of the errors events, to do it this function uses the error_get_last
to check if the value in in the list of typified errors


+++Get code from trace+++

```
function __get_code_from_trace()
```

This function acts as helper of the show_json_error, and try to get the filename and the line
where the error will be triggered, for example, an error triggered from the index.php at line
23 will generate a code index:23, this information will be useful for our technical service
to help the users when live issues with our API

- @trace => the array returned by the debug_backtrace function
- @index => the position of the array used to get the filename and the line


Notes:

This function gets the arguments dinamically, this allow to send for example the array with
the trace, the desired index or both datas in your prefered order, the trick to detect each
param is to expect an array for the trace and a number for the index.


+++Show JSON Error+++

```
function show_json_error($msg, $logout = false)
```

This function is triggered from the code in a controlate errors, the idea is to have
a simple way to send controled errors to the user using a json output channel, and to
do it, we have this function that can be called with a simple message and the code
is created automatically to help the backtrace of the issues

- @msg    => this contains a simple text that is used in the json output
- @logout => this allow to send the logout flag to force to show the login screen


+++Get code from file and line+++

```
function __get_code_from_file_and_line($file, $line)
```

This function returns the string that contains the PATHINFO_FILENAME and the line to idenfify
the launcher of an error, for example

- @file => filename used to obtain the first part of the code
- @line => line used to construct the last part of the code


+++Detect Recursion+++

```
function detect_recursion($fn)
```

This function allow to SaltOS to detect the recursiÃ³n, to do it, uses the debug_backtrace
function that returns all information about the execution of the current function, the
main idea of this function is to detect in what lines of the backtrace appear the file
or the function, and returns the count of times that appear

- @fn => the name of the function or file, can be multiples functions or files separated
       by a comma


+++Overload error handler+++

```
function overload_error_handler($words)
```

This function allow to add a new error handler that is able to ignore certain errors
that contains the words used as argument, this is usefull in cases where php trigger
an uncontrolable error that not are possible to control using other techniques like
try/catch or using the documented specification

- @words => the list of words that must to contain the error desired to be ignored


++Execution helper module++

```
api/php/autoload/exec.php
```

This fie contains useful functions related to execution of external programs, allow to execute,
check commands and manage some features as the cache usage or the timeout used in each execution


+++OB Passthru+++

```
function ob_passthru($cmd, $expires = 0)
```

This function is a join of ob_start and passthru, the main idea
is to execute a program using the command line and get the
output (only stdout and not stderr) and return the data

- @cmd     => the command line that you want to execute
- @expires => the expires time used to compute if the cache is valid


This funtion tries to execute the command using some of the
provided methods, passthru, system, exec and shell_exec, another
feature is that the function detects what command are available
to use


+++Check Commands+++

```
function check_commands($commands, $expires = -1)
```

This function tries to validate if the commands are available
in the system, to do it, uses the unix command witch

- @commands => the commands that you want to check if are they available
- @expires  => the expires time used to compute if the cache is valid


+++Is Disabled Function+++

```
function is_disabled_function($fn)
```

This function check if the argument contains a disabled
function, this feature uses the variables disable_functions
and suhosin.executor.func.blacklist to get the list of all
disabled functions

- @fn => the function that you want to check if is it disabled


Notes:

As an extra feature, this function can receive two arguments
to add and del functions to the static $array, this is usefull
for utest to check the correctness of the function


+++Exec Timeout+++

```
function __exec_timeout($cmd)
```

This helper function allow to execute commands using the external
command timeout, this unix command allow to define the timeout for
an execution of other command, and when the timeout is reached, then
break the execution killing the process

- @cmd => the command that you want to execute with a timeout control


Returns the string that contains the command with ths timeout control


++File utils helper module++

```
api/php/autoload/file.php
```

This fie contains useful functions related to the file usage, allow to manage directories, files,
caches, paths, permissions, remote files and more


+++Get Directory+++

```
function get_directory($key)
```

This function returns the directory configured to the key requested, too can define a default
value, useful when the configuration still not loaded and SaltOS need some directory to do
something as store data in the log file, for example

- @key => the key used in get_config to request the configured directory


+++Get Temp File+++

```
function get_temp_file($ext = '')
```

This function is intended to get a unique temporary file, used for temporary
purposes as put contents to be used as input in a command

- @ext => the extension of the temporary file, useful for some commands that
        try to detect the contents using the extension


Notes:

This function uses the dirs/tempdir config key


+++Get Cache File+++

```
function get_cache_file($data, $ext = '')
```

This function is intended to get a cache filename, used for caching purposes

- @data => data used to compute the hash used by the cache, can be an string or
         an array with lot of contents
- @ext  => extension of the cache filename


Notes:

This function uses the dirs/cachedir config key


+++Cache Exists+++

```
function cache_exists($cache, $files)
```

This function check the existence of valid cache by comparing the timestamp
of the filemtime between the cache file and all files of the second argument

- @cache => cache filename
- @files => array of files that are considered as dependencies of the cache


+++URL Get Contents+++

```
function url_get_contents($url)
```

This file is an equivalent of the file_get_contents but intended to be used
for request remote files using protocols as http or https

- @url => the url that you want to retrieve


Notes:

This function only returns the body of the request, if you are interested
to get the headers of the request, try to use the __url_get_contents


+++URL Get Contents helper+++

```
function __url_get_contents($url, $args = [])
```

This file is an equivalent of the file_get_contents but intended to be used
for request remote files using protocols as http or https

- @url     => the url that you want to retrieve
- @args    => Array of arguments, explained in the follow lines
- @cookies => an array with the cookies to be restored before send the request
- @_method => method used in the request
- @values  => an array with the post values, useful when you want to send a POST
            request with pairs of variables and values
- @headers => an array with the headers to be send in the request
- @body    => the full body used of the request, useful when you want to send a
            json file in the body instead of pairs of keys vals


This function returns an array with four elements, body, headers, cookies and code


+++Extension+++

```
function extension($file)
```

This function returns the PATHINFO_EXTENSION of the file

- @file => file used in the pathinfo call


+++Encode Bar Chars File+++

```
function encode_bad_chars_file($file)
```

This function is equivalent to encode_bad_chars but intended to be used
with filenames, in this case, the extension and the rest of the filename
will be encoded separately and the return value will contain the dot
separating the filename with the extension

- @file => filename used in the encode process


+++Realpath Protected+++

```
function realpath_protected($path)
```

This function returns the realpath of the path, this version of the function
allow to return the path of an unexistent file, this is useful when do you
want to get the realpath of a unexistent file, for example, to the output of
a command that must to generate the file but at the moment of the execution
of this function the file is not found

- @path => path used in the realpath call


+++Getcwd Protected+++

```
function getcwd_protected()
```

This function returns the same result that the getcwd function but checking
that the result is not an slash, this is an issue in some cases caused by
permissions problems, and a good solution for this cases is to get the directory
of the script as current work directory


+++Glob Protected+++

```
function glob_protected($pattern)
```

This function returns the same result that the glob function but checking
that the result is an array, if glob fails or not get a files by the pattern,
can return other values that an array, and this can cause problems if you are
expecting an array to iterate in each element, this function prevent this
problem

- @pattern => pattern used in the glob command


+++Chmod Protected+++

```
function chmod_protected($file, $mode)
```

This function tries to change the mode of the file using the chmod function
only if the fileperms of the file are different that the requested mode and
the fileowner of the file is the same user that is executing the script

- @file => file used by the chmod function
- @mode => mode used by the chmod function


+++Fsockopen Protected+++

```
function fsockopen_protected($hostname, $port, &$errno = 0, &$errstr = '', $timeout = null)
```

This function is only used by the httpclient library to avois problems with
the certificates validations

Ths arguments is the same that the fsockopen function, in this case, the
function uses the stream_socket_client to emulate the original fsockopen


+++File with hash+++

```
function file_with_hash($file)
```

This function returns the name of the file adding as argument the hash
of the file for the http/https requests, this allow to helps the browser
to know when the file has changed

- @file => the file that you want to add the hash querystring argument


+++File with min+++

```
function file_with_min($file)
```

This function returns the name of the file adding the .min. between the
filename and the extension of the file if the .min. file exists

- @file => the file that you want to add the .min. part if exists


+++File Get Contents Protected+++

```
function file_get_contents_protected(...$args)
```

This function call the original file_get_contents and returns the buffer
returned by the original function, the main idea of this function is to
protect the caller to prevent I/O errors like "nohup php index.php" when

- @args => the original arguments are passed to the file_get_contents


+++Get human size+++

```
function get_human_size($size, $pre = '', $post = '')
```

This function returns an string containing the size in human format

- @size => the number of bytes to convert to human format
- @pre  => string added between the number and the unit letter
post  => string added after the unit letter at the end


++Get data helper module++

```
api/php/autoload/getdata.php
```

This fie contains useful functions related to the $_DATA global variable, allow to get and set
values in the global $_DATA variable using xpath as key


+++Get data+++

```
function get_data($key)
```

This function is intended to be used to retrieve values from the
data system

- @key => the key that you want to retrieve the value


Notes:

If you request the key rest/-1, then the function returns the last
value of the rest, intended to get the last value of the rest array,
too you can get the rest array using negative indexes beginning
from the last position


+++Set data+++

```
function set_data($key, $val)
```

This function sets a value in the data system for the specified key

- @key => the key that you want to set
- @val => the value that you want to set


Notes:

If null val is passed as argument, then the entry of the data is removed,
the main idea is to use the same method used by the setcookie that allow
to remove entries by setting the value to null


++Gettext helper module++

```
api/php/autoload/gettext.php
```

This fie contains useful functions related to gettext funcionality, allow to manage the
SaltOS translations using a merged system of the unix locales and the old SaltOS translations
system.


+++Get Text function+++

```
function T($text = '')
```

This function replaces the gettext abreviation _() using the SaltOS gettext
feature, is based in the original system of the old SaltOS with improvements
to do more open as the GNU gettext

- @text => The text that you want to translate


Notes:

This function uses multiples locales at same time, SaltOS provides a basic set of
usefull strings and each application can add and overwrite more strings, this is
the same feature that old SaltOS provides

If you call the function without argument, the function returns the gettext
dictionary intended to populate the clients gettext module and contains the
app, the lang and the locales for the app and lang.


+++Check lang format+++

```
function check_lang_format($lang)
```

This function checks the correctness of the lang and returns a valid
string that can be used safely as lang in other sites

- @lang => the lang that you want to process


+++Current lang+++

```
function current_lang()
```

This function returns the current lang


++Iniset helper module++

```
api/php/autoload/iniset.php
```

This fie contains useful functions related to the evaluation of the iniset, puntenv and extra
directives configures in the config.xml file


+++Eval Iniset+++

```
function eval_iniset($array)
```

This function evaluates the iniset section of the config file, is intended
to execute all ini_set commands detecting the current values and determining
if is needed to change or not the current setting, is able to understand
boolean values as On/Off, and too is able to set keys as mbstring.internal_encoding
or mbstring.detect_order that must to be set by using another mb_* functions

- @array => the array with the pairs of keys vals


+++Eval Putenv+++

```
function eval_putenv($array)
```

This function evaluates the putenv section of the config file, is intended
to execute all putenv commands detecting the current values and determining
if is needed to change or not the current setting

- @array => the array with the pairs of keys vals


+++According to the documentation, putenv must return false in error cases, but+++

```
if ($key == '' || putenv("$key=$val") === false) {
```


putenv(): Argument #1 ($assignment) must have a valid syntax (code 0)

For this reason, the show_php_error placed after the putenv that must to
be executed when putenv returns false never can be executed.

As trick, I have added the void key condition to force a case that executes
the show_php_error


+++Eval Extras+++

```
function eval_extras($array)
```

This function evaluates the extra init requirements, intended for the multibyte
functions and for the gettext initialization process

- @array => the array with the pairs of keys vals


++Json helper module++

```
api/php/autoload/json.php
```

This fie contains useful functions related to colors


+++Terminal colors+++

```
define('__COLORS_MAP__', [
```

This define sets the colors array used in the next functions


+++Json colorize+++

```
function json_colorize($json)
```

This funcion is able to colorize a json fragment to dump into a tty terminal

- @json => the json code that you want to colorize


Notes:

This function uses a trick to convert numbers in scientific notation to an old
decimal style, to do it, detects numbers with the e letter and print using the
%.16f, this is used in sprintf to format floating-point numbers with 16 decimal
places, ensuring precision up to the typical limit of a double type in C, which
supports approximately 15-17 significant digits


++Log helper module++

```
api/php/autoload/log.php
```

This fie contains useful functions related to the logs files, allowing to add and check contents
to the logs file, useful for debug purposes


+++Check Log+++

```
function checklog($hash, $file)
```

This function is a helper for the show_php_error, allow to detect repetitions
of the same text in the log file to prevent to add repeated lines, the usage
is very simple, only requires a hash and a file to check that the hash is not
found in the contents of the file, you can think in this function as a grep
replacement that is able to found the hash in the file

- @hash => the pattern that you want to search in the file
- @file => the file where search the pattern


+++Add Log+++

```
function addlog($msg, $file = '')
```

This function add messages to the specified log file

- @msg  => message that you want to add to the log file
- @file => the log file that you want to use without directory


Notes:

If not file is specified, the debug/logfile (saltos.log) is used by default

The logs files are stored in the logsdir (/data/logs)

This function performs the log rotation is the maxfilesize is reached


+++Add Trace+++

```
function addtrace($array, $file)
```

This function performs the addlog to the file using as input the array, the
main idea is to pass the same array that the used in the show_php_error, the
difference is that addtrace, only add the backtrace and debug to the array
and then, saves the log to the specified file

- @array => the array that can contains the same info that show_php_error
- @file  => the file where do you want to store the log contents


+++Get Trace+++

```
function gettrace(...$args)
```

This function get an array as show_php_error, add the backtrace and debug
information and convert all array into a string

- @array => the array that can contains the same info that show_php_error
- @full  => add the full debug backtrace instead of the generic partial


This differentiation is because the full debug backtrace can break the
checklog feature because the time and pid can be different in each
execution


+++Session Backtrace+++

```
function session_backtrace()
```

Returns a string with the pid, sessid and current datetime with decimals

Notes:

The fields of this array allow to do low level debug processes, this data is
generally used by the semaphores and some forced addtrace calls, but causes
problems in the error reporting because break the hash and checklog optimization


++Memory helper module++

```
api/php/autoload/memory.php
```

This fie contains useful functions related to memory and time usage, allow to control the usage
of time and/or memory of a process, intended to prevent crashes in processes that requires more
time or memory resources that the defined by the system limits


+++Memory Get Free+++

```
function memory_get_free($bytes = false)
```

This function returns the free memory in bytes or the percentage of the memory_limit

- @bytes => if true, returns the free bytes, if false, returns the percentage


+++Get Time Usage+++

```
function time_get_usage($secs = false)
```

This function returns the time usage in seconds or in percentage of the max_execution_time

- @secs => if true, returns the used seconds, if false, returns the percentage


+++Get Free Time+++

```
function time_get_free($secs = false)
```

This function returns the free time in seconds or in percentage of the max_execution_time

- @secs => if true, returns the used seconds, if false, returns the percentage


+++Init Time Get+++

```
function init_timer()
```

This function call the helper to initialize the static ini to the current microtime


+++Get Time helper+++

```
function __time_get_helper($fn, $secs)
```

This function is a helper of the time_get_usage and time_get_free functions, is used to
check the time usage and the free time that remain to finish the execution of the script


+++Set Max Memory Limit+++

```
function set_max_memory_limit()
```

This function is intended to do a ini_set with a more greather value to allow an
exceptionally amount of memory usage


+++Set Max Execution Time+++

```
function set_max_execution_time()
```

This function is intended to do a ini_set with a more greather value to allow an
exceptionally amount of execution time


++Mime helper module++

```
api/php/autoload/mime.php
```

This file contains the mimetype feature provided by saltos using different techniques
suck as the extension file, using the mime_content_type or the finfo_file functions.


+++SaltOS Content Type+++

```
function saltos_content_type($file)
```

This function is intended to returns the mime content-type string using different
techniques.

- @file => the file of which you want to know the content-type


+++SaltOS Content Type first helper+++

```
function saltos_content_type0($mime)
```

This function returns the first part of the content-type, for example, if you
pass the string image/jpeg, this function will returns the string image.

- @mime => the mime that you want to process


+++SaltOS Content Type second helper+++

```
function saltos_content_type1($mime)
```

This function returns the second part of the content-type, for example, if you
pass the string image/jpeg, this function will returns the string jpeg.

- @mime => the mime that you want to process


+++Mime inline+++

```
function mime_inline($type, $data)
```

This function returns the inline mime fragment of string that contains the mime
and the encoded in base64 data, intended to embed it in img tags, for example.

- @type => the mime type (image/png for example)
- @data => the contents of the data that must to be encoded in base64


+++SaltOS Content Type from string+++

```
function saltos_content_type_from_string($buffer)
```

This function tries to return content-type of the buffer contents

- @buffer => the data that contains the image or other thing that you want to know
           the content-type.


+++Mime extract+++

```
function mime_extract($data)
```

This function tries to do the invert action that mime_inline, the main idea
is to return the type and data used in the inline image, for example

- @data => an inline image in the format of data:image/png;base64,xxxxx


+++Mime to name+++

```
function mime2name($type)
```

This function returns a valid filename for the type used in the argument

- @type => the content-type that you want to use to get the filename


Notes:

- This function contains some special cases that contains special chars


++Output helper module++

```
api/php/autoload/output.php
```

This fie contains useful functions related to the output of the SaltOS, allow to send contents to
the clients using the specified format and configuration, useful to return contents, too implement
a specific output for the json format that is the most format used by the new SaltOS


+++Output Handler+++

```
function output_handler($array)
```

This function is intended to send data to the output channel, and can have
the follow arguments:

- @array => array with the follow pairs of key val
- @file  => file that contains the contents that you want to send
- @data  => contents that you want to send to the output channel
- @type  => content type header used
- @cache => boolean to enable the cache usage, includes the etag algorithm
- @name  => the filename used in the content disposition attachment header
- @extra => headers that you can add to the transfer


+++Output header helper+++

```
function __output_header($header, $replace = true)
```

This function is a filter to ignore the headers when CLI SAPI is detected

- @header  => The header that do you want to send to the client
- @replace => The boolean used as replace in the original function, true by default


+++Output Handler JSON+++

```
function output_handler_json($array)
```

This function allow to quickly send json output, the unique argument that it
requires is the data that you want to send

- @array => content to convert to json and send to the output channel


Notes:

This function is able to generate a pretty output when stdout is connected to
a terminal, intended to be used by humans, in other cases, the output will be
minified.


++PCOV helper module++

```
api/php/autoload/pcov.php
```

This fie contains useful functions related to the pcov module used to
measure the coverage of the unit tests


+++PCOV start+++

```
function pcov_start()
```

This function start the pcov recording to allow the measuring of the
coverage in the unit tests.


+++PCOV stop+++

```
function pcov_stop()
```

This function stop the pcov recording that allow the measuring of the
coverage in the unit tests and puts in the output file the collected
data in a serialized format


++Permissions helper module++

```
api/php/autoload/perms.php
```

This fie contains useful functions related to permissions, allow to apply permissions in php core
or in sql queries, to do it, uses all permissions tables and predefined configurations, more info
in each function


+++Check User+++

```
function check_user($app, $perm)
```

This function checks the permissions using the tables apps_perms,
users_apps_perms and groups_apps_perms, to do it, this function uses
the user_id and groups_id (note that groups_id contains all groups
where the user is associated), and try to check that the permissions
permutations exists in the apps_perms, if some permission is found
in the users and groups tables and it is not found in the apps_perms,
an integrity error is launched.

- @app  => the app to check
- @perm => the perm to check


+++Check SQL+++

```
function check_sql($app, $perm)
```

This function returns the fragment of SQL intended to filter by app and
perm for the current user

- @app  => the app to check
- @perm => the perm to check


Notes:

This function returns the portion of sql used to check permissions
associated to an user with a specific permission and to an specific
register, as an optimization, it detects if the all owner is on and
return a true expression to improve the performance


+++Perms helper function+++

```
function __perms($fn, $arg)
```

This function is used by the XXX2YYY functions as helper, it stores the
dictionary of all conversions and resolves the data using it

- @fn  => the caller function
- @arg => the argument passed to the function


+++Id to Perm+++

```
function id2perm($id)
```

This function resolves the code of the perm from the perm id

- @id => the id used to resolve the perm


+++Perm to Id+++

```
function perm2id($perm)
```

This function resolves the id of the perm from the perm code

- @perm => the perm code used to resolve the id


Notes:

This function can return an integer or an array of integers, depending
if the app is using the owner parameter or not


+++Perm Exists+++

```
function perm_exists($perm)
```

This function detect if a perm exists

- @perm => the perm that you want to check if exists


Notes:

This function returns true if a perm exists, and in case of the usage
of the owner parameter, the function will return true for a perm that
contains the owner and for the perm without the owner, for exampe, this
function returns true for perm list and form perm list|user


+++Check App Perm Id+++

```
function check_app_perm_id($app, $perm, $id = null)
```

This function returns true if the app, the perm and the id accomplishes the
expected level of permissions, it is intended to be used before the execution
of each action, to guarantee the security

- @app  => the app to check
- @perm => the perm to check
- @id   => the id to check, if needed, you can omit in the create case


+++User is admin+++

```
function __user_is_admin($app)
```

This function returns true if the current user has all perms for the app


+++Merge data actions+++

```
function merge_data_actions($data, $actions)
```

This function merge the rows of a table or list with the specified actions

- @data    => the data of the table or list widget
- @actions => the desired actions to use in the table or list widget


+++App has perm+++

```
function __app_has_perm($app, $perm)
```

This function checks that the app has the requested perm, used by the
merge_data_actions to validate the existence of a permission in the
application.

- @app  => the app to check
- @perm => the perm to check


++Random helper module++

```
api/php/autoload/random.php
```

This fie contains useful functions related to random number generator, currently only initialize
the internal generator, but in the future we can add more features if it is needed


+++Init Random+++

```
function init_random()
```

This function initialize the random number generator

Notes:

This function previously sets the seed using the microtime, but reading
the srand php documentation, I see that the seed is not needed because
if it is not provided, a randomly seed is used by default


++Semaphore helper module++

```
api/php/autoload/semaphores.php
```

This fie contains useful functions related to semaphores, allow to create and use semaphores
for acquiring and release semaphores that guaranty the exclusivity of the code execution


+++Semaphore Acquire+++

```
function semaphore_acquire($name = '', $timeout = INF)
```

This function implement the acquire of a semaphore

- @name    => the name of the semaphore
- @timeout => the timeout used in waiting operations


+++Semaphore Release+++

```
function semaphore_release($name = '')
```

This function implement the release of the semaphore

- @name => the name of the semaphore


+++Semaphore Shutdown+++

```
function semaphore_shutdown()
```

This function implement the shutdown of all semaphores, to do it,
the function will iterate in each semaphore to release and set to
null the semaphore pointer


+++Semaphore File+++

```
function semaphore_file($name = '')
```

This function returns the associated semaphore file used by the
named semaphore, useful for debug purposes

- @name => the name of the semaphore


+++Semaphore helper+++

```
function __semaphore_helper($fn, $name, $timeout)
```

This function implements the real semaphore functionalities, includes
the code to do an acquire, the release, the shutdown and to get the
file, is programmed as a function instead of a class by historical
motivation, in reality, the statics fds acts as a properties of a
class and each if stripos acts as a methods of a class

- @fn      => the function name that call the helper, to detect the feature
- @name    => the name of the semaphore
- @timeout => the timeout used in waiting operations


+++Semaphore USleep helper+++

```
function __semaphore_usleep($usec)
```

This function implements an usleep (micro sleeper) using sockets, this
allow to break the execution of the function if a signal is received by
the process, in reality, the feature is powered by the socket_select that
is allowed to wait for read and write operations with a very precise
timeout.

The returned value will be the difference between the end less the start,
in other words, the returned value is the ellapsed time sleeped by the
function

- @usec => the micro seconds that you want to sleep


++Server helper module++

```
api/php/autoload/server.php
```

This fie contains useful functions related to the $_SERVER global variable, currently only publish
a getter function, but in the future, can store more features if it is needed


+++Get Server+++

```
function get_server($key)
```

This function returns the server variable requested by index if it exists

- @key => the index key used to get the value of the server


+++Set Server+++

```
function set_server($key, $val)
```

This function is intended to replace some server variabe in runtime mode

- @key => the index key used to get the value of the server
- @val => the value that you want to set in the server array


+++Current hash+++

```
function current_hash()
```

This function tries to do the same like current_user but for the hash parameter
obtained from the QUERY_STRING server variable


++SQL utils helper module++

```
api/php/autoload/sql.php
```

This fie contains useful functions related to SQL queries, allow to help modules that requires
the entire management of the database (create tables, drop tables, create indexes, and more),
too allow to prepare sql queries suck inserts, updates or wheres fragments that are procected
to external injections, for example, by escaping all special characters.

Too it provides functions to do subparts of the where queries suck as special likes combinations
or match again combinations for the fulltext search engine, see all detailed information by
reading the list of functions of this module


+++Parse Query+++

```
function parse_query($query, $type = '')
```

This function is intended to apply the query filters defined by the users
when write queries for multiples db engines as MySQL and/or SQLite, for
example, if you want to write a fragment of SQL with one version for MySQL
and another version for SQLite, you can do / *MYSQL ... * // *SQLite ... * /

Note that the previous example add a spaces between the bar and the asterisc
because we can not put comments inside another comment!!!

- @query => the query that must be parsed
- @type  => the db type that you want to allow by the filters


+++Parse Query Type helper+++

```
function __parse_query_type()
```

This function returns the type used by parse_query using as detector the
dbtype of the config file, currently only allow to return MYSQL and/or SQLITE


+++Parse Query Strpos helper+++

```
function __parse_query_strpos($haystack, $needle, $offset = 0)
```

This function is the same that strpos, but with some improvements required
by the parse_query funcion, the idea is to use the strpos functionality, but
controlling that the found position must acomplish some constraints as the
number of simple and double quotes must to be even

The arguments are the same that the strpos function

- @haystack => string where search the needle
- @needle   => the needle text that must be found in the haystack
- @offset   => bias applied to begin the search of the needle


+++Execute Query+++

```
function execute_query($query, $params = null)
```

This function executes the query and depending in the result, returns the
resultset trying to do the more good combination in the return data

- @query => the SQL query that you want to execute


Note that the db_query is executed with the "auto" fetch mode, this causes
that the db_query returns an array with one dimension if the query only
generates a resultset with only one column, or returns an array with two
dimensions if the query generates a resultest with more that one column

To be more practice:

If you execute a query that select one field and only returns one row,
the return value will be the value of the field

If you execute a query that select one field and returns more that one
row, the return value will be an array of one dimension with all values
of this field

If you execute a query that select multiples fields and only return one
row, the return value will be an array of one dimension with all fields

Ig you execute a query that select multiples fields and returns more that
one row, the return value will be an array of two dimensions with all rows
and each row with all fields

Be carefully to use the output of this command in an foreach, for example
because you can get for the same query differents output types, if you
need to be more standarized in the output types, see the execute_query_array


+++Execute Query Array+++

```
function execute_query_array($query, $params = null)
```

This function is the same that execute_query but guarantee that for the
same query, you get the same output type if the resultet contains one
row or more rows, useful is you want to use the output of this function
in a foreach, for example

- @query => the SQL query that you want to execute


+++Get Fields+++

```
function get_fields($table)
```

This function returns the fields of the requested table

- @table => the table where that you want to know the fields


+++Get Indexes+++

```
function get_indexes($table)
```

This function returns the indexes of the requested table

- @table => the table where that you want to know the indexes


+++Get Tables+++

```
function get_tables()
```

This function returns the tables of the database


+++Get Field Type+++

```
function get_field_type($type)
```

This function returns an standarized type for the specific types used in
the real database, for example, returns string if the field is of TEXT type

- @type => the real type in the database


+++Get Field Size+++

```
function get_field_size($type)
```

This function returns the size for the types used in the database, for
example, returns 65535 if the field is of TEXT type

- @type => the real type in the database


Notes:

In general, type1 is used to detect the size of text fields, the type2
is used for VARCHAR(X) that specify the size of the VARCHAR in the type2
parameter.


+++Has Engine+++

```
function __has_engine($engine)
```

This function allow to SaltOS to ask to the database if an enxine is
availabie

- @engine => the engine that you want to get information about existence


+++Make Insert Query+++

```
function make_insert_query($table, $array)
```

Returns the insert query for the table with all fields specified by the
array param

- @table => table where you want to add the register
- @array => array with key val pairs that represent the field and the value
          of the field


Notes:

This function tries to cast each value to their data type getting this
information from dbschema config, you can pass in array all fields that
you want and not is needed to put all fields of the table, only the
fields that appear in the array will be used in the insert, if some
field is not a part of the fields of the table, an error will be
triggered

This function uses the array_key_exists instead of isset because the
check of the $array[$name] fails when the item exists but is false or
null, for example


+++Make Update Query+++

```
function make_update_query($table, $array, $where)
```

Returns the update query for the table with all fields specified by the
array param and using the specified where

- @table => table where you want to update the register
- @array => array with key val pairs that represent the field and the value of
          the field
- @where => array with key val pairs that represent the field and the value of
          the field used in the where part of the query


Notes:

This function tries to cast each value to their data type getting this
information from dbschema config, you can pass in array all fields that
you want and not is needed to put all fields of the table, only the
fields that appear in the array will be used in the update, if some
field is not a part of the fields of the table, an error will be
triggered

This function uses the array_key_exists instead of isset because the
check of the $array[$name] fails when the item exists but is false or
null, for example


+++Make Where Query+++

```
function make_where_query($table, $array)
```

This function allow to create where sentences joinin all fields by AND

- @table => table where you want to apply the where
- @array => array with key val pairs that represent the field and the value of
          the field


Notes:

The keys normally contains the name of the field, but if you need to use
a different comparison operator, you can use the field name and add the
operator that you want to use in the comparison, the allowed comparison
operators are >, <, =, >=, <=, !=


+++Escape Reserved Word+++

```
function escape_reserved_word($word)
```

This function tries to escape the reserved words that can not be used
in sql queries as field names or table names, currently is only used
to escape field names but in a future, if it is needed, can be added
to escape table names too

- @word => the word that must to be escape if needed


Notes:

If you use an array as argument, then the function is applied to all
elements of the array.


+++Make Like Query+++

```
function make_like_query($keys, $values, $args = [])
```

This function is intended to returns the sql fragment to be added to
the where condition to filter for the specified keys and values

- @keys    => an string with comma separated field names
- @values  => the value of the input search
- @minsize => the minimal size of the length used in each like
- @default => sql fraement returned if some thing was wrong


Notes:

This function generates a sequence of (like or like) and (like and like)
and is able to understand the prefix plus or minus in each word of the
search string, this allow to the function to use the like or not like
depending the sign of the word, and too to use the disjunction or
conjunction in each like group


+++Make Fulltext Query Helper+++

```
function __make_fulltext_query_helper($values, $args = [])
```

This function is similar to the make_like_query, but uses the match agains
clausule instead of the like clausule, the match agaings is used for
fulltext searches and generally, this function is not intended to be used
directly, it must acts as a helper of the make_fulltext_query

- @values  => the value of the input search
- @minsize => the minimal size of the length used in each like
- @default => sql fraement returned if some thing was wrong


Notes:

This function differs between the make_like_query in the idea that this
function only is used to search using fulltext indexes and in one unique
field named search


+++Make Fulltext Query+++

```
function make_fulltext_query($values, $app, $args = [])
```

While the two version returns the fragment that must to be added to the
query that search in the table that contains the search field, this function
allow to specify the same that the two version with two fields more, the
app and the prefix to be added to the id field of the in subquery

- @values  => the value of the input search
- @app     => the app used to detect the indexing table
- @prefix  => the prefix added to the id used in the in subquery
- @minsize => the minimal size of the length used in each like
- @default => sql fraement returned if some thing was wrong


+++TODO+++

```
function __prepare_helper_query($table, $array)
```

TODO


+++TODO+++

```
function prepare_insert_query($table, $array)
```

TODO


+++TODO+++

```
function prepare_update_query($table, $array, $where = [])
```

TODO


+++TODO+++

```
function prepare_where_query($table, $array)
```

TODO


++String utils helper module++

```
api/php/autoload/strings.php
```

This fie contains useful functions related to strings manipulations, suck as get the test in
UTF8, remove bad chars, of apply filters to the text, manipulate texts of other related tasks
with strings


+++Remove Bar Chars+++

```
function remove_bad_chars($temp, $pad = '')
```

This function removes chars from keycodes 0 to 31 except 9, 10, 13 (tab,
newline, return)

- @temp => input string that you want to fix
- @pad  => padding string used as replacement for bar chars (void by default)


+++Encode Bar Chars+++

```
function encode_bad_chars($cad, $pad = '_', $extra = '')
```

This function tries to replace accenteds chars and other extended chars into
an ascii chars, to do it, they define an array with the pairs of chars to
do a quick replace, too is converted all to lower and are removed all chars
that are out of range (valid range are from 0-9 and from a-z), the function
allow to specify an extra parameter to add extra chars that must to be
allowed in the output, all other chars will be converted to the padding
argument, as a bonus extra, all padding repetitions will be removed to
only allow one pading char at time

- @cad   => the input string to encode
- @pad   => the padding char using to replace the bar chars
- @extra => the list of chars allowed to appear in the output


+++Prepare Words+++

```
function trim_words($cad, $pad = ' ')
```

This function allow to prepare words removing repetitions in the padding char

- @cad => the input string to prepare
- @pad => the padding char using to replace the repetitions


Notes:

Apart of remove repetitions of the padding char, the function will try to
remove padding chars in the start and in the end of the string


+++Sprintr+++

```
function sprintr($array)
```

This function is an improved version of the print_r, allow to convert an
array into a string removing some extra lines that not contain information,
lines that contains only contains an open or close parenthesis, or nothing,
are removed, optimizing the output string

- @array => the array that do you want to convert into string


+++Get Unique ID MD5+++

```
function get_unique_id_md5()
```

This function returns an unique hash using the random generator


+++Intelligence Cut+++

```
function intelligence_cut($txt, $max, $end = '...')
```

This function allow to cut text by searching spaces to prevent to break words

- @txt => the text that you want to cut
- @max => the size of the expected output text
- @end => the suffix added if the text is cutted


+++Normalize Value+++

```
function normalize_value($value)
```

This function allow to detect the last letter to detect what magnitude is
using (K, M or G) and multiply the numeric part by the needed factor to
get the number without factor

- @value => the string that contain the number, for example "123k"


+++HTML to Text+++

```
function html2text($html)
```

This function uses the html2text roundcube function to convert html to
plain text, this code have the issue that requires the error_reporting(0)
because it have a lot of errors causes by use nondefined variables, for
example

- @html => the html code that you want to convert to plain text


+++Get UTF-8+++

```
function getutf8($str)
```

This function returns the string codified in a UTF-8 encoding

- @str => the input string that you want to covnert to UTF-8


+++Words Exists+++

```
function words_exists($words, $buffer)
```

This function check that all words exists in the buffer

- @words  => the string that contains words separated by spaces
- @buffer => the string where we must to found the words


+++String Replace Assoc+++

```
function str_replace_assoc($array, $cad)
```

This function do the same that str_replace, but using only one associative
array, using the keys as search and the values as replace, intended only
to do more prerry the code

- @array => the associative array with the pairs keys vals
- @cad   => the string that you want to apply the replacement


Notes:

This function can be replaced by strtr in the two arguments option, the
difference is that str_replace is more efficient that strtr because the
strtr tries to prepare the replacement list by ordering by size the
replace_pairs and too to prevent repeated replacements in previously
replacements, you can see test_strtr.php for more info


+++Get Part From String+++

```
function get_part_from_string($input, $delim, $index)
```

This function explodes de input using delim and returns the element of the
index position, if the index is negative, then returns the element beginning
from the end

- @input => the string that you want to cut in parts
- @delim => the delimiter char used to cut in parts
- @index => the index that you want to request of the explode result


+++Check IDS Helper+++

```
function __check_ids_helper()
```

This function checks the correctness of the list of ids and returns a valid
list available to be used in sql queries or as an array of valid ids

- @ids => the string containing the list of ids


+++Check IDS+++

```
function check_ids(...$args)
```

This function checks the correctness of the list of ids and returns a valid
list available to be used in sql queries

- @ids => the string containing the list of ids


+++Check IDS Array+++

```
function check_ids_array(...$args)
```

This function checks the correctness of the list of ids and returns a valid
list available to be used as array of valid ids

- @ids => the string containing the list of ids


+++String Replace One+++

```
function str_replace_one($from, $to, $cad)
```

This function tries to do the same that str_repalce but only for the first
occurrence

- @from => the string used as search
- @to   => the string that you want to use as replacement
- @cad  => the string that you want to modify


Notes:

This function can be replaced by preg_replace, but this implementation is
more efficient, see the test_replace.php for more info


+++Get String From Quotes+++

```
function get_string_from_quotes($val)
```

This string tries to return the string contained in a single or double
quotes, indended to be used for example in the construction of the where
used by the search engine

- @val => the string that you want to process


++System helper module++

```
api/php/autoload/system.php
```

This fie contains useful functions related to system checks, allow to detect dependencies not
installed on the system, or misconfigurations on the SaltOS installation


+++Check System+++

```
function check_system()
```

This function checks the system to detect if all knowed dependencies are found in the system, to do it,
defines an array with the type (class or function), the name and some extra info for the error message
that is triggered if the dependency is not satisfied


+++Check Directories+++

```
function check_directories()
```

Check all directories of the data directory to validate that the process can write inside it


+++Exec Check System+++

```
function exec_check_system()
```

This function executes the check system function and trigger an error if needed


++Tokens helper module++

```
api/php/autoload/tokens.php
```

This fie contains the functions related to the tokens usage and manipulations


+++Get Unique Token+++

```
function get_unique_token()
```

This function returns a string with a new and unique token


+++Check token format+++

```
function check_token_format($token)
```

This function checks the correctness of the token and returns a valid
string that can be used safely as token in sql queries

- @token => the token that you want to process


++User helper module++

```
api/php/autoload/user.php
```

This file contains the functions associated to the user validation, to
improve the performance, all functions are using a cache based trick
that performs an important speed up


+++Current Token+++

```
function current_token()
```

This function returns the id of the current token, this info is retrieved
using the token of the request, for security reasons, this validation only
can be performed by the same origin that execute the login action


+++Current User+++

```
function current_user()
```

This function returns the id of the current user, this info is retrieved
using the token of the request

Notes:

This function allow to authenticate using the token_id provided by the
current_token function and using the server/user variable in the data
structure that contains the desired login when executed using the cli
sapi.


+++Current Group+++

```
function current_group()
```

This function returns the id of the current group, this info is retrieved
using the token of the request


+++Current Groups+++

```
function current_groups()
```

This function returns the id of all current groups, this info is retrieved
using the token of the request and the main idea of this function is to
returns the list of all groups associated to the current user to facily the
permissions checks


+++Crontab Users+++

```
function crontab_users()
```

This function executes the maintenance queries to update the active field
in the passwords and tokens tables, it's intended to be used as helper

Notes:

This function uses an internal static variable to detect repeated executions
and only accepts the first execution, this is to prevent that multiples calls
to other actions and functions that requires the integrity of the passwords
and tokens


++Version helper module++

```
api/php/autoload/version.php
```

This fie contains useful functions related to the version of the SaltOS of the php engine


+++Get Name Version Revision+++

```
function get_name_version_revision($full = false)
```

This function returns a string with the SaltOS name, version, revision and
copyright if needed

- @full => boolean to specify if you want to add the copyright to the output


+++SVN Version+++

```
function svnversion($dir = null)
```

This function tries to return the svn version of the project

- @dir => allow to specify where do you want to execute the svnversion command


+++SVN Version helper+++

```
function __svnversion_helper($dir)
```

This function tries to return the svn version of the project

- @dir => allow to specify where do you want to execute the svnversion command


+++GIT Version+++

```
function gitversion($dir = null)
```

This function tries to return the git version of the project

- @dir => allow to specify where do you want to execute the gitversion command


+++GIT Version helper+++

```
function __gitversion_helper($dir)
```

This function tries to return the git version of the project

- @dir => allow to specify where do you want to execute the gitversion command


++XML to Array helper module++

```
api/php/autoload/xml2array.php
```

This fie contains useful functions related to the xml manipulation, this code is a part of the
main version of the SaltOS because the main idea defined some years ago continues active, if you
compare this code, you can see more accuracy in the specification to be more specific and precise
but this code is a part of all the SaltOS versions


+++Set Array+++

```
function set_array(&$array, $name, $value)
```

This function allow to specify multiples entries in an array with the same key,
to do this, the function will add #num where num is a unique number, in reality
if you want to set multiples entries for the key "test", you get in reality an
array with entries as "test", "test#1", "test#2"

This function works in concordance of the fix_key, that is able to get the key
as "test#1" and return only "test" that is the original key without the suffix
added to allow multiples instances of the same key in an associative array

- @array => array that you want to add the key with the value (by reference)
- @name  => the key used in the array, if exists, it will try to add the suffix to
          prevent collisions
- @value => the value that you want to set in this position of the array


+++Unset Array+++

```
function unset_array(&$array, $name)
```

This function remove all entries of the array that matches with the name of
the key, for example, if you specify the name "test", the function unset all
entries as "test" or begin by "test#", in the example of the previous function
will remove "test", "test#1" and "test#2"

- @array => array that you want to remove the key (by reference)
- @name  => the key used in the array and as prefix of the entries of the array


+++Fix Key+++

```
function fix_key($arg)
```

This function returns the "real" part of the key removing the suffix added to
prevent collisions in the associative array, for the above example, if you request
the fix_key of the "test#2", the function will returns "test"

- @arg => the name of the key that you want to remove the suffix part (if exists)


+++XML Files to Array+++

```
function xmlfiles2array($files, $usecache = true)
```

This function allow to convert all XML files to an array, allow to use cache to
optimize repetitive calls of the same file

As an special mention, this function internally implements the old xml_join feature
that allow to merge multiple files into one using the fix_key of the keys in the first
level as key to join.

- @files    => the files that you want to convert from xml to array
- @usecache => if do you want to enable the cache feature


Notes:
- The arrays2array function is derived from this function that get all arguments and
  process the contents to join with a certain logics


+++XML File to Array+++

```
function xmlfile2array($file, $usecache = true)
```

This function allow to convert a XML file to an array, allow to use cache to
optimize repetitive calls of the same file

As an special mention, this function internally uses semaphores to prevent
multiple instances of the same execution with the same file, too uses a cache
management to optimize the usage

- @file     => the file that you want to convert from xml to array
- @usecache => if do you want to enable the cache feature


+++XML to Array+++

```
function xml2array($xml, $file = '')
```

This function allow to convert a XML string to an array

- @xml  => xml code to be converted to an array
- @file => filename of the contents, only used when an errors occurs


+++XML to Struct+++

```
function xml2struct($xml, $file = '')
```

This function is a helper of the xml2array function, the main purpose of this
function is to convert the xml string into a struct to be processed by the
struct2array function

The motivation to use the xml_parse_into_struct function is that this function
is the more quick to parse xml files, after a lot of tests, the more quickly
execution is to use the xml_parse_into_struct, reverse the array and then
program a simple recursive function that convert a unidimensional array into
a tree

At the begining of this function, we will try to detect the enconding of the
xml file, the main objective is to convert all xml to UTF-8 that is the default
enconding of SaltOS

The returned value is the result of the xml_parse_into_struct function, that is
the key of this feature and this function

- @xml  => xml fragment that must be converted into struct
- @file => the source filename, it is used only to generate error reports


+++Struct to Array+++

```
function struct2array(&$data, $file = '')
```

This function is the second part in the xml2array convertsion, here, the function
receives an unidimensional array with commands to open, close, and their respective
values and attributes, with this information, this function is able to generate a
tree with the xml converted to an array tree

- @data => the struct array, by reference
- @file => the source filename, it is used only to generate error reports


Notes:

This function uses recursivity to accomplish the objetive, returns the portion
of xml between the open and close command, in each call, the data array passed
by reference will decrement in size because the array_pop removes the last element
of the array

Remember that previously of call this function, the array is reversed, this is
because is more efficient to do a reverse and then pops instead of use directly
the array_shift to get the next element, the reason is that array_shift must to
reorder all keys of the resulted array and this add a very big cost if the xml
is big, this problem was detected in 2014 and was optimized by add the reverse
and the pop instead of only shift


+++Eval Attributes+++

```
function eval_attr($array, $recursive = true)
```

This function is very special in SaltOS, is part of the initial code an
is used by a lot of parts of the program, currently are using a simplified
version of the original function and have improvements that allow to return
arrays with attributes without evaluate and without causing an error, this
allow to define xml with attributes that can be used by other processes and
SaltOS only interpret three attributes

- @array => the array that contains a tree representation of the xml


The three attributes are:

- @eval => this attribute must be a boolean and allow to evaluate the value
of the node


- @ifeval => this attribute must contains an expression that must evaluate as
true or false, and allow to maintain or remove the entire node thas contains
the ifeval attribute, this is useful when you need a node in some conditions


- @require => this attribute allow to SaltOS to add code to the current exec
context and is intended to load code that will then be used by the eval feature


The great change between the eval_attr of the previous versions of SaltOS is
that this version only accepts three internal commands and the other
attributes can be maintained in order to be used by other processes
(internally or externally)


+++Eval Bool+++

```
function eval_bool($arg)
```

This function returns a boolean depending on the input evaluation, the main idea
is to get an string, for example, and determine if must be considered true or false
otherwise will finish in an error

The valid inputs are the strings one, zero, void, true, false, on, off, yes and no

- @arg => the value that do you want to evaluates as boolean


++Yaml helper module++

```
api/php/autoload/yaml.php
```

This file provide the functions provided by the php-yaml package, intended
to be used by setups that can not install this package.


+++Yaml Parse+++

```
function yaml_parse(string $yaml)
```

Parse a YAML string into a PHP array.

- @yaml => The YAML string.


+++Yaml Parse File+++

```
function yaml_parse_file(string $filename)
```

Parse a YAML file into a PHP array

- @filename => The path to the YAML file


+++Yaml Emit+++

```
function yaml_emit(array $data, int $inline = 2, int $indent = 4)
```

Emit an array as a YAML string.

- @data   => The data to convert to YAML.
- @inline => The level at which to start inlining YAML (default: 2).
- @indent => The number of spaces to use for indentation (default: 4).


+++Yaml Emit File+++

```
function yaml_emit_file(string $filename, array $data, int $inline = 2, int $indent = 4)
```

Emit an array as a YAML file

- @filename => The path to save the YAML file
- @data     => The data to convert to YAML
- @inline   => The level at which to start inlining YAML (default: 2)
- @indent   => The number of spaces to use for indentation (default: 4)


++Main execution module++

```
api/php/autoload/zindex.php
```

This file contains the old index.php file, this was moved here to simplify the index.php and to
allow some php checks found in the current index.php

This code implements the main method to access to the SaltOS API using rest and json requests, to
use it, you can use the follow methods:

1) Rest using GET requests

This kind of requests requires that you send a GET request with a querystring of the follow
form:

- @https://127.0.0.1/saltos/code4/?app/invoices/view/2


And the system process it of the follow form:

- @rest/1 => invoices
- @rest/2 => view
- @rest/3 => 2


And you can programm any action that uses these parameters to do the desired task

2) Json using POST requests

This other kind of requests requires that you send a POST request with the appropiate header
for the content-type as application/json and a json in the body of the request, with this
call, saltos can map all contents of the json to the json/????? variables.

As an extra bonus, this module defines some useful server variables used in a lot of
features of saltos, like the follow vars:

- @request_method => can be GET or POST
- @content_type   => used to check the content type for the JSON requests
- @token          => used to validate the HTTP_TOKEN send as authentication
- @remote_addr    => used internally for security reasons
- @user_agent     => used internally for security reasons


As a brief resume, you can use the follow keys in get_data or set_data:

- @rest                  => to get an array with all rest data, for the above example they
                          must return some thing like this:
                          ["app", "invoices", "view", "2"]
- @rest/1                => to get only the element that contains "invoices"
- @rest/2                => to get only the element that contains "view"
- @rest/3                => to get only the element that contains "2"
- @json                  => to get an array with all json data, for the above example they
                          must return some thing like this: ["user"=>"xxx", "pass"=>"xxx"]
- @json/user             => to get only the element that contains the user
- @json/pass             => to get only the element that contains the pass
- @server                => to get an array with all server data
- @server/request_method => can be GET or POST
- @server/content_type   => used to check the content type for the JSON requests
- @server/token          => used to validate the HTTP_TOKEN send as authentication
- @server/remote_addr    => used internally for security reasons
- @server/user_agent     => used internally for security reasons


+Database+

++SQLite3 functions library++

```
api/php/database/libsqlite.php
```

SQLite's database allow to define external functions that can be used from the SQL language,
this is a great feature that allow to use SQLite as MySQL, and using this feature of the
database, the SQLite drivers use the libsqlite to add a lot of features found in MySQL and
used in a lot of queries by SaltOS

More info about this feature by searching:
- @PDO     => sqliteCreateFunction/sqliteCreateAggregate
- @SQLite3 => createFunction/createAggregate


+++GROUP_CONCAT+++

```
function __libsqlite_group_concat_step($context, $rows, $string, $separator = ',')
```

This function add the GROUP_CONCAT to the SQLite database


+++GROUP_CONCAT+++

```
function __libsqlite_group_concat_finalize($context, $rows)
```

This function add the GROUP_CONCAT to the SQLite database


+++REPLACE+++

```
function __libsqlite_replace($subject, $search, $replace)
```

This function add the REPLACE to the SQLite database


+++LPAD+++

```
function __libsqlite_lpad($input, $length, $char)
```

This function add the LPAD to the SQLite database


+++CONCAT+++

```
function __libsqlite_concat(...$args)
```

This function add the CONCAT to the SQLite database


+++CONCAT_WS+++

```
function __libsqlite_concat_ws(...$args)
```

This function add the CONCAT_WS to the SQLite database


+++UNIX_TIMESTAMP+++

```
function __libsqlite_unix_timestamp($date)
```

This function add the UNIX_TIMESTAMP to the SQLite database


+++FROM_UNIXTIME+++

```
function __libsqlite_from_unixtime($timestamp)
```

This function add the FROM_UNIXTIME to the SQLite database


+++YEAR+++

```
function __libsqlite_year($date)
```

This function add the YEAR to the SQLite database


+++MONTH+++

```
function __libsqlite_month($date)
```

This function add the MONTH to the SQLite database


+++WEEK+++

```
function __libsqlite_week($date, $mode = 0)
```

This function add the WEEK to the SQLite database


+++TRUNCATE+++

```
function __libsqlite_truncate($n, $d)
```

This function add the TRUNCATE to the SQLite database


+++DAY+++

```
function __libsqlite_day($date)
```

This function add the DAY to the SQLite database


+++DAYOFYEAR+++

```
function __libsqlite_dayofyear($date)
```

This function add the DAYOFYEAR to the SQLite database


+++DAYOFWEEK+++

```
function __libsqlite_dayofweek($date)
```

This function add the DAYOFWEEK to the SQLite database


+++HOUR+++

```
function __libsqlite_hour($date)
```

This function add the HOUR to the SQLite database


+++MINUTE+++

```
function __libsqlite_minute($date)
```

This function add the MINUTE to the SQLite database


+++SECOND+++

```
function __libsqlite_second($date)
```

This function add the SECOND to the SQLite database


+++MD5+++

```
function __libsqlite_md5($temp)
```

This function add the MD5 to the SQLite database


+++REPEAT+++

```
function __libsqlite_repeat($str, $count)
```

This function add the REPEAT to the SQLite database


+++FIND_IN_SET+++

```
function __libsqlite_find_in_set($str, $strlist)
```

This function add the FIND_IN_SET to the SQLite database


+++IF+++

```
function __libsqlite_if($condition, $value_if_true, $value_if_false)
```

This function add the IF to the SQLite database


+++POW+++

```
function __libsqlite_pow($base, $exp)
```

This function add the POW to the SQLite database


+++DATE_FORMAT+++

```
function __libsqlite_date_format($date, $format)
```

This function add the DATE_FORMAT to the SQLite database


+++NOW+++

```
function __libsqlite_now()
```

This function add the NOW to the SQLite database


++MySQL improved driver++

```
api/php/database/mysqli.php
```

This file implements the MySQL improved driver. This driver was coded later that the initial
mysql driver and contains lots of improvements respect to the old mysql driver. The old mysql
driver was removed in the PHP 7.0 release.


+++Database MySQL improved class+++

```
class database_mysqli
```

This class allow to SaltOS to connect to MySQL databases using the MySQL improved driver


+++Private link variable+++

```
private $link = null;
```

This private variable contains the link to the database


+++Constructor+++

```
public function __construct($args)
```

This public function is intended to stablish the connection to the database

- @args => is an array with key val pairs
- @host => the host for the connection
- @port => the port used for the connection
- @name => name of the database for the connection
- @user => user used to stablish the connection
- @pass => pass used to stablish the connection


Notes of this driver:

MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT are the same that PDO::ERRMODE_EXCEPTION
MYSQLI_USE_RESULT is the same that PDO::MYSQL_ATTR_USE_BUFFERED_QUERY = false


+++DB Check+++

```
public function db_check($query, $params = [])
```

This public function is intended to check that the query execution will not trigger an error

- @query => the query that you want to validate


+++DB Escape+++

```
public function db_escape($str)
```

This public function is intended to escape the special chars to sanitize the string to be used
in a sql query

- @str => the string that you want to sanitize


+++DB Query+++

```
public function db_query($query, ...$args)
```

This public function is intended to execute the query and returns the resultset

- @query => the query that you want to execute
- @fetch => the type of fetch that you want to use, can be auto, query, column or concat


Notes:

The fetch argument can perform an speed up in the execution of the retrieve action, and
can modify how the result is returned

auto: this fetch method try to detect if the resultset contains one or more columns, and
sets the fetch to column (if the resultset only contains one column) or to query (otherwise)

query: this fetch method returns all resultset as an array of rows, and each row contain the
pair of key val with the name of the field and the value of the field

column: this fetch method returns an array where each element is each value of the field of
the each row, this is useful when for example do you want to get all ids of a query, with
this method you can obtain an array with each value of the array is an id of the resultset

concat: this fetch method is an special mode intended to speed up the retrieve of large
arrays, this is useful when you want to get all ids of a query and you want to get a big
sized array, in this case, is more efficient to get an string separated by commas with all
ids instead of an array where each element is an id


+++DB Last Insert ID+++

```
public function db_last_insert_id()
```

This function returns the last insert id


+++DB Disconnect+++

```
public function db_disconnect()
```

This function close the database connection and sets the link to null


++PDO MsSQL driver++

```
api/php/database/pdo_mssql.php
```

This file implements the MySQL improved driver. This driver uses the dblib library to connect
with SQL servers.


+++Database PDO MsSQL class+++

```
class database_pdo_mssql
```

This class allow to SaltOS to connect to MsSQL databases using the PDO driver


+++Private link variable+++

```
private $link = null;
```

This private variable contains the link to the database


+++Constructor+++

```
public function __construct($args)
```

This public function is intended to stablish the connection to the database

- @args => is an array with key val pairs
- @host => the host for the connection
- @port => the port used for the connection
- @name => name of the database for the connection
- @user => user used to stablish the connection
- @pass => pass used to stablish the connection


+++DB Check+++

```
public function db_check($query, $params = [])
```

This public function is intended to check that the query execution will not trigger an error

- @query => the query that you want to validate


+++DB Escape+++

```
public function db_escape($str)
```

This public function is intended to escape the special chars to sanitize the string to be used
in a sql query

- @str => the string that you want to sanitize


Notes:

This driver adds a simple quotes at the beginning and at the finish of ths string, by this
reason this function returns the substr(1, -1) of the quoted string.


+++DB Query+++

```
public function db_query($query, ...$args)
```

This public function is intended to execute the query and returns the resultset

- @query => the query that you want to execute
- @fetch => the type of fetch that you want to use, can be auto, query, column or concat


Notes:

The fetch argument can perform an speed up in the execution of the retrieve action, and
can modify how the result is returned

auto: this fetch method try to detect if the resultset contains one or more columns, and
sets the fetch to column (if the resultset only contains one column) or to query (otherwise)

query: this fetch method returns all resultset as an array of rows, and each row contain the
pair of key val with the name of the field and the value of the field

column: this fetch method returns an array where each element is each value of the field of
the each row, this is useful when for example do you want to get all ids of a query, with
this method you can obtain an array with each value of the array is an id of the resultset

concat: this fetch method is an special mode intended to speed up the retrieve of large
arrays, this is useful when you want to get all ids of a query and you want to get a big
sized array, in this case, is more efficient to get an string separated by commas with all
ids instead of an array where each element is an id


+++DB Last Insert ID+++

```
public function db_last_insert_id()
```

This function returns the last insert id


+++DB Disconnect+++

```
public function db_disconnect()
```

This function close the database connection and sets the link to null


++PDO MySQL driver++

```
api/php/database/pdo_mysql.php
```

This file implements the MySQL improved driver. This is the recommended driver when you want
to use MySQL servers, it uses the PDO extension and alow to connect to MySQL servers with a
good performance.


+++Database PDO MySQL class+++

```
class database_pdo_mysql
```

This class allow to SaltOS to connect to MySQL databases using the PDO driver


+++Private link variable+++

```
private $link = null;
```

This private variable contains the link to the database


+++Constructor+++

```
public function __construct($args)
```

This public function is intended to stablish the connection to the database

- @args => is an array with key val pairs
- @host => the host for the connection
- @port => the port used for the connection
- @name => name of the database for the connection
- @user => user used to stablish the connection
- @pass => pass used to stablish the connection


+++DB Check+++

```
public function db_check($query, $params = [])
```

This public function is intended to check that the query execution will not trigger an error

- @query => the query that you want to validate


+++DB Escape+++

```
public function db_escape($str)
```

This public function is intended to escape the special chars to sanitize the string to be used
in a sql query

- @str => the string that you want to sanitize


Notes:

This driver adds a simple quotes at the beginning and at the finish of ths string, by this
reason this function returns the substr(1, -1) of the quoted string.


+++DB Query+++

```
public function db_query($query, ...$args)
```

This public function is intended to execute the query and returns the resultset

- @query => the query that you want to execute
- @fetch => the type of fetch that you want to use, can be auto, query, column or concat


Notes:

The fetch argument can perform an speed up in the execution of the retrieve action, and
can modify how the result is returned

auto: this fetch method try to detect if the resultset contains one or more columns, and
sets the fetch to column (if the resultset only contains one column) or to query (otherwise)

query: this fetch method returns all resultset as an array of rows, and each row contain the
pair of key val with the name of the field and the value of the field

column: this fetch method returns an array where each element is each value of the field of
the each row, this is useful when for example do you want to get all ids of a query, with
this method you can obtain an array with each value of the array is an id of the resultset

concat: this fetch method is an special mode intended to speed up the retrieve of large
arrays, this is useful when you want to get all ids of a query and you want to get a big
sized array, in this case, is more efficient to get an string separated by commas with all
ids instead of an array where each element is an id


+++DB Last Insert ID+++

```
public function db_last_insert_id()
```

This function returns the last insert id


+++DB Disconnect+++

```
public function db_disconnect()
```

This function close the database connection and sets the link to null


++PDO SQLite driver++

```
api/php/database/pdo_sqlite.php
```

This file implements the MySQL improved driver. This is the recommended driver when you want
to use SQLite3 files as database server and it uses the PDO extension to do it, this driver
solves the concurrence problem using POSIX semaphores, generally it is a good option for setups
that don't require a fulltext search optimizations suck as mroonga, intended for a personal
usage or demos.


+++Database PDO SQLite class+++

```
class database_pdo_sqlite
```

This class allow to SaltOS to connect to SQLite databases using the PDO driver


+++Private link variable+++

```
private $link = null;
```

This private variable contains the link to the database


+++Constructor+++

```
public function __construct($args)
```

This public function is intended to stablish the connection to the database

- @args => is an array with key val pairs
- @file => the file that contains the database


Notes:

This database allow to define external functions that can be used from the SQL language,
this is a great feature that allow to use SQLite as MySQL, and using this feature of the
database, this driver uses the libsqlite to add a lot of features found in MySQL and
used in a lot of queries by SaltOS


+++DB Check+++

```
public function db_check($query, $params = [])
```

This public function is intended to check that the query execution will not trigger an error

- @query => the query that you want to validate


+++DB Escape+++

```
public function db_escape($str)
```

This public function is intended to escape the special chars to sanitize the string to be used
in a sql query

- @str => the string that you want to sanitize


Notes:

This driver adds a simple quotes at the beginning and at the finish of ths string, by this
reason this function returns the substr(1, -1) of the quoted string.


+++DB Query+++

```
public function db_query($query, ...$args)
```

This public function is intended to execute the query and returns the resultset

- @query => the query that you want to execute
- @fetch => the type of fetch that you want to use, can be auto, query, column or concat


Notes:

The fetch argument can perform an speed up in the execution of the retrieve action, and
can modify how the result is returned

auto: this fetch method try to detect if the resultset contains one or more columns, and
sets the fetch to column (if the resultset only contains one column) or to query (otherwise)

query: this fetch method returns all resultset as an array of rows, and each row contain the
pair of key val with the name of the field and the value of the field

column: this fetch method returns an array where each element is each value of the field of
the each row, this is useful when for example do you want to get all ids of a query, with
this method you can obtain an array with each value of the array is an id of the resultset

concat: this fetch method is an special mode intended to speed up the retrieve of large
arrays, this is useful when you want to get all ids of a query and you want to get a big
sized array, in this case, is more efficient to get an string separated by commas with all
ids instead of an array where each element is an id


+++DB Last Insert ID+++

```
public function db_last_insert_id()
```

This function returns the last insert id


+++DB Disconnect+++

```
public function db_disconnect()
```

This function close the database connection and sets the link to null


++SQLite3 driver++

```
api/php/database/sqlite3.php
```

This file implements the MySQL improved driver. This is the recommended driver when you want
to use SQLite3 files as database server, this driver solves the concurrence problem using
POSIX semaphores, generally it is a good option for setups that don't require a fulltext
search optimizations suck as mroonga, intended for a personal usage or demos.


+++Database SQLite3 class+++

```
class database_sqlite3
```

This class allow to SaltOS to connect to SQLite databases using the SQLite3 driver


+++Private link variable+++

```
private $link = null;
```

This private variable contains the link to the database


+++Constructor+++

```
public function __construct($args)
```

This public function is intended to stablish the connection to the database

- @args => is an array with key val pairs
- @file => the file that contains the database


Notes:

This database allow to define external functions that can be used from the SQL language,
this is a great feature that allow to use SQLite as MySQL, and using this feature of the
database, this driver uses the libsqlite to add a lot of features found in MySQL and
used in a lot of queries by SaltOS


+++DB Check+++

```
public function db_check($query, $params = [])
```

This public function is intended to check that the query execution will not trigger an error

- @query => the query that you want to validate


+++DB Escape+++

```
public function db_escape($str)
```

This public function is intended to escape the special chars to sanitize the string to be used
in a sql query

- @str => the string that you want to sanitize


+++DB Query+++

```
public function db_query($query, ...$args)
```

This public function is intended to execute the query and returns the resultset

- @query => the query that you want to execute
- @fetch => the type of fetch that you want to use, can be auto, query, column or concat


Notes:

The fetch argument can perform an speed up in the execution of the retrieve action, and
can modify how the result is returned

auto: this fetch method try to detect if the resultset contains one or more columns, and
sets the fetch to column (if the resultset only contains one column) or to query (otherwise)

query: this fetch method returns all resultset as an array of rows, and each row contain the
pair of key val with the name of the field and the value of the field

column: this fetch method returns an array where each element is each value of the field of
the each row, this is useful when for example do you want to get all ids of a query, with
this method you can obtain an array with each value of the array is an id of the resultset

concat: this fetch method is an special mode intended to speed up the retrieve of large
arrays, this is useful when you want to get all ids of a query and you want to get a big
sized array, in this case, is more efficient to get an string separated by commas with all
ids instead of an array where each element is an id


+++DB Last Insert ID+++

```
public function db_last_insert_id()
```

This function returns the last insert id


+++DB Disconnect+++

```
public function db_disconnect()
```

This function close the database connection and sets the link to null


+Libraries+

++TODO++

```
api/php/lib/actions.php
```

TODO


+++Insert action+++

```
function insert($app, $data)
```

This action allow to insert registers in the database associated to
each app

TODO


+++Update action+++

```
function update($app, $id, $data)
```

This action allow to update registers in the database associated to
each app and requires the app, id, data and a valid token.

TODO


+++Delete action+++

```
function delete($app, $id)
```

This action allow to delete registers in the database associated to
each app

TODO


++Array to XML helper module++

```
api/php/lib/array2xml.php
```

This fie is a part of the most old files of the SaltOS, accomplish the task to convert an array
to an XML string, currently it is little used because the most important module compared to this
is the inverse xml2array module


+++Check Node Name+++

```
function __array2xml_check_node_name($name)
```

This function acts as helper of the array2xml function, is intended to
return if the node name is valid

- @name => the name that you want to validate


+++Check Attr Name+++

```
function __array2xml_check_node_attr($name)
```

This function acts as helper of the array2xml function, is intended to
return if the attribute name is valid

- @name => the name that you want to validate


+++Write Nodes array2xml helper+++

```
function __array2xml_write_nodes(&$array, $level = null)
```

This function acts as helper of the array2xml function, is intended to
return a string with the tree array

- @array => the tree array that you want to convert to XML
- @level => can be null to minify the output zero to indent the XML contents


+++Array to XML+++

```
function array2xml($array, $indent = false)
```

This function returns a string with the contents of array converted into a XML
language file, to do it, uses some helpers as __array2xml_* functions

- @array  => the array that contains the tree structure that you want to convert to XML
- @indent => a boolean to enable or disable the indent (the old minify) feature


++Make Table ASCII++

```
api/php/lib/ascii.php
```

This table is intended for debug purposes and is able to paint in ascii
mode the contents of a matrix


+++Make Table ASCII+++

```
function __ascii_make_table_ascii($array)
```

This table is intended for debug purposes and is able to paint in ascii
mode the contents of a matrix

- @rows    => the contents of the matrix to paint
- @head    => set to true if you want to use the first row as header
- @compact => set to true if you want to minify the ascii table


++Login functions++

```
api/php/lib/auth.php
```

This file contain all functions needed by the logins app


+++Authentication token action+++

```
function authtoken($user, $pass)
```

This file implements the login action, allowing to authenticate users using the pair
of login/password to validate the credentials and get a valid token to operate in SaltOS

- @user => username used in the authentication process
- @pass => password used in the authentication process


This action not requires a valid token, all valid tokens associated
to the user will be revoked when a new token is assigned, as the result of this action
is a flag that indicates the validity of the token, this action returns a json with the
status of te token instead of returns a json with an error in case of non validity


+++Deauthentication token action+++

```
function deauthtoken()
```

This file implements the logout action, allowing to deauthenticate users
using a valid token, for security reasons, the deauth action only can
be performed by the same actor that execute the login action

The unique requirement to execute this action is to have a valid token


+++Check token action+++

```
function checktoken()
```

This file implements the check action, allowing to check token's validity, the check
action only can be performed by the same actor that execute the login action

The unique requirement to execute this action is to have a token to be checked, as the
result of this action is a flag that indicates the validity of the token, this action
returns a json with the status of te token instead of returns a json with an error in
case of non validity


+++Authentication update action+++

```
function authupdate($oldpass, $newpass, $renewpass)
```

This file implements the update password action, allowing to authenticated
users by a token, and providing the old password to update a new password

- @oldpass   => Old password, must to validate the active password of the user
              associated to the token used in the action
- @newpass   => New password, must to be new, must to pass the score check and
              never must to be used in the system for the user
- @renewpass => The repeated new password, to prevent writing errors


This action requires a valid token associated to the user that wants to do
the password update


+++Score check+++

```
function score_check($newpass)
```

This function checks the score quality of the provided password

- @newpass => the password thay you want to check


+++Old password check+++

```
function oldpass_check($user_id, $oldpass)
```

This function checks that the provided password is valid for the user_id

- @user_id => the user_id to use in the check task
- @oldpass => the password to use in the check task


+++New password check+++

```
function newpass_check($user_id, $newpass)
```

This function checks that the provided password has never been used by the user_id

- @user_id => the user_id to use in the check task
- @newpass => the password to use in the check task


+++Old password disable+++

```
function oldpass_disable($user_id)
```

This function disable all passwords associated to the user_id

- @user_id => the user_id to use in the check task


+++New password insert+++

```
function newpass_insert($user_id, $newpass)
```

This function inserts a new password record to the database

- @user_id => the user_id to use in the insert task
- @newpass => the password to use in the insert task


Notes:

This function returns the created and expires timestamps


++Barcode helper module++

```
api/php/lib/barcode.php
```

This fie contains useful functions related to barcodes


+++BarCode image function+++

```
function __barcode_image($msg, $w, $h, $m, $s, $t)
```

This function allow to generate a barcode, you can pass the desired
message that you want to convert in barcode and it returns an image
with the data

- @msg => Contents of the barcode
- @w   => width of each unit's bar of the barcode
- @h   => height of the barcode (without margins and text footer)
- @m   => margin of the barcode (white area that surround the barcode)
- @s   => size of the footer text, not used if zero
- @t   => type of the barcode, C128 is the most common type used


Notes:

The normal behavior is returns a png image, but if something was wrong,
the function can returns an empty string


+++BarCode image png function+++

```
function __barcode_image_png($msg, $w, $h, $t)
```

This function allow to generate a barcode, you can pass the desired
message that you want to convert in barcode and it returns an image
with the data

- @msg => Contents of the barcode
- @w   => width of each unit's bar of the barcode
- @h   => height of the barcode (without margins and text footer)
- @t   => type of the barcode, C128 is the most common type used


Notes:

The normal behavior is returns a png image without margins and text,
but if something was wrong, the function can returns an empty string


+++BarCode image svg function+++

```
function __barcode_image_svg($msg, $w, $h, $t)
```

This function allow to generate a barcode, you can pass the desired
message that you want to convert in barcode and it returns an image
with the data

- @msg => Contents of the barcode
- @w   => width of each unit's bar of the barcode
- @h   => height of the barcode (without margins and text footer)
- @t   => type of the barcode, C128 is the most common type used


Notes:

The normal behavior is returns a svg image without margins and text,
but if something was wrong, the function can returns an empty string


++Browser helper module++

```
api/php/lib/browser.php
```

This file contain useful browser helper functions


+++Get Browser Platform Device Type+++

```
function get_browser_array($user_agent = null)
```

This function gets the browser, platform and device_type form the user_agent header


+++Get Browser Platform Device Type+++

```
function get_browser_string($user_agent = null)
```

This function gets the browser, platform and device_type form the user_agent header


++Captcha helper module++

```
api/php/lib/captcha.php
```

This fie contains useful functions related to captchas


+++Captcha Image+++

```
function __captcha_image($code, $args = [])
```

This function returns an image with the code drawed in a background that
contains white noise to prevent that robots read the code

- @code      => the code that you want to paint
- @width     => the width of the generated image
- @height    => the height of the generated image
- @letter    => the size of the letters of the generated image
- @number    => the size of the numbers of the generated image
- @angle     => the angle allowed to rotate the letters and numbers
- @color     => the color user to paint the code
- @bgcolor   => the background color of the image
- @fgcolor   => the color used to paint the letters of the background of the image
- @period    => parameter for the wave transformation
- @amplitude => parameter for the wave transformation
- @blur      => true or false to enable or disable the blur effect


Notes:

The main idea to program this captcha was obtained from this post:
- http://sentidoweb.com/2007/01/03/laboratorio-ejemplo-de-captcha.php


Too appear in ther posts if you search for it in google:
- http://www.google.es/search?q=captcha+alto_linea


+++Captcha Make Number function+++

```
function __captcha_make_number($length)
```

This function returns a random number of the desired length and as trick,
checks that the output is a prime number

- @length => the length of the desired output string


+++Captcha Make Math Operation function+++

```
function __captcha_make_math($length)
```

This function returns a random math operation of the desired length and
as trick, checks that the output operation is performed by prime numbers

- @length => the length of the desired output string


++Color helper module++

```
api/php/lib/color.php
```

This fie contains useful functions related to colors


+++Color To Dec function+++

```
function color2dec($color, $component)
```

This function is a helper that allow to get from a RGB hex color the value
in decimal of the specified component, useful to get the amount of color
red, green or blue in decimal base from an string

Is able to understand colors with the formats #abcdef, abcdef, #000, #fff

- @color     => The color that you want to parse
- @component => The component that you want to retrieve their value


++Control helper module++

```
api/php/lib/control.php
```

This fie contains useful functions related to the control and version system, they allow to
relationate registers with users and groups, and to add and retrieve the versions of a register


+++Make Control function+++

```
function make_control($app, $reg_id)
```

This function allow to insert and delete the control registers associacted
to any application and to any register of the application

- @app    => code of the application that you want to index
- @reg_id => register of the app that you want to index


Notes:

This function returns an integer as response about the control action:

- +1 => insert executed, this is because the app register exists and the control register not exists
- +2 => delete executed, this is because the app register not exists and the control register exists
- -1 => app not found, this is because the app requested not have a table in the apps config
- -2 => control table not found, this is because the has_control feature is disabled by dbstatic
- -3 => data not found, this is because the app register not exists and the control register not exists
- -4 => control exists, this is because the app register exists and the control register too exists


As you can see, negative values denotes an error and positive values denotes a successfully situation


+++TODO+++

```
function integrity()
```

TODO


++Cron utils helper module++

```
api/php/lib/cron.php
```

This fie contains useful functions related to cron operations


+++TODO+++

```
function __cron_compare($val, $now)
```

TODO


+++TODO+++

```
function __cron_is_now($minute, $hour, $day, $month, $dow)
```

TODO


+++TODO+++

```
function __cron_users($arg)
```

TODO


+++TODO+++

```
function cron_gc()
```

TODO


+++TODO+++

```
function cron_exec()
```

TODO


++Database schema helper module++

```
api/php/lib/dbschema.php
```

This fie contains useful functions related to database schema, allow to manage the entire database
schema, and too, allow to maintain contents of some tables using the dbstatic feature


+++DB Schema+++

```
function db_schema()
```

This function try to maintain the database structure, to do it, this feature uses the dbschema.xml
file to store the database structure.


+++DB Schema hash+++

```
function __dbschema_hash()
```

This function returns the hash used by db_schema


+++DB Schema check+++

```
function __dbschema_check()
```

This function returns the comparison between the old hash and the new hash


+++DB Static+++

```
function db_static()
```

This function try to maintain the database contents, to do it, this feature
uses the dbstatic.xml file to store the database contents that must to be
maintaned.

This version of the db_static allow you to use a comma separated values in
fields as "id", start by "id_" or end by "_id"


+++DB Static hash+++

```
function __dbstatic_hash()
```

This function returns the hash used by db_static


+++DB Static check+++

```
function __dbstatic_check()
```

This function returns the comparison between the old hash and the new hash


+++DB Static insert+++

```
function __dbstatic_insert($table, $row)
```

This function is a helper of previous function, is intended to be used by db_static and
allow to use a comma separated values in fields as "id", start by "id_" or end by "_id"

- @table => the table that you want to use in the insert process
- @row   => the row that you want to add in the table


Notes:

This feature allow to you to use comma separated lists of values, commonly used for id
fields as user_id, perms_id, or similar.


+++Get Tables from DB Schema+++

```
function get_tables_from_dbschema()
```

This function returns the tables from the DB Schema file


+++Get Fields from DB Schema+++

```
function get_fields_from_dbschema($table)
```

This function returns the fields from the DB Schema file

- @table => the table that you want to request the fields


+++Get Indexes from DB Schema+++

```
function get_indexes_from_dbschema($table)
```

This function returns the indexes from the DB Schema file

- @table => the table that you want to request the indexes


+++Get Ignores from DB Schema+++

```
function get_ignores_from_dbschema()
```

This function returns the ignores tables from the DB Schema file


+++Get Fulltext from DB Schema+++

```
function get_fulltext_from_dbschema()
```

This function returns the fulltext tables from the DB Schema file


+++Get Fkeys from DB Schema+++

```
function get_fkeys_from_dbschema($table)
```

This function returns the fkeys from the DB Schema file

- @table => the table that you want to request the fkeys


+++DB Schema helper+++

```
function __dbschema_helper($fn, $table)
```

This function is a helper for the previous functions, is intended to be used
to returns the tables of the DB Schema or the fields of a table

- @fn    => the caller function name
- @table => the table used by some features


+++DB Schema Auto Apps+++

```
function __dbschema_auto_apps($dbschema)
```

This function is a helper to the dbschema functions, to create an indexing table for each app

- @dbschema => the dbschema array


Notes:

This feature creates a table and try to use Mroonga storage engine with one field, the main
idea of this tables is to store all contents of the register to do quick searchs using a
fulltext search engine


+++DB Schema Auto Fkey+++

```
function __dbschema_auto_fkey($dbschema)
```

This function is a helper to the dbschema functions, to create an index for each fkey

- @dbschema => the dbschema array


Notes:

By default, MariaDB creates an index for each foreign key, but SQLite not does is by default
and for this reason, SaltOS creates an index automatically, to improve the performance

This function checks that the field not exists in the defined indexes to prevent error in duplicates
indexes


+++DB Schema Auto Name+++

```
function __dbschema_auto_name($dbschema)
```

This function is a helper to the dbschema functions, to auto name the indexes

- @dbschema => the dbschema array


Notes:

This function allow to specify indexes only specifying the fields that you want
to conform the index, but the engines as MariaDB and SQLite, requires that each
index have a unique name, and for this reason, we add this feature to automate
this part of the process

You can see how the name of the index is different for MySQL and SQLite, this is
because in MySQL, the name can be repeated in different tables, but in SQLite,
the name must be unique in the database


+++Get Apps From DBStatic+++

```
function get_apps_from_dbstatic()
```

This function returns the list of apps that have a table and field defined
in the dbstatic file


+++Get Tables From DBStatic+++

```
function get_tables_from_dbstatic()
```

This function returns the list of tables that have a table and field defined
in the dbstatic file


+++Get Field From DBStatic+++

```
function get_field_from_dbstatic($table, $field = 'field')
```

This function return the field associated to the table in the dbstatic
file and associated to the apps table

- @table => the table of the dbstatic that want to convert to field
- @field => the field name, field by default


Notes:

This function uses the special feature in the helper that allow to
use as table parameter an app code to retrieve the field, this is
useful if you want some field of the app table and you want to use
the app code instead of the app table to identify what row do you
want to use


+++DB Static helper+++

```
function __dbstatic_helper($fn, $table, $field)
```

This function is intended to act as helper of the dbstatic ecosystem, this
function can return the apps that contain table and field definitions and
too, can return the field associated to a apps table, useful for the
indexing feature

- @fn    => the caller function name
- @table => the table used by some features
- @field => the field used by some features


+++Manifest to dbstatic+++

```
function __manifest2dbstatic($files)
```

This function returns the equivalent dbstatic data using as input the contents
of the manifests files.

- @files => An array with all the manifests files


+++DB Schema Create Table+++

```
function __dbschema_create_table($tablespec)
```

This function returns the SQL needed to create the table defined in the
tablespec argument

- @tablespec => the specification for the create table, see the dbschema
              file to understand the tablespec structure


This function creates the table, supports the primary key, supports the
foreign key, and detect fulltext indexes with mroonga engines


+++DB Schema Alter Table+++

```
function __dbschema_alter_table($orig, $dest)
```

This function returns the alter table command

- @orig => source table
- @dest => destination table


+++DB Schema Insert From Select+++

```
function __dbschema_insert_from_select($dest, $orig)
```

This function returns the insert from select command

- @orig => source table
- @dest => destination table


+++DB Schema Drop Table+++

```
function __dbschema_drop_table($table)
```

This function returns the drop table command

- @table => table that you want to drop


+++DB Schema Create Index+++

```
function __dbschema_create_index($indexspec)
```

This function returns the SQL needed to create the index defined in the
indexspec argument

- @indexspec => the specification for the create index, see the dbschema
              file to understand the indexspec structure


This function creates the index, supports fulltext indexes


+++DB Schema Drop Index+++

```
function __dbschema_drop_index($index, $table)
```

This function returns the drop index command

- @index => index that you want to drop
- @table => table where the indes is part of


++TODO++

```
api/php/lib/depend.php
```

TODO


+++TODO+++

```
function check_dependencies($app, $id)
```

TODO


++Export helper module++

```
api/php/lib/export.php
```

This fie contains useful functions related to export data, allow to generate outputs in formats
suck as excel, csv, edi, json and xml


+++Export File main function+++

```
function export_file($args)
```

This function is intended to export data in the supported formats

- @type     => can be xml, csv, xls, xlsx, edi or json
- @data     => the matrix to export
- @sep      => separator char used only by csv format
- @eol      => enf of line char used by csv and xml format
- @encoding => charset used by csv and xml format
- @replace  => array with two elements, from and to, used to do replacements of the matrix values
- @escape   => array with two elements, char and mode, used to specify the escape character and the
             escape mode
- @title    => title used only by excel format
- @file     => local filename used to store the results
- @ext      => extension used for the filename if provided
- @wrap     => boolean argument used only for edi indentation
- @indent   => boolean argument used only for json indentation
- @prefn    => function executed between the load and the tree construction
- @notree   => boolean to enable or disable the tree2array feature
- @postfn   => function executed after the tree construction
- @novoid   => boolean to enable or disable the removevoid feature


If file argument is specified, void string is returned
If file argument is not specified, then they will returns all data


+++Export File XML+++

```
function __export_file_xml($matrix, $eol = "\n", $encoding = 'UTF-8')
```

This function is intended to export data in xml format

- @matrix   => the matrix to export
- @eol      => enf of line char
- @encoding => charset used


They will returns all data


+++Export File CSV+++

```
function __export_file_csv(
```

This function is intended to export data in csv format

- @matrix   => the matrix to export
- @sep      => separator char
- @eol      => enf of line char
- @encoding => charset used
- @replace  => array with two elements, from and to, used to do replacements of the matrix values
- @escape   => array with two elements, char and mode, used to specify the escape character and the
             escape mode


They will returns all data


+++Export File Excel+++

```
function __export_file_excel($matrix, $title = '', $type = 'Xlsx')
```

This function is intended to export data in excel format

- @matrix => the matrix to export
- @title  => title used in the excel file
- @type   => can be Xls or Xlsx


They will returns all data


+++Export File JSON+++

```
function __export_file_json($matrix, $indent = false)
```

This function is intended to export data in json format

- @matrix => the matrix to export
- @indent => boolean argument to enable or disable the indent feature


They will returns all data


+++Tree to Array+++

```
function __export_tree2array($array)
```

This function convert a tree into a 2D matrix, it's intended to convert
a tree structure into a csv, for example

- @array => the tree that you want to convert into a 2D matrix


+++Get Keys+++

```
function __export_getkeys($array)
```

This function tries to return an array with all the keys used internally
in the tree

- @array => the tree array that you want to process


++TODO++

```
api/php/lib/files.php
```

TODO


+++TODO+++

```
function check_files_old($app, $action, $id = null)
```

TODO


+++TODO+++

```
function check_files_new($app, $action)
```

TODO


+++Get cid+++

```
function files_cid($app, $id, $cid)
```

This function returns the requested attachment indentified by the cid argument

- @id  => id of the email
- @cid => the cid of the content requested


+++Get viewpdf+++

```
function files_viewpdf($app, $id, $cid)
```

This function returns the requested attachment indentified by the cid argument
in a pdf format for the viewpdf widget

- @id  => id of the email
- @cid => the cid of the content requested


+++Get download+++

```
function files_download($app, $id, $cid)
```

This function returns the requested attachment indentified by the cid argument
in an array format for the download feature

- @id  => id of the email
- @cid => the cid of the content requested


++Garbage collector helper module++

```
api/php/lib/gc.php
```

This fie contains useful functions related to the garbaging unused resources, currently only
implements the clear of temporary files


+++Garbage Collector Executor+++

```
function gc_exec()
```

This function tries to clean the directories of old files, the parameters
that this function uses are defined in the config file, the timeout is
getted from the server/cachetimeout config file key, too is able to detect
hidden files and remove except the special files as current directory,
parent directory and htaccess file


++GD utils helper module++

```
api/php/lib/gdlib.php
```

This fie contains useful functions related to the GD library


+++Compute width+++

```
function compute_width($text, $size)
```

This function uses the GD library to compute the width of a text,
can contains newlines and the returned value is the width of the
bounring box required to print the text using the font and size
specified

- @text => the text that you want to compute the width
- @size => the size used in the render process


Notes:

As the default font in saltos is the Atkinson Hyperlegible, in this
function was set as default font and you can not replace at the
moment


+++Image resize+++

```
function image_resize($data, $size)
```

This function is a helper for the html functions, and is intended to
get images less than 1000x1000 pixels, to do it, maintain the width and
height relation, the main idea is to get images scaled less that the size
parameter

- @data => the data of the image
- @size => the size used in the control (size x size)


++GeoIP helper module++

```
api/php/lib/geoip.php
```

This file contain useful geoip helper functions


+++Get GeoIP information+++

```
function get_geoip_array($remote_addr)
```

This function gets the geoip information an returns it


+++Get GeoIP information+++

```
function get_geoip_string($remote_addr)
```

This function gets the geoip information an returns it


++TODO++

```
api/php/lib/help.php
```

TODO


+++TODO+++

```
function detect_help_file($app, $lang)
```

TODO


++Import file helper module++

```
api/php/lib/import.php
```

This fie contains useful functions related to import contents using differents formats suck as
excel, csv, edi, json, xml and bytes. Too this module allow to manipulate data using the tree
array of the core of the SaltOS, allowing to add, modify and remove nodes, too can apply patch
of the memory data and paint arrays as ascii tables


+++Import File main function+++

```
function import_file($args)
```

This function is intended to import data in the supported formats

- @data     => contents used as data instead of file
- @file     => local filename used to load the data
- @type     => can be xml, csv, xls, bytes, edi or json
- @sep      => separator char used only by csv format
- @sheet    => sheet that must to be read
- @map      => map used as dictionary for each field, pos and length
- @offset   => the offset added to the start position in each map field
- @nomb     => boolean to disable or enable the multibyte support
- @novoid   => boolean to enable or disable the removevoid feature
- @prefn    => function executed between the load and the tree construction
- @notree   => boolean to enable or disable the array2tree feature
- @nodes    => an array with the fields that define each nodes used in the tree construction
- @nohead   => if the first row doesn't contains the header of the data, put this field to one
- @noletter => if you want to use numeric index instead of excel index, put this field to one
- @postfn   => function executed after the tree construction


This function returns an array with the loaded data from file
Can return a matrix or tree, depending the nodes parameter


+++UTF8 BOM helper+++

```
function __import_utf8bom($data)
```

This function remove the bom header of the string

- @data => the data that must to be checked


Returns the data without the bom characters


+++XML to Array+++

```
function __import_xml2array($file)
```

This function convert an xml into an array

- @file => the file that contains the xml


Returns an array with the contents of the xml


+++Special Chars helper+++

```
function __import_specialchars($arg)
```

This function is a helper used by the csv2array function

- @arg => a string or array


Returns the input with the expected replacements


+++CSV to Array helper+++

```
function __import_csv2array($file, $sep)
```

This function is a helper of the __import_xml2array

- @file => the filename and the sheet that do you want to retrieve
- @sep  => the separator field used in the csv file


Returns a matrix with the contents


+++XLS to Array helper+++

```
function __import_xls2array($file, $sheet)
```

This fuction can convert an excel file into a matrix structure, it has some additional features as:
- If the file exceds the 1Mbyte and the server has the xlsx2csv executable, it tries to convert the xslx
  to an excel to use less memory
- Do some internals trics to solve some knowed issues


- @file  => the filename and the sheet that do you want to retrieve
- @sheet => the second parameter can be a number or a sheet name


Returns a matrix with the contents


+++Bytes to Array helper+++

```
function __import_bytes2array($file, $map, $offset, $nomb)
```

This function can read files as blocks of bytes, they can use a map, can specify
an offset and can be used using multibyte if it is needed

- @file   => local filename used to load the data
- @map    => map used as dictionary for each field, pos and length
- @offset => the offset added to the start position in each map field
- @nomb   => boolean to disable or enable the multibyte support


Returns a matrix with the contents

Notes:

The map must be an array of strings of the follow form:
["field1;0;10", "field2;10;20", "field3;20;40"]


+++Edi to Array helper+++

```
function __import_edi2array($file)
```

This fuction can convert an edi file into a tree structure

- @file => local filename used to load the data


+++JSON to Array helper+++

```
function __import_json2array($file)
```

This fuction can convert an excel file into a tree structure

- @file => local filename used to load the data


+++Check Real Matrix helper+++

```
function __import_check_real_matrix($array)
```

This function checks that the argument is a matrix, to do this, checks
that the argument is an array, that all keys are numeric and that all
entries of the main array is another array, and for each another array,
checks that the keys are numeric and that all values are non arrays

- @array => the array to check


+++Remove Void helper+++

```
function __import_removevoid($array)
```

This function is able to remove an entire row or column if it is void

- @array => the array to fix


+++Array to Tree helper+++

```
function __import_array2tree($array, $nodes, $nohead, $noletter)
```

This function tries to convert the array into a tree using the nodes,
specification

- @array    => the matrix that you want to convert into a tree
- @nodes    => the dictionary used to the conversion, must to be an array with
             the fields used by each node, for example ["A,B,C","D,E,F"]
- @nohead   => set it to true to prevent the usage of the first row of the
             matrix as header, this option uses the letter as id of each
             element of the tree
- @noletter => set it to true to prevent the usage of letters, if the
             previous option is set to true


+++Array Intersect+++

```
function __import_array_intersect($data, $filter)
```

This function returns the same result that array_intersect_key($data,array_flip($filter))
maintaining the order of the filter array.

- @data   => the array that you want to apply the filter
- @filter => the array where obtain the keys to apply the filter


+++Array to Tree Set helper+++

```
function __import_array2tree_set(&$result, $parts)
```

This function tries to set values in a tree structure, to do it, it uses
the parts array that contains a list of paired keys and values used to move
by the tree setting the values of each pair of key val

- @result => the array where do you want to put the parts
- @parts  => an array with pairs of key val


+++Array to Tree Clean helper+++

```
function __import_array2tree_clean($array)
```

This function tries to clean the tree by setting an automatic indexes

- @array => the array to clean


+++Column to Name helper+++

```
function __import_col2name($n)
```

This function returns the name of the column from the position n

- @n => the position number


Notes:

This function was copied from:
- http://www.php.net/manual/en/function.base-convert.php#94874


+++Name to Column helper+++

```
function __import_name2col($a)
```

This function returns the position number of the column from the name

- @a => the column name


Notes:

This function was copied from:
- http://www.php.net/manual/en/function.base-convert.php#94874


+++Is Name helper+++

```
function __import_isname($name)
```

This function returns true if the name argument contains only valid letters
used in the name of the column

- @name => the name that you want to check


+++Cell to Column and Row helper+++

```
function __import_cell2colrow($cell)
```

This function extract the column part and the row part from a cell name

- @cell => the cell that you want to process


Notes:

This function tries to retusn an array with two elements, for example, for
the cell AX23, the function returns [AX,23]


++Make index helper module++

```
api/php/lib/indexing.php
```

This fie contains useful functions related to the indexing feature that internally uses the
mroonga engine to search in the fulltext string generated by this feature


+++Make Index main function+++

```
function make_index($app, $reg_id)
```

This function implements the make index feature of SaltOS, this consists
in a concatenation of fields and subqueries to retrieve all data related to
the tables involved in the desired application and the register reg_id

- @app    => code of the application that you want to index
- @reg_id => register of the app that you want to index


Notes:

This function returns an integer as response about the index action:

- +1 => insert executed, this is because the app register exists and the index register not exists
- +2 => update executed, this is because the app register exists and the index register too exists
- +3 => delete executed, this is because the app register not exists and the index register exists
- -1 => app not found, this is because the app requested not have a table in the apps config
- -2 => index table not found, this is because the has_index feature is disabled by dbstatic
- -3 => data not found, this is because the app register not exists and the indexting register not exists


As you can see, negative values denotes an error and positive values denotes a successfully situation


+++Make Index helper+++

```
function __make_index_helper($table, $id = '')
```

This function allow the make_index to retrieve all data of the fiels
and all data of the related fields of the related tables, this is done
by using the fkey information of the dbschema, this function uses some
features of the dbschema functions to get the fields, types, fkeys and
too, the dbstatic information of the app table

This function uses a cache technique to improve the performance, returns
an array with all fields and subqueries to allow to retrieve all data
related to the app register


+++Get Field helper+++

```
function __get_field_helper($table)
```

This function return the field associated to the table in the dbstatic
file and associated to the apps table

- @table => the table of the dbstatic that want to convert to field


Notes:

This function uses the dbschema.php library


+++Get Fkeys helper+++

```
function __get_fkeys_helper($table)
```

This function returns the fkeys from the DB Schema file

- @table => the table that you want to request the fkeys


Notes:

This function uses the dbschema.php library


+++TODO+++

```
function indexing_files()
```

TODO


+++TODO+++

```
function indexing_apps()
```

TODO


++Log helper module++

```
api/php/lib/log.php
```

This fie contains useful functions related to the log feature


+++Make Log function+++

```
function make_log($app, $log, $reg_ids, $extra_ids = '')
```

This function adds a log register to the associated log table for each
application.

- @app      => code of the application where you want to add the log
- @log      => the log message that you want to add to the log register
- @reg_id   => register ids of the app where you want to add the log
- @extra_id => extra ids of the app where you want to add the log


Notes:

This function returns an integer as response about the control action:

- +1 => insert executed, this is because the app register exists and the control register not exists
- -1 => app not found, this is because the app requested not have a table in the apps config
- -2 => log table not found, this is because the has_log feature is disabled by dbstatic


+++Make Log Bypass function+++

```
function make_log_bypass($app, $log, $data)
```

This function is intended to be used as wrapper between the caller and the
execute_query or execute_query_array function, the main idea is to do the
same that make_log but uses the reg_id from the array data, and this array
can be an array with the contents of one register with an id field, or an
array of rows where each item must contain an id field

- @app  => code of the application where you want to add the log
- @data => data with the register or registers of the app where you want to
         add the log, remember that an id field is needed
- @log  => the log message that you want to add to the log register


Notes:

This function always returns the input data


+++TODO+++

```
function get_logs($app, $reg_id)
```

TODO


+++Delete Log function+++

```
function del_log($app, $reg_id)
```

This function allow to delete the last log to a reg_id of an app, to do it,
the function requires to specify the app and reg_id

- @app    => code of the application that you want to delete the last log
- @reg_id => register of the app that you want to delete the last log


Notes:

This function returns an integer as response about the control action:

- +1 => delete executed, this is because the app register exists and they can delete the last register
- -1 => app not found, this is because the app requested not have a table in the apps config
- -2 => log table not found, this is because the has_version feature is disabled by dbstatic
- -3 => data not found, this is because the app register not exists and the version register not exists


As you can see, negative values denotes an error and positive values denotes a successfully situation


++Math utils helper module++

```
api/php/lib/math.php
```

This fie contains useful functions related to math operations


+++Sign function+++

```
function sign($n)
```

This function returns 1 for positive, -1 for negative and 0 for zero.

- @n => the number that you want to be processed


+++Is Prime Number+++

```
function is_prime($num)
```

This function is a detector of prime numbers, uses some optimizations and
ideas from www.polprimos.com, please, see the previous web to understand
the speedup of this function in the prime numbers validation

- @num => the number that you want to check if it is a primer numner


Notes:

See www.polprimos.com for understand this algorithm


++TODO++

```
api/php/lib/notes.php
```

TODO


+++TODO+++

```
function check_notes_old($app, $action, $id = null)
```

TODO


+++TODO+++

```
function check_notes_new($app, $action)
```

TODO


++Password helper module++

```
api/php/lib/password.php
```

This fie contains useful functions related to password, currently only publish one feature to check
the password strength, but is open to be used to add more password features if it is needed


+++Password Strength+++

```
function password_strength($pass)
```

This fucntion returns a number between 0 and 100 that try to categorize
the quality of the pass checked, this is useful to known if the new
password is a good option or maybe is needed to request another new
password

- @pass => password that do you want to check


++PDF helper module++

```
api/php/lib/pdf.php
```

This file contains useful functions related to PDF using tcpdf


+++TODO+++

```
class MyPDF extends TCPDF
```

TODO


+++TODO+++

```
public function Init()
```

TODO


+++TODO+++

```
public function set_header($arr, $row)
```

TODO


+++TODO+++

```
public function set_footer($arr, $row)
```

TODO


+++TODO+++

```
public function Header()
```

TODO


+++TODO+++

```
public function Footer()
```

TODO


+++TODO+++

```
public function render_footers()
```

TODO


+++TODO+++

```
public function check_y($offset = 0)
```

TODO


+++TODO+++

```
function __pdf_eval_value($input, $row, $pdf)
```

TODO


+++TODO+++

```
function __pdf_eval_array($array, $row, $pdf)
```

TODO


+++TODO+++

```
function __pdf_eval_explode($separator, $str, $limit = 0)
```

TODO


+++TODO+++

```
function __pdf_eval_pdftag($array, $row = [])
```

TODO


+++TODO+++

```
function pdf($file, $row = [])
```

TODO


+++TODO+++

```
function __pdf_all2pdf($input)
```

TODO


++Push utils helper module++

```
api/php/lib/push.php
```

This fie contains useful functions related to push feature


+++Push insert+++

```
function push_insert($type, $message)
```

This function adds an entry to the push system using the type and message

- @type    => the type (one of this: success, danger or event)
- @message => the desired message that you want to put in the queue


+++Push select+++

```
function push_select($timestamp)
```

This function returns the push data found after the timestamp used

- @timestamp => the timestamp used to begin the search


Notes:

- This function returns the entries found without repetitions, to be
  usefull, only uses the last entries removing the repeated entries and
  using only the type and message to detect repetitions


++QRCode helper module++

```
api/php/lib/qrcode.php
```

This fie contains useful functions related to QRCodes


+++QRCode image function+++

```
function __qrcode_image($msg, $s, $m, $l)
```

This function allow to generate a qrcode with the SaltOS logo embedded
in the center of the image, you can pass the desired message that you
want to convert in qrcode and it returns an image with the data

- @msg => Contents of the qrcode
- @s   => size of each pixel used in the qrcode
- @m   => margin of the qrcode (white area that that surround the qrcode)
- @l   => level error correction: L (low), M (medium), Q (better), H (best)


Notes:

The normal behavior is returns a png image, but if something was wrong,
the function can returns an empty string


+++QRCode image function+++

```
function __qrcode_image_png($msg, $s, $l)
```

This function allow to generate a qrcode with the SaltOS logo embedded
in the center of the image, you can pass the desired message that you
want to convert in qrcode and it returns an image with the data

- @msg => Contents of the qrcode
- @s   => size of each pixel used in the qrcode
- @l   => level error correction: L (low), M (medium), Q (better), H (best)


Notes:

The normal behavior is returns a png image without margins, but if something
was wrong, the function can returns an empty string


+++QRCode image function+++

```
function __qrcode_image_svg($msg, $s, $l)
```

This function allow to generate a qrcode with the SaltOS logo embedded
in the center of the image, you can pass the desired message that you
want to convert in qrcode and it returns an image with the data

- @msg => Contents of the qrcode
- @s   => size of each pixel used in the qrcode
- @l   => level error correction: L (low), M (medium), Q (better), H (best)


Notes:

The normal behavior is returns a svg image without margins, but if something
was wrong, the function can returns an empty string


++Score image helper module++

```
api/php/lib/score.php
```

This fie contains useful functions related to score images


+++Score Image function+++

```
function __score_image($score, $width, $height, $size)
```

This function generates an image with a gradient from red to yellos and
then, to green, depending of the score passed to the function, the params
allos to define the size of the image or the size of the font used to
write the score percent

- @score  => a number between 0 and 100
- @width  => the width of the generated image
- @height => the height of the generated image
- @size   => the size of the font of the generated image


++Security helper module++

```
api/php/lib/security.php
```

This file contain useful securiry helper functions


+++Get Browser Platform Device Type+++

```
function get_connection_detected($remote_addr, $user_agent = null)
```

This function gets the browser, platform and device_type form the user_agent header


++Setup helper module++

```
api/php/lib/setup.php
```

This file contains useful functions related to the setup process


+++Setup function+++

```
function setup()
```

This function allow to create the minimal user and group information to do SaltOS
usable by the admin user, only do things if the keys tables of the array are void,
too is able to maintain the integrity of the tbl_{users,groups}_apps_perms tables
by removing the unused registers, usefull when you modify the tbl_apps_perms rows


++Send file to trash++

```
api/php/lib/trash.php
```

This function tries to implement the send to trash feature, to do it, move the
requested files to the trash folder, execute the insert in the tbl_trash with
the new file and delete the file from the files app table.


+++Garbage Collector Trash+++

```
function gc_trash()
```

This function tries to clean the trash database of old files, the parameters
that this function uses is defined in the config file, only uses the timeout
that is getted from the server/trashtimeout


++Unoconv library++

```
api/php/lib/unoconv.php
```

This file contains all functions that allow conversions between formats like
docx, xlsx and more to pdf, too includes the ocr code that allow to get text
from images.


+++Unoconv to PDF+++

```
function unoconv2pdf($input)
```

This function allow to convert all input files into their equivalent pdf file

- @input => the file that you want to process


+++Unoconv to TXT+++

```
function unoconv2txt($input)
```

This function allow to convert all input files into their equivalent txt file

- @input => the file that you want to process


+++Unoconv list+++

```
function __unoconv_list()
```

This function returns an array with all suported extensions by libreoffice


+++PDF to TXT+++

```
function __unoconv_pdf2txt($input, $output)
```

This function convert files between pdf to txt using the pdftotext

- @input  => the file that you want to process
- @output => the file where you want to store the result


+++All to PDF+++

```
function __unoconv_all2pdf($input, $output)
```

This function convert all formats to pdf using libreoffice

- @input  => the file that you want to process
- @output => the file where you want to store the result


+++Convert+++

```
function __unoconv_convert($input, $output, $format)
```

This function convert between formats using libreoffice

- @input  => the file that you want to process
- @output => the file where you want to store the result
- @format => the desired destination format


+++Image to OCR+++

```
function __unoconv_img2ocr($file)
```

This file uses tesseract to extract all text from the file, if the file
is not a tiff image, then is converted to a tiff to be used as input in
the tesseract process.

- @file => the file that you want to process


+++PDF to OCR+++

```
function __unoconv_pdf2ocr($pdf)
```

This function uses the pdftoppm command to generate one image per page,
and then, extract the text of each page to finish the task.

- @pdf => the file that you want to process


+++TODO+++

```
function __unoconv_histogram($values, $usage1, $usage2)
```

TODO


+++TODO+++

```
function __unoconv_rotate($posx, $posy, $angle)
```

TODO


+++TODO+++

```
function __unoconv_node2attr($node)
```

TODO


+++TODO+++

```
function __unoconv_node2value($node)
```

TODO


+++TODO+++

```
function __unoconv_lines2matrix($lines, $width, $height)
```

TODO


+++TODO+++

```
function __unoconv_fixline($line, $pos1, $pos2, $pos3, $pos4)
```

TODO


+++TODO+++

```
function __unoconv_hocr2txt($hocr)
```

TODO


+++TODO+++

```
function __unoconv_substr($string, $start, $length, $reference)
```

TODO


+++TODO+++

```
function __unoconv_substr2d($page, $x1, $x2, $x3, $y1, $y2, $y3)
```

TODO


+++TODO+++

```
function __unoconv_remove_margins($page)
```

TODO


++Add upload file++

```
api/php/lib/upload.php
```

This function is intended to add files to the upload mecano

- @val  => is an associative array with the follow entries:
- @id   => the uniq id used to identify the file in the uploads system
- @name => local name of the file
- @size => size of the contents of the file
- @type => mime type of the file
- @data => the inline data in base64 form, with the mime type prefix


+++Del upload file+++

```
function del_upload_file($val)
```

This function is intended to del files in the upload mecano

- @val  => is an associative array with the follow entries:
- @id   => the uniq id used to identify the file in the uploads system
- @name => local name of the file
- @size => size of the contents of the file
- @type => mime type of the file
- @file => the inline data in base64 form, with the mime type prefix
- @hash => the hash of the binary data contents


+++Check upload file+++

```
function check_upload_file($val)
```

This function is intended to check files in the upload mecano

- @val     => is an associative array with the follow entries:
- @user_id => the user id intended to identify the property of the file
- @uniqid  => the uniq id used to identify the file in the uploads system
- @name    => local name of the file
- @size    => size of the contents of the file
- @type    => mime type of the file
- @file    => the inline data in base64 form, with the mime type prefix
- @hash    => the hash of the binary data contents


+++Rename upload file+++

```
function rename_upload_file($val, $app, $id)
```

This function copy the file contained in the val parameter to the
app folder and create the files register using the id argument

- @val => the array with the file data
- @app => the app code that identify the application
- @id  => the id of the application register


+++Garbage Collector Upload+++

```
function gc_upload()
```

This function tries to clean the upload database of old files, the parameters
that this function uses is defined in the config file, only uses the timeout
that is getted from the server/cachetimeout


++Version helper module++

```
api/php/lib/version.php
```

This fie contains useful functions related to the control and version system, they allow to
relationate registers with users and groups, and to add and retrieve the versions of a register


+++Make Version function+++

```
function make_version($app, $reg_id)
```

This function allow to add a new version to a reg_id of an app, to do it,
the function requires to specify the app, reg_id, the original data and
the new data to compute the diff patch that must to be stored in the data
field and create the register for the new version

To do this, the function validate the input data, checks the existence
of registers of data and versions, prepare the data patch to store, get
the old hash to do the blockchain, get the last ver_id and compute all
needed things to do the insert of the new version register

- @app    => code of the application that you want to add a new version
- @reg_id => register of the app that you want to add a new version


Notes:

This function returns an integer as response about the control action:

- +1 => insert executed, this is because the app register exists and they can add a new version register
- -1 => app not found, this is because the app requested not have a table in the apps config
- -2 => version table not found, this is because the has_version feature is disabled by dbstatic
- -3 => data not found and version not found, app register not exists and version register not exists
- -4 => data not found but version found, app register not exists and version register exists


As you can see, negative values denotes an error and positive values denotes a successfully situation


+++Get Version+++

```
function get_version($app, $reg_id, $ver_id = null)
```

This function allow to get an specific version of a register and app, intended
to get the data used in a specific version to compare with other versions and
to restore data to the requested version

- @app    => code of the application that you want to add a new version
- @reg_id => register of the app that you want to add a new version
- @ver_id => the version that you want to get


Notes:

This function is not a simple select of the register that matches with the
ver_id requested, it does an accumulative merge to get the register data
in the moment where the version will be stored, to do it, they must to
restore versions from 1 to ver_id, and must to discard the next versions

This function returns an array or an integer as response about the control action:

- -1 => app not found, this is because the app requested not have a table in the apps config
- -2 => version table not found, this is because the has_version feature is disabled by dbstatic
- -3 => data not found, this is because the version requested not exists


As you can see, negative values denotes an error and positive values denotes a successfully situation


+++Delete Version function+++

```
function del_version($app, $reg_id)
```

This function allow to delete the last version to a reg_id of an app, to do it,
the function requires to specify the app and reg_id

- @app    => code of the application that you want to add a new version
- @reg_id => register of the app that you want to add a new version


Notes:

This function returns an integer as response about the control action:

- +1 => delete executed, this is because the app register exists and they can delete the last register
- -1 => app not found, this is because the app requested not have a table in the apps config
- -2 => version table not found, this is because the has_version feature is disabled by dbstatic
- -3 => data not found, this is because the app register not exists and the version register not exists


As you can see, negative values denotes an error and positive values denotes a successfully situation


+Javascript+

++Application helper module++

```
web/js/app.js
```

This fie contains useful functions related to the main application, at the end of this file you
can see the main code that launch the application to be executed from the browser


+++Application helper object+++

```
saltos.app = {};
```

This object stores all application functions and data


+++Modal function+++

```
saltos.app.modal = (title, message, extra = {})
```

This function tries to implement a modal box, the main difference between the tipical alert
is that this alert allow to you to specify the title and a more complex message, but it only
shows one button to close it.

- @title   => title of the modal dialog
- @message => message of the modal dialog
- @extra   => object with array of buttons and color


+++Toast function+++

```
saltos.app.toast = (title, message, extra = {})
```

This function tries to implement a toast notice.

- @title   => title of the toast
- @message => message of the toast
- @extra   => object with array of buttons and color


+++Show error helper+++

```
saltos.app.show_error = error
```

This function allow to show a modal dialog with de details of an error


+++Check response helper+++

```
saltos.app.check_response = response
```

This function is intended to process the response received by ajax requests and returns
if an error is detected in the response.


+++Send request helper+++

```
saltos.app.send_request = hash
```

This function allow to send requests to the server and process the response


+++TODO+++

```
saltos.app.__cache = {};
```

TODO


+++Process response helper+++

```
saltos.app.prefetch_cache = (responses)
```

This function process the responses received by the send request


+++Process response helper+++

```
saltos.app.process_response = async response
```

This function process the responses received by the send request


+++Source helper+++

```
saltos.app.__source_helper = field
```

This function is intended to provide an asynchronous sources for a field, using the source attribute,
you can program an asynchronous ajax request to retrieve the data used to create the field.

This function is used in the fields of type table, alert, card and chartjs, the call of this function
is private and is intended to be used as a helper from the builders of the previous types opening
another way to pass arguments.

- @id     => the id used to set the reference for to the object
- @type   => the type used to set the type for to the object
- @source => data source used to load asynchronously the contents of the table (header, data,
           footer and divider)
- @height => the height used as style.height parameter
- @label  => this parameter is used as text for the label


Notes:

At the end of the object replacement, the load event is triggered to the old object to notify
that the update was finished.


+++Get data+++

```
saltos.app.get_data = full
```

This function retrieves the data of the fields in the current layout. to do this it uses
the saltos.form.__form.fields that contains the list of all used fields in the layout, this
function can retrieve all fields or only the fields that contains differences between the
original data and the current data.

- @full => boolean to indicate if you want the entire form or only the differences


+++Get data ids helper+++

```
saltos.app.__get_data_ids_helper = data
```

This function allow to retrieve the needed ids in the fields used as template

- @data => the contents of the object with data


Notes:

The main idea of this function is to add the id fields if it is needed, for example
if some field of the template is modified and their value contains a different value
that void.


+++Get data parse helper+++

```
saltos.app.__get_data_parser_helper = data
```

This function allow to join in an object the values that share the same prefix part of
the key, for example, if you have an object with two ventries (a.a and a.b), then the
resulted value will be an object a with two entries (a and b).

- @data => the contents of the object with data


Notes:

This function is used to allow the specification of multiples parameters, for example,
in the navbar widget where the widget expects an object for the brand configuration, too
is used by get_data to separate in a more pretty structure some fields as the details used
in the invoices.


+++Checkbox ids+++

```
saltos.app.checkbox_ids = obj
```

Retrieve the selected checkboxes contained in an obj, useful for the checkboxes
that appear in the bootstrap table widget.

- @obj => the object that contains the checkboxes, generally the table widget


+++Check form+++

```
saltos.app.check_required = ()
```

This function tries to check if all required fields contain data, if the required field are
right, the is-valid class will be applied to all required elements and true is returned,
otherwise the is-invalid class will be added to the void required elements and false is
returned.


+++Form disabled+++

```
saltos.app.form_disabled = bool
```

This function disables all elements of the form, it is intended to be used when you need
to do screen for view mode.


+++Ajax helper+++

```
saltos.app.ajax = args
```

This function uses the saltos.core.ajax to implement the ajax feature, and in
this scope, tries to simplify the needed configuration by provide a compound of
defined features and code, intended to process the responses, the errors, to
add the token, the lang.

- @url     => url of the ajax call
- @success => callback function for the success action (optional)
- @error   => callback function for the error action (optional)
- @abort   => callback function for the abort action (optional)
- @data    => data used in the body of the request
- @proxy   => add the Proxy header with the value passed, intended to be used by the SaltOS PROXY
- @loading => enable or disable the loading feature, true by default


+++Online message+++

```
window.addEventListener('online', event
```

This function show a message when navigator detects an online/offline change


+++Offline message+++

```
window.addEventListener('offline', event
```

This function show a message when navigator detects an online/offline change


+++Main app code+++

```
window.addEventListener('load', async event
```

This is the code that must to be executed to initialize all requirements of this module


++Authentication helper module++

```
web/js/auth.js
```

This file contains all needed code to do authentications with all features suck as the
main authentication using a user and password pair, the checktoken and the deauthtoken
to control it.


+++Authentication helper object+++

```
saltos.authenticate = {};
```

This object stores all authentication functions to get access, check tokens to maintain
the access and the deauthtoken to close the access


+++Authenticate token function+++

```
saltos.authenticate.authtoken = async (user, pass)
```

This function uses the authtoken action to try to authenticate an user with the user/pass
credentials passed by argument.

- @user => username used to the authentication process
- @pass => password used to the authentication process


+++Check token function+++

```
saltos.authenticate.checktoken = async ()
```

This function uses the checktoken action to check the validity of the current token.


+++De-authenticate token function+++

```
saltos.authenticate.deauthtoken = async ()
```

This function uses the deauthtoken action to try to de-authenticate an user with the token
credentials.


+++Authenticate update function+++

```
saltos.authenticate.authupdate = (oldpass, newpass, renewpass)
```

This function is intended to be used in the profile feature to allow the password change
by the user.

- @oldpass   => old password used to validate the correctness of the transaction
- @newpass   => new password used to update the old password
- @renewpass => repite the new password used to update the old password


++Backup & Autosave helper module++

```
web/js/backup.js
```

This module provides the needed tools to implement the backup & autosave feature


+++Form backup helper+++

```
saltos.backup = {};
```

This object stores the needed structure to allocate the forms backups with all their
data and the functions needed to do and restore the backups to the main __form object.

Notes:

This object is intended to store more forms that one, usefull when driver uses the same
screen to allocate lists and forms that contains fields for the search engine or fields
for the create or edit features.


+++Backup object+++

```
saltos.backup.__forms = {};
```

This object stores the backup data


+++Save feature+++

```
saltos.backup.save = key
```

This action performs a backup using the specified key

- @key => the key selector that you want to use.


+++Restore feature+++

```
saltos.backup.restore = key
```

This action performs the restoration action using the specified key, if the
key is not found, then empty fields and templates are used for the restoration

- @key => the key selector that you want to use.


+++Selector helper+++

```
saltos.backup.__selector_helper = key
```

This function allow to search the forms contexts stored in the backup, allow to
do queries like two,one or top+one, in each case, the result will be an array
with the ids of the found items uwing the selector trick.

All actions that uses this selector, are able to understand some expressions like comma
and plus, the follow examples shown how runs the selector in the restore feature:

- @two,one => this example is intended to restore the two context if it is found, otherwise
tries to restore the one context, otherwise a void context is set.


- @top+one => this example is intended to restore two contexts in one context, intender to
load the context of the search list that can be contained in the top and one containers.


- @key => the key selector that you want to use.


+++Autosave feature object+++

```
saltos.autosave = {};
```

This object stores all functions used by the autosave feature

Notes:

The autosave feature uses the init, save, restore, clear and purge functions, and
workflow of the operation will be start using the init to initialize the key, then
the save to store the data of the key context, the restore will be used when a new
screen is loaded to load the stored data, the clear will remove the data and the
purge will remove the old entries, act as a garbage collector

As an additional feature, this module uses the storage with the timestamp, this
usage allow to detect old entries and purge it.


+++Init+++

```
saltos.autosave.init = (key, hash = saltos.hash.get())
```

This function checks that the key not exists and creates a void entry, used by
save to allow the storage of data.

- @key  => the key selector that you want to use.
- @hash => optional hash used in the current action.


+++Save+++

```
saltos.autosave.save = (key, hash = saltos.hash.get())
```

This function save the key context data in the storage, only apply if previously
an init is executed.

- @key  => the key selector that you want to use.
- @hash => optional hash used in the current action.


+++Restore+++

```
saltos.autosave.restore = (key, hash = saltos.hash.get())
```

This function restore the key context data of the storage, only apply if data is found
and if data contains real data, not a void object

- @key  => the key selector that you want to use.
- @hash => optional hash used in the current action.


+++Clear+++

```
saltos.autosave.clear = (key, hash = saltos.hash.get())
```

This function remove the key context data in the storage, apply in all cases

- @key  => the key selector that you want to use.
- @hash => optional hash used in the current action.


+++Purge+++

```
saltos.autosave.purge = (key, hash = saltos.hash.get())
```

This function purge the void and old data, to do it, checks if data exists
and if it is void, in this case the element will be removed.

As an additional feature, uses the saltos.storage.purgeWithTimestamp to maintain
clean the localStorage by purging old entries.

- @key  => the key selector that you want to use.
- @hash => optional hash used in the current action.


++Bootstrap helper module++

```
web/js/bootstrap.js
```

This fie contains useful functions related to the bootstrap widgets, allow to create widgets and
other plugins suck as plots or rich editors


+++Bootstrap helper object+++

```
saltos.bootstrap = {};
```

This object stores all bootstrap functions and data


+++Form fields constructor+++

```
saltos.bootstrap.field = field
```

This function and their helpers, allow the creation of the interface using the bootstrap
widgets, the types that can be called are the follow:

- @div         => id, class, style
- @container   => id, class, style
- @row         => id, class, style
- @col         => id, class, style
- @text        => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @hidden      => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, color, OE, OC
- @integer     => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @float       => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @color       => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @date        => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @time        => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @datetime    => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @textarea    => id, class, PL, value, DS, RO, RQ, AF, AK, rows, tooltip, label, color, height, OC
- @ckeditor    => id, class, PL, value, DS, RO, RQ, AF, AK, rows, label, color, height, OC
- @codemirror  => id, class, PL, value, DS, RO, RQ, AF, AK, rows, mode, label, color, height, OC
- @iframe      => id, class, src, srcdoc, height, label, color
- @select      => id, class, DS, RQ, AF, AK, rows, multiple, size, value, tooltip, label, color, OC
- @multiselect => id, class, DS, RQ, AF, AK, rows, multiple, size, value, multiple, tooltip, label, color
- @checkbox    => id, class, DS, RO, AK, label, value, tooltip, color, OC
- @switch      => id, class, DS, RO, AK, label, value, tooltip, color, OC
- @button      => id, class, DS, AF, AK, label, onclick, tooltip, color, autoclose
- @password    => id, class, PL, value, DS, RO, RQ, AF, AK, tooltip, label, color, OE, OC
- @file        => id, class, DS, RQ, AF, AK, multiple, tooltip, label, color, OC
- @link        => id, DS, AK, value, onclick, tooltip, label, color
- @label       => id, class, label, tooltip
- @image       => id, class, value, alt, tooltip, width, height, label, color
- @excel       => id, class, data, rowHeaders, colHeaders, minSpareRows, contextMenu, rowHeaderWidth,
                colWidths, label, color
- @pdfjs       => id, class, value, label, color
- @table       => id, class, header, data, footer, value, label, color
- @alert       => id, class, title, text, body, value, label, color
- @card        => id, image, alt, header, footer, title, text, body, value, label, color
- @chartjs     => id, mode, data, value, label, color
- @tags        => id, class, PL, value, DS, RO, RQ, AF, AK, datalist, tooltip, label, color, OC
- @onetag      => id, class, PL, value, DS, RO, RQ, AF, AK, datalist, tooltip, label, color, OC
- @gallery     => id, class, label, images, color
- @placeholder => id, color, height, label
- @list        => id, class, header, extra, data, footer, onclick, active, disabled, label
- @tabs        => id, tabs, label, content, active, disabled, label
- @pills       => id, tabs, label, content, active, disabled, label
- @vpills      => id, tabs, label, content, active, disabled, label
- @accordion   => id, flush, multiple, items, label
- @jstree      => id, open, onclick, data


Notes:

To do more small the previous list, we have used the follow abreviations:

- @PL => placeholder
- @DS => disabled
- @RO => readonly
- @RQ => required
- @AF => autofocus
- @AK => accesskey
- @OE => onenter
- @OC => onchange


The saltos.bootstrap.__field object is part of this constructor and act with the constructor
as a helper, the idea is that the user must to call the constructor and the helpers are
only for internal use.


+++Form_field constructor helper object+++

```
saltos.bootstrap.__field = {};
```

This object allow to the constructor to use a rational structure for a quick access of each helper


+++Div constructor helper+++

```
saltos.bootstrap.__field.div = field
```

This function returns an object of the type class by default, you can pass the class
argument in the field object to specify what kind of class do you want to use.

- @id    => the id used by the object
- @class => the class used in the div object
- @style => the style used in the div object


Notes:

As special feature for div containes suck as cols, rows and containers, the unused arguments of fields
are set as data-bs-{subfield} in the object to be accesed from the obj directly, this allow to set for
example the data-bs-title or other parameter in a div container to be used futher


+++Container constructor helper+++

```
saltos.bootstrap.__field.container = field
```

This function returns an object of the container-fluid class by default, you can pass the class
argument in the field object to specify what kind of container do you want to do.

- @id    => the id used by the object
- @class => the class used in the div object
- @style => the style used in the div object


+++Row constructor helper+++

```
saltos.bootstrap.__field.row = field
```

This function returns an object of the row class by default, you can pass the class argument
in the field object to specify what kind of row do you want to do.

- @id    => the id used by the object
- @class => the class used in the div object
- @style => the style used in the div object


+++Col constructor helper+++

```
saltos.bootstrap.__field.col = field
```

This function returns an object of the col class by default, you can pass the class argument
in the field object to specify what kind of col do you want to do.

- @id    => the id used by the object
- @class => the class used in the div object
- @style => the style used in the div object


+++HR constructor helper+++

```
saltos.bootstrap.__field.hr = field
```

This function returns an object of the type class by default, you can pass the class
argument in the field object to specify what kind of class do you want to use.

- @id    => the id used by the object
- @class => the class used in the div object
- @style => the style used in the div object


+++Text constructor helper+++

```
saltos.bootstrap.__field.text = field
```

This function returns an input object of type text, you can pass the same arguments
that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


+++Hidden constructor helper+++

```
saltos.bootstrap.__field.hidden = field
```

This function returns an input object of type hidden, you can pass the same arguments
that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


Notes:

This function allow the previous parameters but for hidden inputs, only id
and value are usually used, in some cases can be interesting to use the
class to identify a group of hidden input


+++Integer constructor helper+++

```
saltos.bootstrap.__field.integer = field
```

This function returns an input object of type integer, you can pass the same arguments
that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


Notes:

This widget requires the imask library and can be loaded automatically using the require
feature:

- @lib/imaskjs/imask.min.js


+++Float constructor helper+++

```
saltos.bootstrap.__field.float = field
```

This function returns an input object of type float, you can pass the same arguments
that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


Notes:

This widget requires the imask library and can be loaded automatically using the require
feature:

- @lib/imaskjs/imask.min.js


+++Color constructor helper+++

```
saltos.bootstrap.__field.color = field
```

This function returns an input object of type color, you can pass the same
arguments that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


Notes:

Ths color input launch a warning if value is not in the format #rrggbb,
for this reason it is set to #000000 if value is void


+++Date constructor helper+++

```
saltos.bootstrap.__field.date = field
```

This function returns an input object of type date, you can pass the same arguments
that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


+++Time constructor helper+++

```
saltos.bootstrap.__field.time = field
```

This function returns an input object of type time, you can pass the same arguments
that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


+++Datetime constructor helper+++

```
saltos.bootstrap.__field.datetime = field
```

This function returns an input object of type datetime, you can pass the same arguments
that for the input object of type text

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected


+++Textarea constructor helper+++

```
saltos.bootstrap.__field.textarea = field
```

This function returns a textarea object with the autogrow plugin enabled

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @height      => the height used as style.minHeight parameter
- @onchange    => the function executed when onchange event is detected


Notes:

This widget requires the autoheight library and can be loaded automatically using the require
feature:

- @lib/autoheight/autoheight.min.js


+++Ckeditor constructor helper+++

```
saltos.bootstrap.__field.ckeditor = field
```

This function returns a textarea object with the ckeditor plugin enabled

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @height      => the height used as style.minHeight parameter
- @onchange    => the function executed when onchange event is detected


Notes:

This widget requires the ckeditor library and can be loaded automatically using the require
feature:

- @lib/ckeditor/ckeditor.min.js


The returned object contains a textarea with two new properties like ckeditor and set,
the first contains the ckeditor object and the second is a function used to update the
value of the ckeditor, intended to load new data.


+++Codemirror constructor helper+++

```
saltos.bootstrap.__field.codemirror = field
```

This function returns a textarea object with the codemirror plugin enabled

- @mode        => used to define the mode parameter of the codemirror
- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @label       => this parameter is used as text for the label
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @height      => the height used as style.minHeight parameter
- @onchange    => the function executed when onchange event is detected
- @indent      => enables the indent feature, only available for xml, json, css and sql


Notes:

This widget requires the codemirror library and can be loaded automatically using the require
feature:

- @lib/codemirror/codemirror.min.css
- @lib/codemirror/codemirror.min.js


The returned object contains a textarea with two new properties like codemirror and set,
the first contains the codemirror object and the second is a function used to update the
value of the codemirror, intended to load new data.


+++TODO+++

```
saltos.bootstrap.__indent_helper = (str, mode)
```

TODO


+++Iframe constructor helper+++

```
saltos.bootstrap.__field.iframe = field
```

This function returns an iframe object, you can pass the follow arguments:

- @id     => the id used by the object
- @src    => the value used as src parameter
- @srcdoc => the value used as srcdoc parameter
- @class  => allow to add more classes to the default form-control
- @height => the height used as style.minHeight parameter
- @label  => this parameter is used as text for the label
- @color  => the color of the widget (primary, secondary, success, danger, warning, info, none)


Notes:

This function allow to put contents in the srcdoc, as an extra feature, this content is
embedded with a doctype with html, head and body, includes the default saltos font and
to provide a security layer, this function creates an iframe with a sandbox and add to
the srcdoc a meta to configure the CSP that must apply to the contents


+++Select constructor helper+++

```
saltos.bootstrap.__field.select = field
```

This function returns a select object, you can pass the follow arguments:

- @id        => the id used by the object
- @class     => allow to add more classes to the default form-select
- @disabled  => this parameter raise the disabled flag
- @required  => this parameter raise the required flag
- @autofocus => this parameter raise the autofocus flag
- @multiple  => this parameter enables the multiple selection feature of the select
- @size      => this parameter allow to see the options list opened with n (size) entries
- @value     => the value used to detect the selected option
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter
- @rows      => this parameter contains the list of options, each option must be an object
              with label and value entries
- @label     => this parameter is used as text for the label
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onchange  => the function executed when onchange event is detected


+++Multiselect constructor helper+++

```
saltos.bootstrap.__field.multiselect = field
```

This function returns a multiselect object, you can pass the follow arguments:

- @id        => the id used by the object
- @class     => allow to add more classes to the default form-select
- @disabled  => this parameter raise the disabled flag
- @required  => this parameter raise the required flag
- @size      => this parameter allow to see the options list opened with n (size) entries
- @value     => the value used as src parameter
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter
- @rows      => this parameter contains the list of options, each option must be an object
              with label and value entries
- @label     => this parameter is used as text for the label
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @separator => the separator string used to split and join the values
- @onchange  => the function executed when onchange event is detected


Notes:

This widget is created joinin 2 selects and 2 buttons, the user must get the value
using the hidden input that is builded using the original id passed by argument.

TODO: detected a bug with this widget in chrome in mobile browsers


+++Checkbox constructor helper+++

```
saltos.bootstrap.__field.checkbox = field
```

This function returns a checkbox object, you can pass the follow arguments:

- @id        => the id used by the object
- @class     => allow to add more classes to the default form-check
- @disabled  => this parameter raise the disabled flag
- @readonly  => this parameter raise the readonly flag
- @required  => this parameter raise the required flag
- @label     => this parameter is used as label for the checkbox
- @value     => this parameter is used to check or unckeck the checkbox, the value
              must contain a number that raise as true or false in the if condition
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onchange  => the function executed when onchange event is detected


Notes:

This widget returns their value by setting a zero or one (0/1) value on the value of the input.


+++Switch constructor helper+++

```
saltos.bootstrap.__field.switch = field
```

This function returns a switch object, you can pass the follow arguments:

- @id        => the id used by the object
- @class     => allow to add more classes to the default form-check and form-switch
- @disabled  => this parameter raise the disabled flag
- @readonly  => this parameter raise the readonly flag
- @label     => this parameter is used as label for the switch
- @value     => this parameter is used to check or unckeck the switch, the value
              must contain a number that raise as true or false in the if condition
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onchange  => the function executed when onchange event is detected


Notes:

This widget uses the checkbox constructor


+++Button constructor helper+++

```
saltos.bootstrap.__field.button = field
```

This function returns a button object, you can pass the follow arguments:

- @id        => the id used by the object
- @class     => allow to add more classes to the default form-select
- @disabled  => this parameter raise the disabled flag
- @autofocus => this parameter raise the autofocus flag
- @label     => label to be used as text in the contents of the buttons
- @onclick   => callback function that is executed when the button is pressed
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @collapse  => a boolean to enable or disable the collapse feature in the button
- @target    => the id of the element controlled by the collapse feature
- @addbr     => this special feature adds a void label with a new line tag to align the button with
              the other elements that are label+widget


Notes:

The buttons adds the focus-ring classes to use this new feature that solves issues suck as
hidden focus when you try to focus a button inside a modal, for example.


+++Password constructor helper+++

```
saltos.bootstrap.__field.password = field
```

This function returns an input object of type password, you can pass some arguments as:

- @id           => the id used by the object
- @class        => allow to add more classes to the default form-control
- @placeholder  => the text used as placeholder parameter
- @value        => the value used as value parameter
- @disabled     => this parameter raise the disabled flag
- @readonly     => this parameter raise the readonly flag
- @required     => this parameter raise the required flag
- @autofocus    => this parameter raise the autofocus flag
- @tooltip      => this parameter raise the title flag
- @accesskey    => the key used as accesskey parameter
- @label        => this parameter is used as text for the label
- @color        => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter      => the function executed when enter key is pressed
- @onchange     => the function executed when onchange event is detected
- @autocomplete => set to false to enable the hiddens passwords trick


Notes:

This widget add an icon to the end of the widget with an slashed eye, this allow to
see the entered password to verify it, in reality, this button swaps the input between
password and text type, allowing to do visible or not the contents of the input

Setting the field.autocomplete=false enable the feature that tries to disable the
autocomplete provided by the browsers password adding the autocomplete="new-password"


+++File constructor helper+++

```
saltos.bootstrap.__field.file = field
```

This function returns an input object of type password, you can pass some arguments as:

- @id        => the id used by the object
- @class     => allow to add more classes to the default form-control
- @disabled  => this parameter raise the disabled flag
- @required  => this parameter raise the required flag
- @autofocus => this parameter raise the autofocus flag
- @multiple  => this parameter raise the multiple flag, intended to select more files at time
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter
- @label     => this parameter is used as text for the label
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onchange  => the function executed when onchange event is detected


Notes:

This control allow to select file from the tradicional input, and automatically, send it
to the server using the addfiles action, add a row in the widget's table to show information
about the new file and allow too to delete it using the trash button.

To get the data, the controls store each file information in each added row of the table and
in addition, too join all information in a data structure of the input of type file.

The difference between this control and the older controls is that they send the files to
the server and store the information related to the file on the server to be processed after
the real upload action.


+++Link constructor helper+++

```
saltos.bootstrap.__field.link = field
```

This function creates a field similar of text but with the appearance of a link using a button,
the object can receive the follow arguments:

- @id        => the id used by the object
- @class     => allow to add more classes to the default form-select
- @disabled  => this parameter raise the disabled flag
- @autofocus => this parameter raise the autofocus flag
- @label     => label to be used as text in the contents of the buttons
- @onclick   => callback function that is executed when the button is pressed
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @collapse  => a boolean to enable or disable the collapse feature in the button
- @target    => the id of the element controlled by the collapse feature
- @addbr     => this special feature adds a void label with a new line tag to align the button with
              the other elements that are label+widget


Notes:

This object is not a real link, it's a button that uses the btn-link class to get the link
appearance


+++Label constructor helper+++

```
saltos.bootstrap.__field.label = field
```

This function returns a label object, you can pass some arguments as:

- @id      => the id used to set the reference for to the object
- @class   => allow to add more classes to the default form-label
- @label   => this parameter is used as text for the label
- @tooltip => this parameter raise the title flag


+++Image constructor helper+++

```
saltos.bootstrap.__field.image = field
```

This function returns an image object, you can pass some arguments as:

- @id      => the id used to set the reference for to the object
- @class   => allow to add more classes to the default img-fluid
- @value   => the value used as src parameter
- @alt     => this parameter is used as text for the alt parameter
- @tooltip => this parameter raise the title flag
- @label   => this parameter is used as text for the label
- @width   => this parameter is used as width for the image
- @height  => this parameter is used as height for the image
- @color   => the color of the widget (primary, secondary, success, danger, warning, info, none)


+++Excel constructor helper+++

```
saltos.bootstrap.__field.excel = field
```

This function creates and returns an excel object, to do this they use the handsontable library,
currently this library uses a privative license, by this reason, we are using the version 6.2.2
that is the latest release published using the MIT license.

This widget can receive the following arguments:

- @id             => the id used to set the reference for to the object
- @class          => allow to set the class to the div object used to allocate the widget
- @data           => this parameter must contain a 2D matrix with the data that you want to show
                   in the sheet
- @rowHeaders     => can be an array with the headers that you want to use instead the def numbers
- @colHeaders     => can be an array with the headers that you want to use instead the def letters
- @minSpareRows   => can be a number with the void rows at the end of the sheet
- @contextMenu    => can be a boolean with the desired value to allow or not the provided
                   context menu of the widget
- @rowHeaderWidth => can be a number with the width of the headers rows
- @colWidths      => can be an array with the widths of the headers cols
- @label          => this parameter is used as text for the label
- @color          => the color of the widget (primary, secondary, success, danger, warning, info, none)


Notes:

You can get the values after to do changes by accessing to the data of the div used to create
the widget.

This widget requires the handsontable library and can be loaded automatically using the require
feature:

- @lib/handsontable/handsontable.full.min.css
- @lib/handsontable/handsontable.full.min.js


+++Pdfjs constructor helper+++

```
saltos.bootstrap.__field.pdfjs = field
```

This function creates and returns a pdfviewer object, to do this they use the pdf.js library.

- @id     => the id used to set the reference for to the object
- @class  => allow to set the class to the div object used to allocate the widget
- @src    => the file that contains the pdf document
- @srcdoc => the data that contains the pdf document
- @label  => this parameter is used as text for the label
- @color  => the color of the widget (primary, secondary, success, danger, warning, info, none)


Notes:

This widget requires the pdfjs library and can be loaded automatically using the require
feature:

- @lib/pdfjs/pdf.min.mjs
- @lib/pdfjs/pdf.worker.min.mjs


The last file (the worker) is loaded by the library and not by SaltOS, is for this reason
that this file not appear in the next requires

Change scale causes issues in scrollTop when pdfjs is used inside a modal, to prevent this,
the two updates to the pdfViewer.currentScaleValue = 'update' will add a control to fix
that modal scrollTop is the same.


+++Table constructor helper+++

```
saltos.bootstrap.__field.table = field
```

Returns a table using the follow params:

- @id       => the id used to set the reference for to the object
- @class    => allow to add more classes to the default table table-striped table-hover
- @header   => array with the header to use
- @data     => 2D array with the data used to mount the body table
- @footer   => array with the footer to use
- @checkbox => add a checkbox in the first cell of each row, for mono or multi selection
- @dropdown => a boolean value to force the usage of the dropdown feature, void for auto detection
- @label    => this parameter is used as text for the label
- @color    => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @nodata   => text used when no data is found
- @actions  => each row of the data can contain an array with the actions of each row


Each action can contain:

- @app     => the application that must be used to check the permissions
- @action  => the accion that must to be used to check the permissions
- @value   => the text used as label in the button of the action
- @icon    => the icon used in the button of the action
- @tooltip => the tooltip used in the button of the action
- @onclick => the onclick function that receives as argument the arg to access the action


Notes:

This function defines the yellow color used for the hover and active rows.

The header field must be an object with the labels, types, aligns, ..., of each field,
if the header is ommited, then the data will be painted using the default order of the
data without filters, the recomendation is to use header to specify which fields must
to be painted, the order, the type and the alignment.

The actions will be added using a dropdown menu if more than one action appear in the
the row data, the idea of this feature is to prevent that the icons uses lot of space
of the row data, and for this reason, it will define the dropdown variable that enables
or not the contraction feature

The elements of the data cells can contains an object with the field specification used
to the saltos.bootstrap.field constructor, it is useful to convert some fields to inputs
instead of simple text, too is able to use the type attribute in the header specification
to identify if you want to use a column with some special type as for example, the icons


+++Alert constructor helper+++

```
saltos.bootstrap.__field.alert = field
```

This component allow to set boxes type alert in the contents, only requires:

- @id    => the id used to set the reference for to the object
- @class => allow to add more classes to the default alert
- @title => title used in the body of the card, not used if void
- @text  => text used in the body of the card, not used if void
- @body  => this option allow to specify an specific html to the body of the card, intended
          to personalize the body's card
- @close => boolean to specify if you want to add the dismissible option to the alert
- @label => this parameter is used as text for the label
- @color => the color of the widget (primary, secondary, success, danger, warning, info, none)


Note:

I have added the dismissible option using the close attribute, too I have added a modification
for the style to allow the content to use the original size of the alert, in a future, I don't
know if I maintain this or I remove it, but at the moment, this is added by default


+++Card constructor helper+++

```
saltos.bootstrap.__field.card = field
```

This functions creates a card with a lot of options:

- @id     => the id used to set the reference for to the object
- @image  => image used as top image in the card, not used if void
- @alt    => alt text used in the top image if you specify an image
- @header => text used in the header, not used if void
- @footer => text used in the footer, not used if void
- @title  => title used in the body of the card, not used if void
- @text   => text used in the body of the card, not used if void
- @body   => this option allow to specify an specific html to the body of the card, intended
           to personalize the body's card
- @label  => this parameter is used as text for the label
- @color  => the color of the widget (primary, secondary, success, danger, warning, info, none)


+++Chart.js constructor helper+++

```
saltos.bootstrap.__field.chartjs = field
```

This function creates a chart using the chart.js library, to do this requires de follow arguments:

- @id    => the id used by the object
- @mode  => to specify what kind of plot do you want to do: can be bar, line, doughnut, pie
- @data  => the data used to plot the graph, see the data argument used by the graph.js library
- @label => this parameter is used as text for the label


Notes:

To be more practice and for stetic reasons, I'm adding to all datasets the borderWidth = 1

This widget requires the chartjs library and can be loaded automatically using the require
feature:

- @lib/chartjs/chart.umd.min.js


+++Tags constructor helper+++

```
saltos.bootstrap.__field.tags = field
```

This function creates a text input that allow to manage tags, each tag is paint as a badge
and each tag can be deleted, the result is stored in a text using a comma separated values

- @id          => the id used by the object
- @value       => comma separated values
- @datalist    => array with options for the datalist, used as autocomplete for the text input
- @label       => this parameter is used as text for the label
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @separator   => the separator string used to split and join the tags
- @onchange    => the function executed when onchange event is detected
- @create      => allow to specify if the widget can create new items


Notes:

This widget contains a datalist with ajax autoload, this allow to send requests
to the desired path to retrieve the contents of the datalist for the autocomplete,
this request uses an historical keyword that can be retrieved in the json/term

This widget uses the tom-select plugin, more info in their project website:
- https://tom-select.js.org/


+++One tag constructor helper+++

```
saltos.bootstrap.__field.onetag = field
```

This function creates a select that allow to be used as a text input like a select widget and allow
to create new items writing directly inside of the widget.

- @id          => the id used by the object
- @value       => the value of this field
- @datalist    => array with options for the datalist, used as autocomplete for the text input
- @label       => this parameter is used as text for the label
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @accesskey   => the key used as accesskey parameter
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onchange    => the function executed when onchange event is detected
- @create      => allow to specify if the widget can create new items


Notes:

This widget contains a datalist with ajax autoload, this allow to send requests
to the desired path to retrieve the contents of the datalist for the autocomplete,
this request uses an historical keyword that can be retrieved in the json/term

This widget uses the tom-select plugin, more info in their project website:
- https://tom-select.js.org/


+++TODO+++

```
saltos.bootstrap.__iframe_srcdoc_helper = html
```

TODO


+++Datalist helper+++

```
saltos.bootstrap.__datalist_helper = datalist
```

This function is a helper function used by the tags and onetag widgets
and is intended to be used as load function by the tomselect library.

- @datalist => the original datalist that can be an string or an object


+++Value helper+++

```
saltos.bootstrap.__value_helper = (value, separator)
```

This function is a helper function used by the tags widget and is intended
to be used to convert a string into an array using the separator for split.

- @value     => the original value that must to be processed
- @separator => the separator string used in the split


+++Gallery constructor helper+++

```
saltos.bootstrap.__field.gallery = field
```

This function returns a gallery object, you can pass some arguments as:

- @id     => the id used to set the reference for to the object
- @class  => allow to add more classes to the default img-fluid
- @label  => this parameter is used as text for the label
- @images => the array with images, each image can be a string or object
- @color  => the color of the widget (primary, secondary, success, danger, warning, info, none)


This widget requires venobox, masonry and imagesloaded

This widget requires the venobox, masonry and imagesloaded libraries and can be loaded
automatically using the require feature:

- @lib/venobox/venobox.min.css
- @lib/venobox/venobox.min.js
- @lib/masonry/masonry.pkgd.min.js
- @lib/imagesloaded/imagesloaded.pkgd.min.js


+++Placeholder helper+++

```
saltos.bootstrap.__field.placeholder = field
```

This function returns a grey area that uses all space with the placeholder glow effect

- @id     => id used in the original object, it must be replaced when the data will be available
- @color  => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @height => the height used as style.height parameter
- @label  => this parameter is used as text for the label


+++List widget constructor helper+++

```
saltos.bootstrap.__field.list = field
```

Returns a list widget using the follow params:

- @id       => the id used to set the reference for to the object
- @class    => allow to add more classes to the default list-group
- @onclick  => this parameter allow to enable or disable the buttons in the list
- @data     => 2D array with the data used to mount the list
- @truncate => this parameter add the text-truncate to all texts of the items
- @checkbox => add a checkbox in the first cell of each row, for mono or multi selection
- @nodata   => text used when no data is found
- @label    => this parameter is used as text for the label


Each item in the data can contain:

- @header   => string with the header to use
- @body     => string with the data to use
- @footer   => string with the footer to use
- @onclick  => the onclick function that receives as argument the url to access the action
- @url      => this parameter is used as argument for the onclick function
- @active   => this parameter raise the active flag
- @disabled => this parameter raise the disabled flag
- @actions  => this parameter allow to recicle the actions feature of the list action
- @id       => the id used to set the reference for each checkbox


As an extra fields, the widget allow to provide multiple texts and icons

- @header_text  => an small text added at the end of the same line of the header
- @header_icon  => an small icon added at the end of the same line of the header
- @header_color => the color used in the previous small text and icon
- @body_text    => an small text added at the end of the same line of the body
- @body_icon    => an small icon added at the end of the same line of the body
- @body_color   => the color used in the previous small text and icon
- @footer_text  => an small text added at the end of the same line of the footer
- @footer_icon  => an small icon added at the end of the same line of the footer
- @footer_color => the color used in the previous small text and icon


Notes:

The first onclick parameter is used to raise the construction of the widget and items,
depending of this parameter, the function uses a dir or an ul element to do the list


+++Tabs widget constructor helper+++

```
saltos.bootstrap.__field.tabs = field
```

Returns a tabs widget using the follow params:

- @id    => the id used to set the reference for to the object
- @items => 2D array with the data used to mount the tab and content
- @label    => this parameter is used as text for the label


Each item in the tabs can contain:

- @label    => string with the text label to use in the tab button
- @content  => string with the content to be used in the content area
- @active   => this parameter raise the active flag
- @disabled => this parameter raise the disabled flag


+++Pills widget constructor helper+++

```
saltos.bootstrap.__field.pills = field
```

Returns a tabs widget using the follow params:

- @id    => the id used to set the reference for to the object
- @items => 2D array with the data used to mount the tab and content
- @label    => this parameter is used as text for the label


Each item in the tabs can contain:

- @label    => string with the text label to use in the tab button
- @content  => string with the content to be used in the content area
- @active   => this parameter raise the active flag
- @disabled => this parameter raise the disabled flag


+++V-Pills widget constructor helper+++

```
saltos.bootstrap.__field.vpills = field
```

Returns a tabs widget using the follow params:

- @id    => the id used to set the reference for to the object
- @items => 2D array with the data used to mount the tab and content
- @label    => this parameter is used as text for the label


Each item in the tabs can contain:

- @label    => string with the text name to use in the tab button
- @content  => string with the content to be used in the content area
- @active   => this parameter raise the active flag
- @disabled => this parameter raise the disabled flag


+++Accordion widget constructor helper+++

```
saltos.bootstrap.__field.accordion = field
```

Returns an accordion widget using the follow params:

- @id       => the id used to set the reference for to the object
- @flush    => if true, add the accordion-flush to the widget
- @multiple => if true, allow to have open multiple items at same time
- @items    => 2D array with the data used to mount the accordion and content
- @label    => this parameter is used as text for the label


Each item in the tabs can contain:

- @label    => string with the text label to use in the tab button
- @content  => string with the content to be used in the content area
- @active   => this parameter raise the active flag


+++JS Tree constructor helper+++

```
saltos.bootstrap.__field.jstree = field
```

This function returns a jstree object using the follow parameters:

- @id      => the id used to set the reference for to the object
- @class    => allow to add more classes to the default table table-striped table-hover
- @open    => the open boolean that open all nodes
- @onclick => the callback that receives the id as argument of the selected item
- @nodata   => text used when no data is found
- @label    => this parameter is used as text for the label
- @data    => the data used to make the tree, must to be an array with nodes


Each node must contain the follow items:

- @id       => the id of the node (used in the onclick callback)
- @text     => the text of the node
- @children => an array with the nodes childrens


+++Dropdown constructor helper+++

```
saltos.bootstrap.__field.dropdown = field
```

This function returns a dropdown object, you can pass the follow arguments:

- @id        => the id used by the object
- @class     => allow to add more classes to the default btn-group
- @disabled  => this parameter raise the disabled flag
- @label     => label to be used as text in the contents of the buttons
- @onclick   => callback function that is executed when the button is pressed
- @split     => to use a split button instead of single button
- @tooltip   => this parameter raise the title flag
- @icon      => the icon used in the main button
- @accesskey => the key used as accesskey parameter
- @color     => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @menu      => with this option, you can specify an array with the contents of the dropdown menu


- @label     => label of the menu
- @icon      => icon of the menu
- @disabled  => this boolean allow to disable this menu entry
- @active    => this boolean marks the option as active
- @onclick   => the callback used when the user select the menu
- @divider   => you can set this boolean to true to convert the element into a divider
- @tooltip   => this parameter raise the title flag
- @accesskey => the key used as accesskey parameter


Notes:

The tooltip can not be applied to the dropdown button because causes an internal error,
in this case, the tooltip only are applied in the first button of the split button and
all items of the menu, as brief, tootip only can be applied in all real actions buttons
and not in the dropdown button that opens the real dropdown menu


+++Private text constructor helper+++

```
saltos.bootstrap.__text_helper = field
```

This function returns an input object of type text, you can pass some arguments as:

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onenter     => the function executed when enter key is pressed
- @onchange    => the function executed when onchange event is detected
- @autosave    => allow to disable the autosave feature for this field, true by default


Notes:

This function is intended to be used by other helpers of the form_field constructor


+++Private textarea constructor helper+++

```
saltos.bootstrap.__textarea_helper = field
```

This function returns a textarea object, you can pass the follow arguments:

- @id          => the id used by the object
- @class       => allow to add more classes to the default form-control
- @placeholder => the text used as placeholder parameter
- @value       => the value used as value parameter
- @disabled    => this parameter raise the disabled flag
- @readonly    => this parameter raise the readonly flag
- @required    => this parameter raise the required flag
- @autofocus   => this parameter raise the autofocus flag
- @tooltip     => this parameter raise the title flag
- @color       => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @onchange    => the function executed when onchange event is detected
- @autosave    => allow to disable the autosave feature for this field, true by default


Notes:

This function is intended to be used by other helpers of the form_field constructor


+++Private tooltip constructor helper+++

```
saltos.bootstrap.__tooltip_helper = obj
```

This function is intended to enable the tooltip in the object, too it try to do some
extra features: program that only show the tooltip when hover and hide when will get
the focus or get the click event

- @obj => the object that you want to enable the tooltip feature


+++Private tooltip hide helper+++

```
saltos.bootstrap.__tooltip_hide = ()
```

This function is intended to hide all running tooltips, it's used when some widgets
replaces the old elements by new elements, if the tooltip is show when the transition
happens, it's necessary to remove it to prevent a blocking elements in the user
interface.


+++Label helper+++

```
saltos.bootstrap.__label_helper = field
```

This function is a helper for label field, it is intended to returns the label object
or a void string, this is because if no label is present in the field argument, then
an empty string is returned, in the reception of the result, generally this is added
to an object and it is ignored because an empty string is not an element, this thing
is used by the optimizer to removes the unnecessary envelopment

- @field => the field that contains the label to be added if needed


+++Label Combine+++

```
saltos.bootstrap.__label_combine = (field, old)
```

This function combine the label with the object, to do it, tries to create a new
container object to put the label and the passed object, and then tries to optimize
to detect if the label is void

- @field => the field that contains the label
- @old   => the object


Notes:

This function acts as helper to add a label by the constructors that not implement
any specific label container, in the other cases, each constructor must to implement
their code because each case is different


+++Onclick helper+++

```
saltos.bootstrap.__onclick_helper = (obj, fn)
```

This function is a helper function that adds the onclick event listener to the obj
using the correct way to do it, to do it, checks the type of fn.

- @obj   => the object where you want to add the onclick event
- @fn    => the function that must be executed when onclick


+++Onchange helper+++

```
saltos.bootstrap.__onchange_helper = (obj, fn)
```

This function is a helper function that adds the onchange event listener to the obj
using the correct way to do it, to do it, checks the type of fn.

- @obj   => the object where you want to add the onchange event
- @fn    => the function that must be executed when onchange


+++Onenter helper+++

```
saltos.bootstrap.__onenter_helper = (obj, fn)
```

This function adds the event and detects the enter key in order to execute fn

- @obj => the object that you want to enable the onenter feature
- @fn  => the function executed when the onenter is raised


+++Menu constructor helper+++

```
saltos.bootstrap.menu = args
```

This function creates a menu intended to be used in navbar, nabs and tabs

- @class => the class used in the main ul element
- @menu  => an array with the follow elements:


- @label             => label of the menu
- @id                => id used in the button element
- @icon              => icon of the menu
- @disabled          => this boolean allow to disable this menu entry
- @active            => this boolean marks the option as active
- @onclick           => the callback used when the user select the menu
- @dropdown_menu_end => this trick allow to open the dropdown menu from the end to start
- @menu              => with this option, you can specify an array with the contents of the dropdown menu


- @label    => label of the menu
- @id       => id used in the button element
- @icon     => icon of the menu
- @disabled => this boolean allow to disable this menu entry
- @active   => this boolean marks the option as active
- @onclick  => the callback used when the user select the menu
- @divider  => you can set this boolean to true to convert the element into a divider


+++Navbar constructor helper+++

```
saltos.bootstrap.navbar = args
```

This component creates a navbar intended to be used as header

- @id    => the id used by the object
- @brand => contains an object with the label, image, width and height to be used
- @color => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @pos   => position of the navbar, can be fixed-top, fixed-bottom, sticky-top, sticky-bottom
- @class => class added to the navbar item


- @label  => text used in the brand
- @image  => filename of the brand image
- @alt    => alt text used in the brand image
- @width  => width of the brand image
- @height => height of the brand image
- @class  => class added to the navbar-brand item


- @items => contains an array with the objects that will be added to the collapse


Notes:

If you want to use an image that uses all height of the navbar, you can set the class and
brand.class to py-0, the main idea is to use a combination of paddings with a brand to
gets a navbar of 56px of height


+++Modal constructor helper object+++

```
saltos.bootstrap.__modal = {};
```

This object is used to store the element and the instance of the modal


+++Modal constructor helper+++

```
saltos.bootstrap.modal = args
```

This function creates a bootstrap modal and open it, offers two ways of usage:

1) you can pass a string to get a quick action

- @close   => this string close the current modal
- @isopen  => this string is used to check if some modal is open at the moment


2) you can pass an object with the follow items, intended to open a new modal

- @id      => the id used by the object
- @class   => allow to add more classes to the default dialog
- @title   => title used by the modal
- @close   => text used in the close button for aria purposes
- @body    => the content used in the modal's body
- @footer  => the content used in the modal's footer
- @static  => forces the modal to be static (prevent close by clicking outside the modal or
            by pressing the escape key)
- @color   => the color of the widget (primary, secondary, success, danger, warning, info, none)


Returns a boolean that indicates if the modal can be open or not

Notes:

This modal will be destroyed (instance and element) when it closes, too is important
to undestand that only one modal is allowed at each moment.

Body and footer allow to use a string containing a html fragment or an object, and
the footer too detects that the string contains something different to void, and if
void content is detected, then the footer is removed.

As an extra bonus, this widget has some tricks to improve the style of the footer, as
you can see in the modal-footer part by removing the border and the top padding.


+++Offcanvas constructor helper object+++

```
saltos.bootstrap.__offcanvas = {};
```

This object is used to store the element and the instance of the offcanvas


+++Offcanvas constructor helper+++

```
saltos.bootstrap.offcanvas = args
```

This function creates a bootstrap offcanvas and open it, offers two ways of usage:

1) you can pass a string to get a quick action

- @close  => this string close the current offcanvas
- @isopen => this string is used to check if some offcanvas is open at the moment


2) you can pass an object with the follow items, intended to open a new offcanvas

- @id       => the id used by the object
- @pos      => allow to specify the position of the offcanvac (start, end, top or bottom)
- @title    => title used by the offcanvas
- @close    => text used in the close button for aria purposes
- @body     => the content used in the offcanvas's body
- @static   => forces the offcanvas to be static (prevent close by clicking outside the
             offcanvas or by pressing the escape key)
- @backdrop => to configure the backdrop feature (true or false)
- @keyboard => to configure the keyboard feature (true or false)
- @color    => the color of the widget (primary, secondary, success, danger, warning, info, none)
- @resize   => the resize allow to the offcanvas to resize the contents of the screen to prevent
             offcanvas from hiding things


Returns a boolean that indicates if the offcanvas can be open or not

Notes:

This offcanvas will be destroyed (instance and element) when it closes, too is important
to undestand that only one offcanvas is allowed at each moment.

Body allow to use a string containing a html fragment or an object, as the modal body.

The resize option only works with start and end positions, too you can use left or right
as replacements for start and end positions, the resize will be disabled in top or bottom
positions.


+++Toast constructor helper+++

```
saltos.bootstrap.toast = args
```

This function creates a bootstrap toast and show it, and can accept the follow params:

- @id       => the id used by the object
- @class    => allow to add more classes to the default toast
- @title    => title used by the toast
- @subtitle => small text used by the toast
- @close    => text used in the close button for aria purposes
- @body     => the content used in the toast's body
- @color    => the color of the widget (primary, secondary, success, danger, warning, info, none)


Returns a boolean that indicates if the toast can be created (see the hash note)

Notes:

The toast will be destroyed (instance and element) when it closes.

All toasts are added to a toast-container placed in the body of the document, this container
is created automatically if it not exists when the first toast need it.

Each toast includes a hash to prevent the creation of repeated toasts.

Body allow to use a string containing a html fragment or an object, as the modal body.


+++Accesskey listener+++

```
window.addEventListener('keydown', event
```

This function is intended to improve the default accesskey in the object by
adding features suck as combinations of keys like ctrl+shift+f or ctrl+delete

- @obj => the object that you want to enable the accesskey feature


+++Window match media+++

```
saltos.bootstrap.window_match_media = window.matchMedia('(prefers-color-scheme: dark)');
```

This function returns an object intended to monitorize the bs_theme


+++Set data_bs_theme+++

```
saltos.bootstrap.set_data_bs_theme = e
```

This function sets the data_bs_theme attribute to enable or disable the dark bs theme


+++Set bs theme+++

```
saltos.bootstrap.set_bs_theme = theme
```

This function sets the bs theme

- @theme => Can be auto, light or dark


+++Set css theme+++

```
saltos.bootstrap.set_css_theme = theme
```

This function sets the css theme

- @theme => Can be default or one of the bootswatch themes


+++Get bs theme+++

```
saltos.bootstrap.get_bs_theme = ()
```

Retrieve the bs_theme stored in the localStorage


+++Get css theme+++

```
saltos.bootstrap.get_css_theme = ()
```

Retrieve the css_theme stored in the localStorage


++Common helper module++

```
web/js/common.js
```

This fie contains useful functions related to the common applications


+++Common helper object+++

```
saltos.common = {};
```

This object stores all application functions and data


+++Profile screen+++

```
saltos.common.profile = ()
```

This function allow to open the profile screen in a offcanvas widget


+++Help screen+++

```
saltos.common.help = ()
```

This function allow to open the help screen in a modal widget


+++Logout feature+++

```
saltos.common.logout = async ()
```

This function execute the deauthtoken action and jump to the login screen


+++Filter screen+++

```
saltos.common.filter = ()
```

This function allow to open the filter screen in a offcanvas widget


+++Download helper+++

```
saltos.common.download = file
```

This function allow to download files, to do it, make the ajax request and
using the base64 data response, sets the href of an anchor created dinamically
to emulate the download action

- @file => the file data used to identify the desired file in the backend part


+++Delete helper+++

```
saltos.common.delete = file
```

This function allow to remove the files and notes in the files and notes widgets

- @file => the file or note string path


+++TODO+++

```
saltos.common.version = ()
```

TODO


+++TODO+++

```
saltos.common.log = ()
```

TODO


+++TODO+++

```
saltos.common.edit = ()
```

TODO


+++TODO+++

```
saltos.common.create = ()
```

TODO


+++TODO+++

```
saltos.common.viewpdf = ()
```

TODO


+++TODO+++

```
saltos.common.__remove_helper = id
```

TODO


+++TODO+++

```
saltos.common.allfiles = ()
```

TODO


+++TODO+++

```
saltos.common.allnotes = ()
```

TODO


++Core helper module++

```
web/js/core.js
```

This fie contains useful functions related to the core application, provides the low level features
for manage errors, logs, manipulates html and DOM objects, manage ajax requests, and more things


+++Core helper object+++

```
saltos.core = {};
```

This object stores all core functions and data


+++Error management+++

```
saltos.core.adderror = async (message, source, lineno, colno, stack)
```

This function allow to SaltOS to log in server the javascript errors produced in the
client's browser

- @message => the error message
- @source  => the filename where the error was triggered
- @lineno  => the line number where the error was triggered
- @colno   => the column number where the error was triggered
- @stack   => the backtrace stack of all execution until the error


Notes:

This function is called from some addEventListeners, the original was the error event
but when change the ajax requests from xhr to fetch to setup the proxy feature, the
errors was mapped by the event unhandledrejection.


+++Old error handler+++

```
window.addEventListener('error', event
```

This code allow to capture the old errors triggered outside the fetch requests


+++New error handler+++

```
window.addEventListener('unhandledrejection', event
```

This code allow to capture the new errors triggered inside the fetch requests


+++Log management+++

```
saltos.core.addlog = msg
```

This function allow to send messages to the addlog of the server side, requires an argument:

- @msg => the message that do you want to log on the server log file


+++Check params+++

```
saltos.core.check_params = (obj, params, value = '')
```

This function allow to prepare parameters to be used by other functions, the main idea
is that the other functions can access to properties of an object without getting errors
caused by the nonexistence, to do this, checks for the existence of all params in the obj
and if some param is not found, then define it using the default value passed:

- @obj    => the object that contains the arguments, for example
- @params => an array with the arguments that must to exists
- @value  => the default value used if an argument doesn't exists


+++UniqID+++

```
saltos.core.uniqid = ()
```

This function generates an unique id formed by the word 'id' and a number that can take
values between 0 and 999999, useful when some widget requires an id and the user don't
provide it to the widget constructor


+++When visible+++

```
saltos.core.when_visible = (obj, fn, args)
```

This function allow to execute some code when the object is visible, useful for third part
widgets as ckeditor or codemirror that requires a rendered environemt to initialize their
code and paint the widget correctly

- @obj  => the object that do you want to monitorize the visibility
- @fn   => the callback that you want to execute
- @args => the arguments passed to the callback when execute it


Notes:

As an extra feature, the object can be an string containing the id of the object, intended
to be used when the object not exists at the moment to call this function


+++Get keycode+++

```
saltos.core.get_keycode = event
```

This function allow to get the keycode of a keyboard event detecting the browser

- @event => the event that contains the keyboard data


+++Get keyname+++

```
saltos.core.get_keyname = event
```

This function allow to get the keyname of a keyboard event detecting the browser

- @event => the event that contains the keyboard data


+++HTML builder+++

```
saltos.core.html = (...args)
```

This function allow to create an DOM fragment from a string that contains html code, can
work with one or two arguments:

- @type => the type used when create the container element
- @html => contains the html code that you want to use as template


The main use is only using the html argument and omiting the type, in this case, the
type used will be a div, but if you want to create a fragment of object, for example
as tr or td, you need to specify that the coontainer type used to create the objects
must to be a table or tr, is you don't specify the type, the div container creates
a breaked portion of the element and they don't works as expected because the DOM
builded is bad, you can see this problem in action when work with tables and try to
create separate portions of the table as trs or tds.


+++Ajax helper array+++

```
saltos.core.__ajax = [];
```

This array allow to the ajax feature to manage the active request, intended to abort
if it is needed when onhashchange.


+++AJAX+++

```
saltos.core.ajax = args
```

This function allow to use ajax using the same form that with jQuery without jQuery

- @url          => url of the ajax call
- @data         => data used in the body of the request
- @method       => the method of the request (can be GET or POST, GET by default)
- @success      => callback function for the success action (optional)
- @error        => callback function for the error action (optional)
- @abort        => callback function for the abort action (optional)
- @abortable    => boolean to enable or disable the abort feature (false by default)
- @content_type => the content-type that you want to use in the transfer
- @proxy        => add the Proxy header with the value passed, intended to be used by the SaltOS PROXY
- @token        => add the Token header with the value passed, intended to be used by the SaltOS API
- @lang         => add the Lang header with the value passed, intended to be used by the SaltOS API
- @headers      => an object with the headers that you want to send


The main idea of this function is to abstract the usage of the XMLHttpRequest in a simple
way as jQuery do but without using jQuery.

The catch part is intended to control the errors caused during the ajax execution,
in this case is important to understand that the catch can be triggered by errors
caused by network errors or by other cases like a code error, a throw new error or
something similar like this, to fix it, the error and abort arguments will be used
only when abortError or typeError appear in the error.name


+++Fix key+++

```
saltos.core.fix_key = arg
```

This function is intended to fix the keys of the objects, this is caused because you can not
have 2 repeated keys in an object, to have more entries with the same name, SaltOS add a suffix
by adding #num, with this trick, SaltOS is able to process XML files with the same node name
and convert it to an array structure, and when convert this to json, the same problem appear and
for this reason, exists this function here

- @arg => can be an string or an array of strings and returns the same structure with the keys fixed


+++Copy object+++

```
saltos.core.copy_object = arg
```

This function is intended to do copies of objects using as intermediate a json file

- @arg => the object that you want to copy


+++Optimizer object+++

```
saltos.core.optimize = obj
```

This function checks an object to see if only contains one children and in this case, returns
directly the children instead of the original object, otherwise nothing to do and returns the
original object

- @obj => the object to check and optimize


+++Require helper array+++

```
saltos.core.__require = {};
```

This array allow to the require feature to control the loaded libraries


+++Require feature+++

```
saltos.core.require = (files, callback)
```

This function allow the other functions to declare their requirements to previously load the
desired file intead of create the object and throwing an error.

- @file => the file desired to be loaded


Notes:

This function is intended to load styles (css files) or javacript code (js files), in each
case, they uses a different technique, for css the load is asynchronous and for javascript
the load will be synchronous.


+++Eval Bool+++

```
saltos.core.eval_bool = arg
```

This function returns a boolean depending on the input evaluation, the main idea
is to get an string, for example, and determine if must be considered true or false
otherwise returns the original argument and send a log message to the console.

The valid inputs are the strings one, zero, void, true, false, on, off, yes and no

- @arg => the value that do you want to evaluates as boolean


Notes:

This function is the same feature that the same function proviced by the backend by the
php/autoload/xml2array.php file with more javascript details as type detection.


+++toString function+++

```
saltos.core.toString = arg
```

This function tries to convert to string from any other formats as boolean,
number, null, undefined or other type.


+++Is attr value+++

```
saltos.core.is_attr_value = data
```

This function return true if the data argument is an object with #attr and value

- @data => the data that wants to check


+++Join attr value+++

```
saltos.core.join_attr_value = data
```

This function return an object that contains all elements of the #attr and value

- @data => the data that wants to join


Notes:

If the content of value is only a string, then the result will be an array with the
elements of the #attr joined with a new element with the name value and with the contents
of the original value.


+++Encode Bar Chars+++

```
saltos.core.encode_bad_chars = (cad, pad = '_', extra = '')
```

This function tries to replace accender chars and other extended chars into
an ascii chars, to do it, they define an array with the pairs of chars to
do a quick replace, too is converted all to lower and are removed all chars
that are out of range (valid range are from 0-9 and from a-z), the function
allow to specify an extra parameter to add extra chars that must to be
allowed in the output, all other chars will be converted to the padding
argument, as a bonus extra, all padding repetitions will be removed to
only allow one pading char at time

- @cad   => the input string to encode
- @pad   => the padding char using to replace the bar chars
- @extra => the list of chars allowed to appear in the output


+++Prepare Words+++

```
saltos.core.prepare_words = (cad, pad = ' ')
```

This function allow to prepare words removing repetitions in the padding char

- @cad => the input string to prepare
- @pad => the padding char using to replace the repetitions


Notes:

Apart of remove repetitions of the padding char, the function will try to
remove padding chars in the start and in the end of the string


+++Main core code+++

```
document.addEventListener('DOMContentLoaded', event
```

This is the code that must to be executed to initialize all requirements of this module


+++Proxy feature+++

```
saltos.core.proxy = msg
```

This function is intended to send messages to the proxy feature


+++Online sync+++

```
window.addEventListener('online', event
```

This function send a sync message to the proxy when navigator detects an online change


+++Get code from file and line+++

```
saltos.core.__get_code_from_file_and_line = (file = 'unknown', line = 'unknown')
```

This function returns the string that contains the PATHINFO_FILENAME and the line to idenfify
the launcher of an error, for example

- @file => filename used to obtain the first part of the code
- @line => line used to construct the last part of the code


+++Timestamp helper+++

```
saltos.core.timestamp = (offset = 0)
```

This function is a helper to obtain the timestamp in seconds with the desidet offset

- @offset => offset added to the timestamp, negative to go back in the time


+++Human Size+++

```
saltos.core.human_size = (size, pre = '', post = '')
```

Return the human size (G, M, K or original value)

- @size  => the size that you want convert to human size
- @pre  => string added between the number and the unit letter
post  => string added after the unit letter at the end


+++Check network+++

```
saltos.core.check_network = async ()
```

This function checks the network state by sending a request over https and http
channels, this is usefull to detect certificate issues

Notes:

The first version uses fetch to the img/logo_saltos.svg but for securiry reasons,
the browser never send the request to http from https or viceversa, the unique trick
that I found to do it is to open a new window for each protocol and wait for the
expected result


+++Is Number+++

```
saltos.core.is_number = str
```

This function checks that the str contains a valid number and is finite

str => the string to validate


++Driver module++

```
web/js/driver.js
```

Intended to be used as an abstraction layer to allow multiple screens configurations


+++Driver object+++

```
saltos.driver = {};
```

This object stores the functions used by the layouts widgets and must work with all screens


+++Driver init+++

```
saltos.driver.init = async arg
```

This function initialize the driver screen, detects and replaces the styles, compute
the paddings checking the contents of the top and bottom layouts, initialize the filter
and the autosave features, and executes the specific init function.

- @arg => the desired action to do


+++Driver open+++

```
saltos.driver.open = arg
```

This function launch the specific open action for the screen type

- @arg => this argument is bypassed to the destination


+++Driver close+++

```
saltos.driver.close = arg
```

This function close the current app using the history back if it is available,
otherwise use the specific close action for the screen type

- @arg => this argument forces to execute the specific driver close


+++Driver cancel+++

```
saltos.driver.cancel = arg
```

This function works in conjuntion with the autosave module, and checks if the
current screen contains new data, in this case ask to the user if they want
continue.

This function checks that modal is close, otherwise an old confirm is used
to ask to the user.

If the user decides continue to close, then the saltos.driver.close is executed
bypassing the arg argument.

- @arg => this argument is bypassed to the destination


+++Driver search+++

```
saltos.driver.search = arg
```

This function implement the search feature associated to tables and lists
using the filters fields

- @arg => unused at this scope


+++Driver search+++

```
saltos.driver.reset = arg
```

This function implement the reset feature associated to the filters fields

- @arg => unused at this scope


+++Driver more+++

```
saltos.driver.more = arg
```

This function implement the more feature associated to tables and lists
using the filters fields

- @arg => unused at this scope


+++Driver insert+++

```
saltos.driver.insert = arg
```

This function implement the insert feature associated to the current app fields

- @arg => unused at this scope


+++Driver update+++

```
saltos.driver.update = arg
```

This function implement the update feature associated to the current app fields

- @arg => unused at this scope


+++Driver delete+++

```
saltos.driver.delete = async arg
```

This function implement the delete feature associated to the current app register

- @arg => this field can contain the hash of the deletion


+++Driver placeholder+++

```
saltos.driver.placeholder = arg
```

This function sets a placeholder object in the element identified by the arg

- @arg => the id of the element where do you want to put the placeholder


+++Driver styles+++

```
saltos.driver.styles = (arg = 'xl')
```

This function returns the style object that contains the tricks to do
that the screen with verticals scrolls runs as expected

- @arg => the break-size used in the driver screen, xl as default


+++Driver search if needed+++

```
saltos.driver.search_if_needed = arg
```

This function launch the saltos.driver.search action if the action is the
same before and after the setTimeout, too is launched if action source and
the action destination complains with some pair of actions defined in the
arg argument.

- @arg => an array with pairs of actions


+++Driver internal object+++

```
saltos.driver.__types = {};
```

This object stores the functions used by the main driver


+++Driver type1 object+++

```
saltos.driver.__types.type1 = {};
```

This object stores the functions used by the type1 driver


+++Driver type1 template+++

```
saltos.driver.__types.type1.template = arg
```

This function returns the type1 template to mount the screen

- @arg => unused at this scope


+++Driver type1 init+++

```
saltos.driver.__types.type1.init = arg
```

This function initialize the type1 driver screen for the arg requested

- @arg => the desired action to do


+++Driver type1 open+++

```
saltos.driver.__types.type1.open = arg
```

This function open a new window

- @arg => the desired url


+++Driver type1 close+++

```
saltos.driver.__types.type1.close = arg
```

This function close the window

- @arg => unused at this scope


+++Driver type2 object+++

```
saltos.driver.__types.type2 = {};
```

This object stores the functions used by the type2 driver


+++Driver type2 template+++

```
saltos.driver.__types.type2.template = arg
```

This function returns the type2 template to mount the screen

- @arg => unused at this scope


+++Driver type2 init+++

```
saltos.driver.__types.type2.init = arg
```

This function initialize the type2 driver screen for the arg requested

- @arg => the desired action to do


+++Driver type2 open+++

```
saltos.driver.__types.type2.open = arg
```

This function open a new content

- @arg => the desired url


+++Driver type2 close+++

```
saltos.driver.__types.type2.close = arg
```

This function close the two zone of the screen

- @arg => unused at this scope


+++Driver type3 object+++

```
saltos.driver.__types.type3 = {};
```

This object stores the functions used by the type3 driver


+++Driver type3 template+++

```
saltos.driver.__types.type3.template = arg
```

This function returns the type3 template to mount the screen

- @arg => unused at this scope


+++Driver type3 init+++

```
saltos.driver.__types.type3.init = arg
```

This function initialize the type3 driver screen for the arg requested

- @arg => the desired action to do


+++Driver type3 open+++

```
saltos.driver.__types.type3.open = saltos.driver.__types.type2.open;
```

This function bypass to the type2 driver

- @arg => the desired url


+++Driver type3 close+++

```
saltos.driver.__types.type3.close = arg
```

This function close the three and/or two zone of the screen

- @arg => unused at this scope


+++Driver type4 object+++

```
saltos.driver.__types.type4 = {};
```

This object stores the functions used by the type4 driver


+++Driver type4 template+++

```
saltos.driver.__types.type4.template = arg
```

This function returns the type4 template to mount the screen

- @arg => unused at this scope


+++Driver type4 init+++

```
saltos.driver.__types.type4.init = arg
```

This function initialize the type4 driver screen for the arg requested

- @arg => the desired action to do


+++Driver type4 open+++

```
saltos.driver.__types.type4.open = saltos.driver.__types.type2.open;
```

This function bypass to the type2 driver

- @arg => the desired url


+++Driver type4 close+++

```
saltos.driver.__types.type4.close = arg
```

This function close the modal

- @arg => unused at this scope


+++Driver type5 object+++

```
saltos.driver.__types.type5 = {};
```

This object stores the functions used by the type5 driver


+++Driver type5 template+++

```
saltos.driver.__types.type5.template = arg
```

This function returns the type5 template to mount the screen

- @arg => unused at this scope


+++Driver type5 init+++

```
saltos.driver.__types.type5.init = arg
```

This function initialize the type5 driver screen for the arg requested

- @arg => the desired action to do


+++Driver type5 open+++

```
saltos.driver.__types.type5.open = saltos.driver.__types.type2.open;
```

This function bypass to the type2 driver

- @arg => the desired url


+++Driver type5 close+++

```
saltos.driver.__types.type5.close = arg
```

This function close the modal and/or two zone of the screen

- @arg => unused at this scope


++Filter module++

```
web/js/filter.js
```

Implements all filters features


+++Filter object+++

```
saltos.filter = {};
```

This object stores the functions used by the filter module


+++Filter cache+++

```
saltos.filter.__cache = {};
```

This object stores the cache used by the filter module


+++Init filter+++

```
saltos.filter.init = async ()
```

This function initialize the filter module by loading the current filters for
the current app. The main idea is to load all filters to be used by load and
save.

- @app => the name of the app used to load the filters


+++Load filter+++

```
saltos.filter.load = (name)
```

This function gets the filter indentified by the app and name and restore
all values of the search form widgets from the cache for afterwards execute
the saltos.driver.search, that load the data in the list

- @app  => the name of the desired app to be used
- @name => the name of the desired filter


+++Update filter+++

```
saltos.filter.update = (name, data)
```

This function only updates the cache filter

- @app  => the name of the desired app to be used
- @name => the name of the desired filter that wants to update
- @data => the data of the desired filter that wants to update


+++Update filter+++

```
saltos.filter.save = (name, data)
```

This function save the data in the cache and in the server api

- @app  => the name of the desired app to be used
- @name => the name of the desired filter that wants to save
- @data => the data of the desired filter that wants to save


Notes:

This function allow to save and delete entries, using data as object or as null
you can modify the behaviour, and the actions are performed in the cache and
in the server api.

Too this function checks if data has suffered changes to optimize the network
and prevent non needed ajax requests.


+++Filter button helper+++

```
saltos.filter.button = arg
```

This function allow to manage the filters buttons, can process requests
like load a filter, update a filter, delete a filter, create a filter and
rename a filter.

- @arg => the desired action that you want to do


+++Select button helper+++

```
saltos.filter.select = arg
```

This function updates the contents of the select button and the contents of
the jstree widget, is executed when create a filter, rename a filter or delete
a filter

- @arg => unused argument at the moment


++Form helper module++

```
web/js/form.js
```

This module provides the needed tools to implement the form feature


+++Form constructor helper object+++

```
saltos.form = {};
```

This object allow to the constructor to use a rational structure for a quick access of each
helper


+++Data helper object+++

```
saltos.form.__form = {
```

This object allow to the app to store the data of the fields map


+++Form data helper+++

```
saltos.form.data = (data, sync = true)
```

This function sets the values of the request to the objects placed in the document, too as bonus
extra, it tries to search the field spec in the array to update the value of the field spec to
allow that the get_data can differ between the original data and the modified data.


+++Data template helper+++

```
saltos.form.__data_template_helper = (template_id, data, index)
```

This function allow to convert the data object that contains the values for the fields idenfidied
by the keys of the associative array into a data object with the keys ready to be used by the
fields of a template, this fields are of the follow structure: TEMPLATE_ID#ID#INDEX

- @template_id => the template identity used in the spec
- @data        => the object that contains the data associated to the row
- @index       => the index used in all fields of the template


+++Layout template helper+++

```
saltos.form.__layout_template_helper = (template_id, index)
```

This function returns the template identified by the template_id for the specified index, ready
to be used by the saltos.form.layout function.

- @template_id => the template identity used in the spec
- @index       => the index used in all fields of the template


+++Form layout helper+++

```
saltos.form.layout = (layout, extra)
```

This function process the layout command, its able to process nodes as container, row, col and div
and all form_field defined in the bootstrap file.

Each objects as container, rows and cols, have two modes of works:

1) normal mode => requires that the user specify all layout, container, row, col and fields.

2) auto mode => only requires set auto='true' to the container, row or col, and with this, all childrens
of the node are created inside the correct element, if the auto appear in the container then a container,
a row and one col for each field are created, if the auto appear in the row then a row with one col for
each field are created, if the auto appear in the col then one col for each field are created, this mode
allow to optimize and speedup the creation of each screen by allow to reduce the amount of xml needed
to define each screen but allowing to be a lot of specific and define from all to zero auto features.

Notes:

This function add the fields to the saltos.form.__form.fields, this allow to the saltos.app.get_data
can retrieve the desired information of the fields.


+++Form layout auto helper object+++

```
saltos.form.__layout_auto_helper = {};
```

This object stores the functions used as layout_auto_helper for containers, rows and cols


+++Form layout auto helper for containers+++

```
saltos.form.__layout_auto_helper.container = layout
```

This functions implements the auto feature used by the layout function, allow to specify the
follow arguments:

- @id              => defines the id used by the container element
- @container_class => defines the class used by the container element
- @container_style => defines the style used by the container element
- @row_class       => defines the class used by the row element
- @row_style       => defines the style used by the row element
- @col_class       => defines the class used by the col element
- @col_style       => defines the style used by the col element


+++Form layout auto helper for rows+++

```
saltos.form.__layout_auto_helper.row = layout
```

This functions implements the auto feature used by the layout function, allow to specify the
follow arguments:

- @id              => defines the id used by the container element
- @row_class       => defines the class used by the row element
- @row_style       => defines the style used by the row element
- @col_class       => defines the class used by the col element
- @col_style       => defines the style used by the col element


+++Form layout auto helper for cols+++

```
saltos.form.__layout_auto_helper.col = layout
```

This functions implements the auto feature used by the layout function, allow to specify the
follow arguments:

- @col_class       => defines the class used by the col element
- @col_style       => defines the style used by the col element


Notes:

This function not allow to specify the id because in this functions, each object of the
layout is embedded inside of a col object and is not suitable to put an id attribute
to each col without repetitions.


+++Style helper array+++

```
saltos.form.__style = {};
```

This array allow to the require feature to control the loaded libraries


+++Form style helper+++

```
saltos.form.style = async data
```

This function allow to specify styles, you can use the inline of file key to specify
what kind of usage do you want to do.

- @data => the object that contains the styles requirements (can be file or inline)


+++Javascript helper array+++

```
saltos.form.__javascript = {};
```

This array allow to the require feature to control the loaded libraries


+++Form javascript helper+++

```
saltos.form.javascript = async data
```

This function allow to specify scripts, you can use the inline of file key to specify
what kind of usage do you want to do.

- @data => the object that contains the javascript requirements (can be file or inline)


+++Form title helper+++

```
saltos.form.title = title
```

This function sets the document title, too it checks the existence of the About
header received in the ajax calls and stored in the saltos object to be used in the
last part of the title.

- @title => The title that you want to set in the page


+++Form screen helper+++

```
saltos.form.screen = action
```

This function adds and removes the spinner to emulate the loading effect screen, too is able
to clear the screen by removing all contents of the body

- @action => use loading, unloading or clear to execute the desired action


+++Form navbar helper+++

```
saltos.form.navbar = navbar
```

This function create a navbar with their menus on the top of the page, more
info about this feature in the bootstrap documentation

- @navbar


+++Load gettext helper+++

```
saltos.form.gettext = array
```

This function load the gettext data from the api to the cli sapi


+++Form cache helper+++

```
saltos.form.cache = async val
```

This function allow to use the cache feature

- @val => the requested cache


Notes:

This feature works in conjunction with the prefetch_cache function that
solves all caches before the real process_response, in order to explain
how it works, the main idea is to call to send_request, the response is
processed by prefetch_cache and when all caches are solved, then the
process_response is called.


++Gettext helper module++

```
web/js/gettext.js
```

This fie contains useful functions related to gettext funcionality, allow to manage the
SaltOS translations using a merged system of the unix locales and the old SaltOS translations
system.


+++Gettext helper object+++

```
saltos.gettext = {
```

This object stores all gettext functions to get and set data using the localStorage


+++Get gettext function+++

```
saltos.gettext.get = ()
```

This function returns the gettext stored in the localStorage


+++Get Short gettext function+++

```
saltos.gettext.get_short = ()
```

This function returns the short version of gettext stored in the localStorage


+++Set gettext function+++

```
saltos.gettext.set = lang
```

This function sets the gettext stored in the localStorage

- @gettext      => the gettext that you want to store in the localStorage


+++Unset gettext and expires_at+++

```
saltos.gettext.unset = ()
```

This function removes the gettext and expires_at in the localStorage


+++Get Text function+++

```
saltos.gettext.T = text
```

This function replaces the gettext abreviation _() using the SaltOS gettext
feature, is based in the original system of the old SaltOS with improvements
to do more open as the GNU gettext

- @text => The text that you want to translate


Notes:

This function uses multiples locales at same time, SaltOS provides a basic set of
usefull strings and each application can add and overwrite more strings, this is
the same feature that old SaltOS provides


+++T function+++

```
window.T = saltos.gettext.T;
```

This line allow to publish the saltos.gettext.T function in the global scope


+++Bootstrap gettext object+++

```
saltos.gettext.bootstrap = {};
```

This object stores some bootstrap overloads that allow to other modules to
access to the bootstrap modules using the gettext feature and translating
texts.


+++Bootstrap field overload+++

```
saltos.gettext.bootstrap.field = field
```

This function overload the saltos.bootstrap.field funtion to add gettext
features to the arguments depending the type of field.

- @field => the argument passed to the original bootstrap function


+++Bootstrap modal overload+++

```
saltos.gettext.bootstrap.modal = args
```

This function overload the saltos.bootstrap.modal funtion to add gettext
features to the arguments

- @arg => the argument passed to the original bootstrap function


+++Bootstrap toast overload+++

```
saltos.gettext.bootstrap.toast = args
```

This function overload the saltos.bootstrap.toast funtion to add gettext
features to the arguments

- @arg => the argument passed to the original bootstrap function


+++Bootstrap menu overload+++

```
saltos.gettext.bootstrap.menu = args
```

This function overload the saltos.bootstrap.menu funtion to add gettext
features to the arguments

- @arg => the argument passed to the original bootstrap function


+++Bootstrap offcanvas overload+++

```
saltos.gettext.bootstrap.offcanvas = args
```

This function overload the saltos.bootstrap.offcanvas funtion to add gettext
features to the arguments

- @arg => the argument passed to the original bootstrap function


++Hash helper module++

```
web/js/hash.js
```

This module includes the code used to manage the hash feature in the browser
and to provide an onhashchange function


+++Hash helper object+++

```
saltos.hash = {};
```

This object stores all hash functions to get, set and trigger a change


+++Get hash+++

```
saltos.hash.get = ()
```

Function intended to return the current hash without the pillow


+++Set hash+++

```
saltos.hash.set = hash
```

Function intended to replace the hash in the current url, adds the pilow if it is not found
in the hash argument

- @hash => this must contain the hash with or without the pillow


Notes:

The # char is added by default if it is not found in the hash, additionally the dot is
added to force to remove all chars before the # char in the window.location

The operation is cancelled if the current hash is the same that the new hash


+++Add hash+++

```
saltos.hash.add = hash
```

Function intended to add a hash in the current history, adds the pilow if it is not found
in the hash argument

- @hash => this must contain the hash with or without the pillow


Notes:

The # char is added by default if it is not found in the hash, additionally the dot is
added to force to remove all chars before the # char in the window.location

The operation is cancelled if the current hash is the same that the new hash


+++Hash helper+++

```
saltos.hash.__helper = hash
```

This function is used by all other functions to clean the hash

- @hash => the hash that you want to check and clean


+++Url to hash+++

```
saltos.hash.url2hash = url
```

This function allow to convert and url string into a hash string

- @url => the url string that contains the hash that you want to retrieve


+++Change trigger+++

```
saltos.hash.trigger = ()
```

This function triggers the hashchange event to execute the onhashchange


+++Hash change management+++

```
window.addEventListener('hashchange', event
```

This function allow to SaltOS to update the contents when hash change


+++Before unload management+++

```
window.addEventListener('beforeunload', event
```

This function allow to SaltOS to update the contents when hash change


++Object helper module++

```
web/js/object.js
```

This file contains the main saltos object


+++Main object+++

```
const saltos = {};
```

This object contains all SaltOS code


++Proxy module++

```
web/js/proxy.js
```

This module provides a service worker that acts as a proxy, it uses the headers
requests to understand what kind of thing the request needs and tries to do
it with the more better manner.


+++Console log+++

```
const console_log = (message)
```

This function only apply as console.log replacement for debug purposes

- @message => the message that you want to send to the console


Notes:

This function send a message to all clients and exists because in some cases
the console.log not apply for service workers, this is a simple and quick
solution for help in the debug process


+++Debug function+++

```
const debug = (action, url, type, duration, size)
```

This function returns an array with the needed things to print into a console.log
the fetch message with the url, the response type and the duration of the task

- @url      => url of the request
- @type     => type of the request (network, cache or error)
- @duration => duration of the entire task in milliseconds


+++Proxy function+++

```
const proxy = async request
```

This function receives a request to do a fetch or try to use a cached result
if a network error occurs, if no response is available, a json error is returned
to the application layer

This function can perform actions like fetch, cache, queue or error, in each
case, tries to execute each part using the order defined by the proxy header
that can be added from the layer application ajax call

- @request => the request that must to be processed


+++Queue open+++

```
const queue_open = ()
```

This function returns a promise to the store object that can be used
in the add, delete or getAll features.


+++Queue push+++

```
const queue_push = data
```

This function adds an entry to the queue system

- @data => the object that you want to store in the database


+++Queue getall+++

```
const queue_getall = ()
```

This function returns all entries of the queue using the fifo
order


+++Queue delete+++

```
const queue_delete = key
```

This function allow to delete the entry identified by @key

- @key => the primaryKey that you want to delete


+++Request serialize+++

```
const request_serialize = async request
```

This function allow to gets a request and returns an object
that can be stored in an indexedDB

- @request => the request that must to be converted into an object


+++Request unserialize+++

```
const request_unserialize = request
```

This function allow to convert an object stored in an indexedDB
into a valid request that can be used in fetch operations

- @request => the object that must to be converted into a request


+++Human Size+++

```
const human_size = (size, pre = '', post = '')
```

Return the human size (G, M, K or original value)

- @size  => the size that you want convert to human size
- @pre  => string added between the number and the unit letter
post  => string added after the unit letter at the end


+++Install binding+++

```
self.addEventListener('install', event
```

This code implements the install feature


+++Activate binding+++

```
self.addEventListener('activate', event
```

This code implements the activate feature


+++Fetch binding+++

```
self.addEventListener('fetch', event
```

This code implements the fetch feature


+++Sync in progress flag+++

```
let sync_in_progress = false;
```

Flag used to prevent concurrent execution of the sync operation in a service worker.
It ensures that only one sync process runs at a time by setting the flag to true
when the sync starts and resetting it to false once the process completes. If another
sync request is received while sync_in_progress is true, the new sync is ignored
until the current one finishes.


+++Message binding+++

```
self.addEventListener('message', async event
```

This code implements the message feature

Notes:

If the message contains the reserved word reset, then all caches are deleted
and the service worker is released, too can receive a hello word that is intended
to test the comunication between the proxy and the app layer


++Push & favicon helper module++

```
web/js/push.js
```

This fie contains useful functions related to the push and favicon features


+++TODO+++

```
saltos.push = {
```

TODO


+++TODO+++

```
saltos.push.fn = ()
```

TODO


+++TODO+++

```
window.addEventListener('load', async event
```

TODO


+++Online sync+++

```
window.addEventListener('online', event
```

This function send a push request when navigator detects an online change


+++TODO+++

```
saltos.favicon = {
```

TODO


+++TODO+++

```
saltos.favicon.fn = bool
```

TODO


+++TODO+++

```
document.addEventListener('visibilitychange', ()
```

TODO


+++TODO+++

```
saltos.favicon.run = ()
```

TODO


++Token helper module++

```
web/js/storage.js
```

This module provides the needed tools to manage the tokens


+++Storage helper object+++

```
saltos.storage = {};
```

This object manage the localStorage using a prefix to prevent collisions


+++Pathname helper string+++

```
saltos.storage.pathname = saltos.core.encode_bad_chars(window.location.pathname);
```

This string contains the pathname for the current execution


+++Get key+++

```
saltos.storage.get_key = key
```

This function returns the real key used by localStorage to store a retrieve
the data.

key => the desired key used to access to the local storage


+++Get Item+++

```
saltos.storage.getItem = key
```

This function is the same that localStorage.getItem but using the get_key as key

key => the desired key used to access to the local storage


+++Set Item+++

```
saltos.storage.setItem = (key, value)
```

This function is the same that localStorage.setItem but using the get_key as key

key   => the desired key used to access to the local storage
value => the value that you want to set


+++Remove Item+++

```
saltos.storage.removeItem = key
```

This function is the same that localStorage.removeItem but using the get_key as key

key => the desired key used to access to the local storage


+++Clear+++

```
saltos.storage.clear = ()
```

This function is the same that localStorage.clear but only removes the entries that
are using the same prefix that the current context, to do it, this code checks all
keys and removes all items that starts with the prefix returned by get_key


+++Get Item With Timestamp+++

```
saltos.storage.getItemWithTimestamp = key
```

This function tries to do the same thing that getItem but using a timestampd data
structure, to do it, only returns the value entrie

key => the desired key used to access to the local storage


+++Set Item With Timestamp+++

```
saltos.storage.setItemWithTimestamp = (key, value)
```

This function tries to do the same thing that setItem but using a timestampd data
structure, to do it, sets an object with the timestamp and the original value.

key => the desired key used to access to the local storage


+++Purge With Timestamp+++

```
saltos.storage.purgeWithTimestamp = (prefix, offset)
```

This function tries to purge old data using the prefix and offset in the current
timestamp.

- @prefix => the prefix used in the search process
- @offset => the offset used in the timestamp comparison


++Token helper module++

```
web/js/token.js
```

This module provides the needed tools to manage the tokens


+++Token helper object+++

```
saltos.token = {};
```

This object stores all token functions to get and set data using the localStorage


+++Get token function+++

```
saltos.token.get = ()
```

This function returns the token stored in the localStorage


+++Get expires_at function+++

```
saltos.token.get_expires_at = ()
```

This function returns the expires_at stored in the localStorage


+++Set token and expires_at+++

```
saltos.token.set = response
```

This function store the token and expires_at in the localStorage

- @response   => the object that contains the follow parameters:
- @token      => the token that you want to store in the localStorage
- @expires_at => the expires_at of the token that you want to store in the localStorage


+++Unset token and expires_at+++

```
saltos.token.unset = ()
```

This function removes the token and expires_at in the localStorage


++Window helper module++

```
web/js/window.js
```

This function provides all needed code to manage the windows (open and close) and too
to provide a tool to send messages between tabs inside the same browser.


+++Window communication helper object+++

```
saltos.window = {};
```

This object stores all windows communications functions to send and listen messages


+++Open window+++

```
saltos.window.open = url
```

This function is intended to open new tabs in the window, at the moment only is a wrapper to
the window.open but in a future, can add more features

- @url => the url of the page to load


+++Close window+++

```
saltos.window.close = ()
```

This function is intended to close the current window


+++Listeners helper object+++

```
saltos.window.listeners = {};
```

This object stores all listeners added by the set_listeners and used by the onstorage


+++Set listener+++

```
saltos.window.set_listener = (name, fn)
```

This function allos to set a listener function to the named event

- @name => the name of the event that you want to suscribe
- @fn   => callback executed when event named is triggered


+++Unset listener+++

```
saltos.window.unset_listener = (name)
```

This function removes a listener from the listeners object

- @name => the name of the event that you want to unsuscribe


+++Send message+++

```
saltos.window.send = (name, data = '', scope = 'all')
```

This function allow to send a message to all tabs using the name and data
as event and argument of the callback executed.

- @name  => the name of the event that you want to send
- @data  => the arguments used by the callback function
- @scope => the scope where the event must to be triggered (me, all, other)


Notes:

The usage of the localStorage causes the execution of the onstorage function
of the other tabs but not for the tab that send the message, to fix this we
are dispatching an event in the current window, this allow that all tabs
(including the source of the message sent) receives the notification and
executes the listeners if needed

As this module uses the saltos.storage module, it's important that understand
that the saltos.storage adds a prefix in the keys to allow the separation of
the data for the different instances of the same app, this is important because
the key generated to send the event to the origin of the message must contains
the prefix that too


+++Storage management+++

```
window.addEventListener('storage', event
```

This function allow to SaltOS to receive the messages sended by other tabs
using the localStorage.


