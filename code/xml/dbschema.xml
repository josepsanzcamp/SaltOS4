<?xml version="1.0" encoding="UTF-8" ?>

<!--
 ____        _ _    ___  ____    _  _    ___
/ ___|  __ _| | |_ / _ \/ ___|  | || |  / _ \
\___ \ / _` | | __| | | \___ \  | || |_| | | |
 ___) | (_| | | |_| |_| |___) | |__   _| |_| |
|____/ \__,_|_|\__|\___/|____/     |_|(_)___/

SaltOS: Framework to develop Rich Internet Applications
Copyright (C) 2007-2023 by Josep Sanz CampderrÃ³s
More information in https://www.saltos.org or info@saltos.org

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!--
This file allow to define the entire database schema used in SaltOS, this
have two functionalities:

1) detect changes in the schema file and apply it to the real database
using sql commands, this allow to quickly add fields, indexes, or other
things

2) apply this changes to the database in a transparent mode, this allow
that the developers or users, not need to use third part applications
to do changes in the database, SaltOS contains their phpmyadmin inside
that maintain the database using as reference this file
-->

<root>
    <tables>
        <!--
        Tables that dbschema will ignore, intended to allow the coexistence between
        our tables and tables used by other purposes in the same database
        -->
        <table name="tbl_one" ignore="true"/>
        <table name="tbl_two" ignore="true"/>
        <table name="tbl_three" ignore="true"/>
        <table name="tbl_four" ignore="true"/>
        <table name="tbl_five" ignore="true"/>

		<!--
		This table allow to store pairs of key val, and allow too to associate it to
		a specific user
		-->
        <table name="tbl_config">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="user_id" type="INT(11)" fkey="tbl_users"/>
                <field name="key" type="VARCHAR(255)"/>
                <field name="val" type="VARCHAR(255)"/>
            </fields>
            <indexes>
                <index fields="user_id,key"/>
            </indexes>
        </table>

		<!--
		This tables store the main information of a user, the times that a user must
		change their password, the times that user logins to the system, and the groups
		to allow to put each user in a group

		This table allow the users to connect with SaltOS, in this new release of
		SaltOS, the users not uses sessions, cookies or other specific browser features,
		here, the authentication is implemented by sending data in a json format and
		retrieving a token that must to be used in the headers of next requests to
        authenticate the communication
		-->
        <table name="tbl_users">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="active" type="INT(11)"/>
                <field name="group_id" type="INT(11)" fkey="tbl_groups"/>
                <field name="login" type="VARCHAR(255)"/>
                <field name="name" type="VARCHAR(255)"/>
                <field name="description" type="TEXT"/>
                <field name="start" type="TIME"/>
                <field name="end" type="TIME"/>
                <field name="days" type="VARCHAR(10)"/>
            </fields>
        </table>
        <table name="tbl_users_passwords">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="active" type="INT(11)"/>
                <field name="user_id" type="INT(11)" fkey="tbl_users"/>
                <field name="datetime" type="DATETIME"/>
                <field name="remote_addr" type="VARCHAR(255)"/>
                <field name="user_agent" type="VARCHAR(255)"/>
                <field name="password" type="VARCHAR(255)"/>
                <field name="expires" type="DATETIME"/>
            </fields>
        </table>
        <table name="tbl_users_logins">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="active" type="INT(11)"/>
                <field name="user_id" type="INT(11)" fkey="tbl_users"/>
                <field name="datetime" type="DATETIME"/>
                <field name="remote_addr" type="VARCHAR(255)"/>
                <field name="user_agent" type="VARCHAR(255)"/>
                <field name="token" type="VARCHAR(255)"/>
                <field name="expires" type="DATETIME"/>
                <field name="renewal_datetime" type="DATETIME"/>
                <field name="renewal_count" type="INT(11)"/>
            </fields>
        </table>
        <table name="tbl_groups">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="active" type="INT(11)"/>
                <field name="code" type="VARCHAR(255)"/>
                <field name="name" type="VARCHAR(255)"/>
                <field name="description" type="TEXT"/>
            </fields>
        </table>

		<!--
		This table allow to register apps with their additional information, as the
		main table, the subtables, what features do you want to enable in this app, and
		more things that we are developing

		As an extra, this group of tables allow to define permissions, what relation
		exist between apps and permissions and the table that allow to specify what
		permissions apply to each user
		-->
        <table name="tbl_apps">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="active" type="INT(11)"/>
                <field name="code" type="VARCHAR(255)"/>
                <field name="name" type="VARCHAR(255)"/>
                <field name="description" type="TEXT"/>
                <field name="table" type="VARCHAR(255)"/>
                <field name="subtables" type="VARCHAR(255)"/>
                <field name="field" type="VARCHAR(255)"/>
                <field name="has_indexing" type="INT(11)"/>
                <field name="has_control" type="INT(11)"/>
                <field name="has_version" type="INT(11)"/>
            </fields>
        </table>
        <table name="tbl_perms">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="active" type="INT(11)"/>
                <field name="code" type="VARCHAR(255)"/>
                <field name="name" type="VARCHAR(255)"/>
                <field name="description" type="TEXT"/>
            </fields>
        </table>
        <table name="tbl_apps_perms">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="app_id" type="INT(11)" fkey="tbl_apps"/>
                <field name="perm_id" type="INT(11)" fkey="tbl_perms"/>
                <field name="allow" type="INT(11)"/>
                <field name="deny" type="INT(11)"/>
            </fields>
        </table>
        <table name="tbl_users_apps_perms">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="user_id" type="INT(11)" fkey="tbl_users"/>
                <field name="app_id" type="INT(11)" fkey="tbl_aplicaciones"/>
                <field name="perm_id" type="INT(11)" fkey="tbl_perms"/>
                <field name="allow" type="INT(11)"/>
                <field name="deny" type="INT(11)"/>
            </fields>
        </table>

		<!--
		This tables are specific for the email client app
		-->
        <table name="app_correo">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="id_cuenta" type="INT(11)" fkey="tbl_users"/>
                <field name="uidl" type="VARCHAR(250)"/>
                <field name="datetime" type="DATETIME"/>
                <field name="size" type="INT(11)"/>
                <field name="subject" type="TEXT"/>
                <field name="body" type="MEDIUMTEXT"/>
                <field name="state_new" type="INT(11)"/>
                <field name="state_reply" type="INT(11)"/>
                <field name="state_forward" type="INT(11)"/>
                <field name="state_wait" type="INT(11)"/>
                <field name="state_spam" type="INT(11)"/>
                <field name="id_correo" type="INT(11)"/>
                <field name="is_outbox" type="INT(11)"/>
                <field name="state_sent" type="INT(11)"/>
                <field name="state_error" type="TEXT"/>
                <field name="state_crt" type="INT(11)"/>
                <field name="priority" type="INT(11)"/>
                <field name="sensitivity" type="INT(11)"/>
                <field name="de" type="TEXT"/>
                <field name="para" type="TEXT"/>
                <field name="cc" type="TEXT"/>
                <field name="bcc" type="TEXT"/>
                <field name="files" type="INT(11)"/>
            </fields>
        </table>
        <table name="app_correo_a">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="id_correo" type="INT(11)" fkey="app_correo"/>
                <field name="id_tipo" type="INT(11)"/>
                <field name="nombre" type="VARCHAR(255)"/>
                <field name="valor" type="VARCHAR(255)"/>
            </fields>
        </table>
        <table name="app_correo_d">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="id_cuenta" type="INT(11)" fkey="tbl_users"/>
                <field name="uidl" type="VARCHAR(250)"/>
                <field name="datetime" type="DATETIME"/>
            </fields>
        </table>

		<!--
		This tables are specific for the customers app
		-->
        <table name="app_clientes">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="id_campanya" type="INT(11)"/>
                <field name="id_tipo" type="INT(11)"/>
                <field name="codigo" type="VARCHAR(255)"/>
                <field name="nombre" type="VARCHAR(255)"/>
                <field name="nombre1" type="VARCHAR(255)"/>
                <field name="nombre2" type="VARCHAR(255)"/>
                <field name="cif" type="VARCHAR(255)"/>
                <field name="comentarios" type="TEXT"/>
                <field name="corriente" type="VARCHAR(255)"/>
                <field name="contable" type="VARCHAR(255)"/>
                <field name="diapago" type="INT(11)"/>
                <field name="direccion" type="VARCHAR(255)"/>
                <field name="id_pais" type="INT(11)" fkey="tbl_paises"/>
                <field name="id_provincia" type="INT(11)" fkey="tbl_provincias"/>
                <field name="id_poblacion" type="INT(11)" fkey="tbl_poblaciones"/>
                <field name="id_codpostal" type="INT(11)" fkey="tbl_codpostal"/>
                <field name="nombre_pais" type="VARCHAR(255)"/>
                <field name="nombre_provincia" type="VARCHAR(255)"/>
                <field name="nombre_poblacion" type="VARCHAR(255)"/>
                <field name="nombre_codpostal" type="VARCHAR(255)"/>
                <field name="email" type="VARCHAR(255)"/>
                <field name="web" type="VARCHAR(255)"/>
                <field name="tel_fijo" type="VARCHAR(255)"/>
                <field name="tel_movil" type="VARCHAR(255)"/>
                <field name="fax" type="VARCHAR(255)"/>
                <field name="activo" type="INT(11)"/>
            </fields>
        </table>

		<!--
		This tables are specific for the providers app
		-->
        <table name="app_proveedores">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="codigo" type="VARCHAR(255)"/>
                <field name="nombre" type="VARCHAR(255)"/>
                <field name="nombre1" type="VARCHAR(255)"/>
                <field name="nombre2" type="VARCHAR(255)"/>
                <field name="cif" type="VARCHAR(255)"/>
                <field name="comentarios" type="TEXT"/>
                <field name="corriente" type="VARCHAR(255)"/>
                <field name="contable" type="VARCHAR(255)"/>
                <field name="diapago" type="INT(11)"/>
                <field name="direccion" type="VARCHAR(255)"/>
                <field name="id_pais" type="INT(11)" fkey="tbl_paises"/>
                <field name="id_provincia" type="INT(11)" fkey="tbl_provincias"/>
                <field name="id_poblacion" type="INT(11)" fkey="tbl_poblaciones"/>
                <field name="id_codpostal" type="INT(11)" fkey="tbl_codpostal"/>
                <field name="nombre_pais" type="VARCHAR(255)"/>
                <field name="nombre_provincia" type="VARCHAR(255)"/>
                <field name="nombre_poblacion" type="VARCHAR(255)"/>
                <field name="nombre_codpostal" type="VARCHAR(255)"/>
                <field name="email" type="VARCHAR(255)"/>
                <field name="web" type="VARCHAR(255)"/>
                <field name="tel_fijo" type="VARCHAR(255)"/>
                <field name="tel_movil" type="VARCHAR(255)"/>
                <field name="fax" type="VARCHAR(255)"/>
                <field name="activo" type="INT(11)"/>
            </fields>
        </table>

		<!--
		This tables are specific for the invoices app
		-->
        <table name="app_facturas">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="id_cliente" type="INT(11)" fkey="tbl_clientes"/>
                <field name="id_epigrafe" type="INT(11)" fkey="tbl_epigrafes"/>
                <field name="nombre" type="VARCHAR(255)"/>
                <field name="direccion" type="VARCHAR(255)"/>
                <field name="id_pais" type="INT(11)" fkey="tbl_paises"/>
                <field name="id_provincia" type="INT(11)" fkey="tbl_provincias"/>
                <field name="id_poblacion" type="INT(11)" fkey="tbl_poblaciones"/>
                <field name="id_codpostal" type="INT(11)" fkey="tbl_codpostal"/>
                <field name="nombre_pais" type="VARCHAR(255)"/>
                <field name="nombre_provincia" type="VARCHAR(255)"/>
                <field name="nombre_poblacion" type="VARCHAR(255)"/>
                <field name="nombre_codpostal" type="VARCHAR(255)"/>
                <field name="cif" type="VARCHAR(255)"/>
                <field name="num" type="VARCHAR(255)"/>
                <field name="fecha" type="DATE"/>
                <field name="iva" type="DECIMAL(9,2)"/>
                <field name="irpf" type="DECIMAL(9,2)"/>
                <field name="cerrado" type="INT(11)"/>
                <field name="cobrado" type="INT(11)"/>
                <field name="id_cuenta" type="INT(11)" fkey="tbl_cuentas"/>
                <field name="fecha2" type="DATE"/>
                <field name="id_proyecto" type="INT(11)" fkey="tbl_proyectos"/>
                <field name="id_periodica" type="INT(11)" fkey="tbl_periodicas"/>
                <field name="mes_periodica" type="INT(11)"/>
                <field name="notas" type="TEXT"/>
                <field name="id_formapago" type="INT(11)" fkey="tbl_formaspago"/>
                <field name="id_presupuesto" type="INT(11)" fkey="tbl_presupuestos"/>
            </fields>
        </table>
        <table name="app_facturas_c">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="id_factura" type="INT(11)" fkey="app_facturas"/>
                <field name="id_producto" type="INT(11)" fkey="app_productos"/>
                <field name="concepto" type="TEXT"/>
                <field name="unidades" type="DECIMAL(9,2)"/>
                <field name="descuento" type="DECIMAL(9,2)"/>
                <field name="precio" type="DECIMAL(9,2)"/>
            </fields>
        </table>
        <table name="app_facturas_v">
            <fields>
                <field name="id" type="/*MYSQL INT(11) *//*SQLITE INTEGER */" pkey="true"/>
                <field name="id_factura" type="INT(11)" fkey="app_facturas"/>
                <field name="fecha" type="DATE"/>
                <field name="percent" type="DECIMAL(9,2)"/>
                <field name="importe" type="DECIMAL(9,2)"/>
                <field name="cobrado" type="INT(11)"/>
                <field name="fecha2" type="DATE"/>
            </fields>
        </table>

    </tables>
</root>
