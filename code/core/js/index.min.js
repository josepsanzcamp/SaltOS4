"use strict";var saltos=saltos||{};window.onerror=(e,t,s,o,r)=>{var n={action:"adderror",jserror:e,details:"Error on file "+t+":"+s+":"+o+", userAgent is "+navigator.userAgent,backtrace:"unknown"};null!==r&&"object"==typeof r&&"string"==typeof r.stack&&(n.backtrace=r.stack),saltos.ajax({url:"index.php",data:JSON.stringify(n),method:"post",content_type:"application/json",headers:{token:saltos.token.get()}})},saltos.addlog=e=>{var t={action:"addlog",msg:e};saltos.ajax({url:"index.php",data:JSON.stringify(t),method:"post",content_type:"application/json",headers:{token:saltos.token.get()}})},saltos.check_params=(e,t,s)=>{for(var o in void 0===s&&(s=""),t)e.hasOwnProperty(t[o])||(e[t[o]]=s)},saltos.uniqid=()=>"id"+Math.random().toString(36).substr(2),saltos.when_visible=(e,t,s)=>{e.getAttribute("id")||e.setAttribute("id",saltos.uniqid());var o=e.getAttribute("id"),r=1,n=setInterval((()=>{var e=document.getElementById(o);1==r&&e&&r++,2==r&&(e?e.offsetParent&&(clearInterval(n),t(s)):(clearInterval(n),console.log("#"+o+" not found")))}),1)},saltos.get_keycode=e=>e.keyCode?e.keyCode:e.which?e.which:e.charCode,saltos.html=(...e)=>{var t="div",s="";1==e.length&&(s=e[0]),2==e.length&&(t=e[0],s=e[1]);var o=document.createElement(t);return o.innerHTML=s.trim(),o=saltos.optimize(o)},saltos.ajax=e=>{if(saltos.check_params(e,["url","data","method","success","error"]),saltos.check_params(e,["progress","async","content_type","headers"]),""==e.data&&(e.data=null),""==e.method&&(e.method="GET"),""===e.async&&(e.async=!0),""==e.headers&&(e.headers={}),e.method=e.method.toUpperCase(),!["GET","POST"].includes(e.method))return console.log("unknown "+e.method+" method"),null;var t=new XMLHttpRequest;for(var s in t.onreadystatechange=()=>{if(4==t.readyState)if(200==t.status){if("function"==typeof e.success){saltos.hasOwnProperty("x_powered_by")||t.getResponseHeader("x-powered-by")&&(saltos.x_powered_by=t.getResponseHeader("x-powered-by"));var s=t.response;t.getResponseHeader("content-type").toUpperCase().includes("JSON")&&(s=JSON.parse(t.responseText)),t.getResponseHeader("content-type").toUpperCase().includes("XML")&&(s=t.responseXML),e.success(s,t.statusText,t)}}else"function"==typeof e.error&&e.error(t,t.status,t)},"function"==typeof e.progress&&(t.onprogress=e.progress,t.upload.onprogress=e.progress),t.open(e.method,e.url,e.async),""!=e.content_type&&t.setRequestHeader("Content-Type",e.content_type),e.headers)t.setRequestHeader(s,e.headers[s]);return t.send(e.data),t},saltos.fix_key=e=>{if("object"==typeof e){for(var t in e)e[t]=saltos.fix_key(e[t]);return e}var s=e.indexOf("#");return-1!=s&&(e=e.substr(0,s)),e},saltos.open_window=e=>{window.open(e)},saltos.close_window=()=>{window.close()},saltos.copy_object=e=>JSON.parse(JSON.stringify(e)),saltos.optimize=e=>1==e.children.length?e.firstElementChild:e,saltos.__require=[],saltos.require=e=>{if(!saltos.__require.includes(e)){var t,s=saltos.ajax({url:e,async:!1});if(".css"==e.substr(-4)||e.includes(".css?")){var o=document.createElement("link");o.rel="stylesheet",o.href=e,document.head.append(o)}if(".js"==e.substr(-3)||e.includes(".js?"))(t=document.createElement("script")).innerHTML=s.response,document.body.append(t);if(".mjs"==e.substr(-4)||e.includes(".mjs?"))(t=document.createElement("script")).type="module",t.src=e,t.async=!1,document.body.append(t);saltos.__require.push(e)}},saltos.eval_bool=e=>{if(null===e)return!1;if(void 0===e)return!1;if("boolean"==typeof e)return e;if("number"==typeof e)return!!e;if("string"==typeof e){if(""==e)return!1;var t={1:!0,0:!1,true:!0,false:!1,on:!0,off:!1,yes:!0,no:!1},s=e.toLowerCase();if(t.hasOwnProperty(s))return t[s]}return console.log(`Unknown typeof ${e}`),e},saltos.toString=e=>null===e?"null":void 0===e?"undefined":"boolean"==typeof e?e?"true":"false":"number"==typeof e?e.toString():("string"==typeof e||console.log(`Unknown typeof ${e}`),e),saltos.is_attr_value=e=>"object"==typeof e&&e.hasOwnProperty("#attr")&&e.hasOwnProperty("value"),saltos.join_attr_value=e=>(saltos.is_attr_value(e)&&(e={...e["#attr"],...e.value}),e),saltos.addEventListener=(e,t,s)=>{"string"!=typeof s?"function"!=typeof s?console.log(`Unknown typeof ${s}`):e.addEventListener(t,s):e.addEventListener(t,new Function(s))};
"use strict";saltos.bootstrap={},saltos.bootstrap.field=t=>(saltos.check_params(t,["id","type"]),""==t.id&&(t.id=saltos.uniqid()),"function"!=typeof saltos.bootstrap.__field[t.type]?(console.log("type "+t.type+" not found"),saltos.html("type "+t.type+" not found")):saltos.bootstrap.__field[t.type](t)),saltos.bootstrap.__field={},saltos.bootstrap.__field.div=t=>(saltos.check_params(t,["class","id","style"]),saltos.html(`<div class="${t.class}" id="${t.id}" style="${t.style}"></div>`)),saltos.bootstrap.__field.container=t=>(saltos.check_params(t,["class"]),""==t.class&&(t.class="container-fluid"),saltos.bootstrap.__field.div(t)),saltos.bootstrap.__field.row=t=>(saltos.check_params(t,["class"]),""==t.class&&(t.class="row"),saltos.bootstrap.__field.div(t)),saltos.bootstrap.__field.col=t=>(saltos.check_params(t,["class"]),""==t.class&&(t.class="col"),saltos.bootstrap.__field.div(t)),saltos.bootstrap.__field.text=t=>{saltos.check_params(t,["datalist"],[]),t.type="text";var e=saltos.html("<div></div>");if(e.append(saltos.bootstrap.__label_helper(t)),e.append(saltos.bootstrap.__text_helper(t)),t.datalist.length)for(var a in e.querySelector("input").setAttribute("list",t.id+"_datalist"),e.append(saltos.html(`<datalist id="${t.id}_datalist"></datalist>`)),t.datalist){var s=t.datalist[a];e.querySelector("datalist").append(saltos.html(`<option value="${s}">`))}return e=saltos.optimize(e)},saltos.bootstrap.__field.hidden=t=>(t.type="hidden",saltos.bootstrap.__text_helper(t)),saltos.bootstrap.__field.integer=t=>{saltos.require("core/lib/imaskjs/imask.min.js"),t.type="text";var e=saltos.bootstrap.__text_helper(t);t.type="integer";var a=e;return saltos.when_visible(a,(()=>{IMask(a,{mask:Number,scale:0})})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.float=t=>{saltos.require("core/lib/imaskjs/imask.min.js"),t.type="text";var e=saltos.bootstrap.__text_helper(t);t.type="float";var a=e;return saltos.when_visible(a,(()=>{IMask(a,{mask:Number,radix:".",mapToRadix:[","],scale:99})})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.color=t=>{saltos.check_params(t,["value"]),""==t.value&&(t.value="#000000"),t.type="color",t.class="form-control-color";var e=saltos.bootstrap.__text_helper(t);return e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.date=t=>{t.type="date";var e=saltos.bootstrap.__text_helper(t);return e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.time=t=>{t.type="time";var e=saltos.bootstrap.__text_helper(t);return e.step=1,e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.datetime=t=>{t.type="datetime-local";var e=saltos.bootstrap.__text_helper(t);return t.type="datetime",e.step=1,e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.textarea=t=>{saltos.require("core/lib/autoheight/autoheight.min.js");var e=saltos.bootstrap.__textarea_helper(t),a=e;return saltos.when_visible(a,(()=>{autoheight(a)})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.ckeditor=t=>{saltos.require("core/lib/ckeditor/ckeditor.min.js");var e=saltos.html("<div></div>");e.append(saltos.bootstrap.__label_helper(t)),e.append(saltos.bootstrap.__textarea_helper(t));var a=e.querySelector("textarea");return saltos.when_visible(a,(()=>{ClassicEditor.create(a).catch((t=>{console.error(t)}))})),e},saltos.bootstrap.__field.codemirror=t=>{saltos.require("core/lib/codemirror/codemirror.min.css"),saltos.require("core/lib/codemirror/codemirror.min.js"),saltos.check_params(t,["mode"]);var e=saltos.html("<div></div>");e.append(saltos.bootstrap.__label_helper(t)),e.append(saltos.bootstrap.__textarea_helper(t));var a=e.querySelector("textarea");return saltos.when_visible(a,(()=>{var e=CodeMirror.fromTextArea(a,{mode:t.mode,styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0});a.nextElementSibling.classList.add("form-control"),a.nextElementSibling.classList.add("p-0"),a.nextElementSibling.style.height="auto",e.on("change",e.save)})),e},saltos.bootstrap.__field.iframe=t=>{saltos.check_params(t,["value","id","class","height"]);var e=saltos.html(`\n        <iframe src="${t.value}" id="${t.id}" frameborder="0"\n            class="form-control p-0 ${t.class}" style="height: ${t.height}"></iframe>\n    `);return e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.select=t=>{saltos.check_params(t,["class","id","disabled","required","autofocus","multiple","size","value","tooltip"]),saltos.check_params(t,["rows"],[]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled"),saltos.eval_bool(t.required)&&(t.required="required"),saltos.eval_bool(t.autofocus)&&(t.autofocus="autofocus"),saltos.eval_bool(t.multiple)&&(t.multiple="multiple"),""!=t.size&&(t.size=`size="${t.size}"`);var e=saltos.html(`\n        <select class="form-select ${t.class}" id="${t.id}" ${t.disabled} ${t.required}\n            ${t.autofocus} ${t.multiple} ${t.size} data-bs-title="${t.tooltip}"></select>\n    `),a=e;for(var s in""!=t.tooltip&&saltos.bootstrap.__tooltip_helper(a),t.rows){var o=t.rows[s],l="";t.value.toString()==o.value.toString()&&(l="selected"),a.append(saltos.html(`<option value="${o.value}" ${l}>${o.label}</option>`))}return e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.multiselect=t=>{saltos.check_params(t,["value","class","id","disabled","size","tooltip"]),saltos.check_params(t,["rows"],[]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled");var e=saltos.html('\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col px-0 one">\n                </div>\n                <div class="col col-auto my-auto two">\n                </div>\n                <div class="col px-0 three">\n                </div>\n            </div>\n        </div>\n    '),a=[],s=[],o=t.value.split(",");for(var l in t.rows){var r=t.rows[l];o.includes(r.value.toString())?s.push(r):a.push(r)}return e.querySelector(".one").append(saltos.bootstrap.__field.hidden(t)),t.type="multiselect",e.querySelector(".one").append(saltos.bootstrap.__field.select({class:t.class,id:t.id+"_abc",disabled:t.disabled,tooltip:t.tooltip,multiple:!0,size:t.size,rows:a})),e.querySelector(".two").append(saltos.bootstrap.__field.button({class:"btn-primary bi-chevron-double-right mb-3",disabled:t.disabled,onclick:()=>{document.querySelectorAll("#"+t.id+"_abc option").forEach((e=>{e.selected&&document.getElementById(t.id+"_xyz").append(e)}));var e=[];document.querySelectorAll("#"+t.id+"_xyz option").forEach((t=>{e.push(t.value)})),document.getElementById(t.id).value=e.join(",")}})),e.querySelector(".two").append(saltos.html("<br/>")),e.querySelector(".two").append(saltos.bootstrap.__field.button({class:"btn-primary bi-chevron-double-left",disabled:t.disabled,onclick:()=>{document.querySelectorAll("#"+t.id+"_xyz option").forEach((e=>{e.selected&&document.getElementById(t.id+"_abc").append(e)}));var e=[];document.querySelectorAll("#"+t.id+"_xyz option").forEach((t=>{e.push(t.value)})),document.getElementById(t.id).value=e.join(",")}})),e.querySelector(".three").append(saltos.bootstrap.__field.select({class:t.class,id:t.id+"_xyz",disabled:t.disabled,tooltip:t.tooltip,multiple:!0,size:t.size,rows:s})),saltos.when_visible(e,(()=>{document.querySelectorAll("label[for="+t.id+"]").forEach((e=>{e.setAttribute("for",t.id+"_abc")}))})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.checkbox=t=>{saltos.check_params(t,["value","id","disabled","readonly","label","tooltip","class"]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled"),saltos.eval_bool(t.readonly)&&(t.readonly="readonly"),saltos.eval_bool(t.value)?t.value=1:t.value=0;var e="";t.value&&(e="checked");var a=saltos.html(`\n        <div class="form-check ${t.class}">\n            <input class="form-check-input" type="checkbox" id="${t.id}" value="${t.value}"\n                ${t.disabled} ${t.readonly} ${e} data-bs-title="${t.tooltip}">\n            <label class="form-check-label" for="${t.id}"\n                data-bs-title="${t.tooltip}">${t.label}</label>\n        </div>\n    `);return""!=t.tooltip&&a.querySelectorAll("input, label").forEach((t=>{saltos.bootstrap.__tooltip_helper(t)})),a.querySelector("input").addEventListener("change",(t=>{t.target.value=t.target.checked?1:0})),a},saltos.bootstrap.__field.switch=t=>{var e=saltos.bootstrap.__field.checkbox(t);return e.classList.add("form-switch"),e.querySelector("input").setAttribute("role","switch"),e},saltos.bootstrap.__field.button=t=>{saltos.check_params(t,["class","id","disabled","value","onclick","tooltip","icon"]),saltos.check_params(t,["label"]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled",t.class+=" opacity-25");var e=saltos.html(`\n        <button type="button" class="btn ${t.class}" id="${t.id}"\n            ${t.disabled} data-bs-title="${t.tooltip}">${t.value}</button>\n    `);if(t.icon&&e.prepend(saltos.html(`<i class="bi bi-${t.icon}"></i>`)),t.value&&t.icon&&e.querySelector("i").classList.add("me-1"),""!=t.tooltip&&saltos.bootstrap.__tooltip_helper(e),saltos.addEventListener(e,"click",t.onclick),""==t.label)return e;var a=saltos.html("<div></div>");return a.append(saltos.bootstrap.__label_helper(t)),a.append(saltos.html("<br/>")),a.append(e),a},saltos.bootstrap.__field.password=t=>{saltos.check_params(t,["label","class","id","placeholder","value","disabled","readonly","required","autofocus","tooltip"]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled"),saltos.eval_bool(t.readonly)&&(t.readonly="readonly"),saltos.eval_bool(t.required)&&(t.required="required"),saltos.eval_bool(t.autofocus)&&(t.autofocus="autofocus");var e=saltos.html(`\n        <div>\n            <div class="input-group">\n                <input type="password" class="form-control ${t.class}" id="${t.id}"\n                    placeholder="${t.placeholder}" value="${t.value}"\n                    ${t.disabled} ${t.readonly} ${t.required} ${t.autofocus}\n                    aria-label="${t.placeholder}" aria-describedby="${t.id}_button"\n                    data-bs-title="${t.tooltip}">\n                <button class="btn btn-primary bi-eye-slash" type="button" id="${t.id}_button"\n                data-bs-title="${t.tooltip}"></button>\n            </div>\n        </div>\n    `);return""!=t.tooltip&&e.querySelectorAll("input[type=password]").forEach((t=>{saltos.bootstrap.__tooltip_helper(t)})),e.querySelector("button").addEventListener("click",(t=>{var e=t.target.parentElement.querySelector("input[type=password], input[type=text]");"password"==e.type?(e.type="text",t.target.classList.remove("bi-eye-slash"),t.target.classList.add("bi-eye")):"text"==e.type&&(e.type="password",t.target.classList.remove("bi-eye"),t.target.classList.add("bi-eye-slash"))})),e.prepend(saltos.bootstrap.__label_helper(t)),e},saltos.bootstrap.__field.file=t=>{saltos.check_params(t,["class","id","value","disabled","required","autofocus","multiple","tooltip"]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled"),saltos.eval_bool(t.required)&&(t.required="required"),saltos.eval_bool(t.autofocus)&&(t.autofocus="autofocus"),saltos.eval_bool(t.multiple)&&(t.multiple="multiple");var e=saltos.html(`\n        <div>\n            <input type="file" class="form-control ${t.class}" id="${t.id}" ${t.disabled}\n                ${t.required} ${t.autofocus} ${t.multiple} data-bs-title="${t.tooltip}">\n            <div class="overflow-auto">\n                <table class="table table-striped table-hover d-none">\n                    <tbody>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    `);e.append(saltos.html("\n        <style>\n            .table {\n                --bs-table-hover-bg: #fbec88;\n                --bs-table-active-bg: #fbec88;\n                --bs-table-hover-color: #373a3c;\n                --bs-table-active-color: #373a3c;\n            }\n        </style>\n    ")),""!=t.tooltip&&e.querySelectorAll("input").forEach((t=>{saltos.bootstrap.__tooltip_helper(t)}));var a=t=>{var e=[];t.nextElementSibling.querySelector("table").querySelectorAll("tr").forEach((t=>{e.push(t.saltos_data)})),t.saltos_data=e},s=t=>{var e=t.target.parentNode.parentNode,s=e.parentNode.parentNode,o=s.parentNode.previousElementSibling,l={action:"delfiles",files:[]};l.files[0]=e.saltos_data,saltos.ajax({url:"index.php",data:JSON.stringify(l),method:"post",content_type:"application/json",success:t=>{saltos.check_response(t)&&(e.saltos_data=t[0],""==t[0].file&&e.remove(),0==s.querySelectorAll("tr").length&&s.classList.add("d-none"),a(o))},error:t=>{saltos.show_error({text:t.statusText,code:t.status})},headers:{token:saltos.token.get()}})};return e.querySelector("input").addEventListener("change",(async t=>{for(var e=t.target,o=t.target.files,l=t.target.nextElementSibling.querySelector("table"),r=0;r<o.length;r++){var i={action:"addfiles",files:[]};i.files[0]={id:saltos.uniqid(),name:o[r].name,size:o[r].size,type:o[r].type,data:"",error:"",file:"",hash:""},l.classList.remove("d-none");var d=saltos.html("tbody",`\n                <tr id="${i.files[0].id}">\n                    <td class="text-break">${i.files[0].name}</td>\n                    <td class="w-25 align-middle">\n                        <div class="progress" role="progressbar" aria-label="Upload percent"\n                            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">\n                            <div class="progress-bar" style="width: 0%"></div>\n                        </div>\n                    </td>\n                    <td class="p-0 align-middle" style="width: 1%"><button class="btn bi-trash border-0"\n                        type="button"></button></td>\n                </tr>\n            `);d.saltos_data=i.files[0],d.querySelector("button").addEventListener("click",s),l.querySelector("tbody").append(d),a(e);var n=new FileReader;for(n.readAsDataURL(o[r]);!n.result&&!n.error;)await new Promise((t=>setTimeout(t,1)));n.result&&(i.files[0].data=n.result,((t,s)=>{saltos.ajax({url:"index.php",data:JSON.stringify(t),method:"post",content_type:"application/json",success:t=>{saltos.check_response(t)&&(s.saltos_data=t[0],a(e))},error:t=>{saltos.show_error({text:t.statusText,code:t.status})},progress:t=>{if(t.lengthComputable){var e=Math.round(t.loaded/t.total*100);s.querySelector(".progress-bar").style.width=e+"%",s.querySelector(".progress").setAttribute("aria-valuenow",e)}},headers:{token:saltos.token.get()}})})(i,d)),n.error&&(i.files[0].error=n.error.message,saltos.show_error({text:n.error.message,code:0}))}})),e.prepend(saltos.bootstrap.__label_helper(t)),e},saltos.bootstrap.__field.link=t=>(t.class="btn-link",saltos.bootstrap.__field.button(t)),saltos.bootstrap.__field.label=t=>{saltos.check_params(t,["id","class","label","tooltip","value"]),""==t.label&&(t.label=t.value);var e=saltos.html(`\n        <label for="${t.id}" class="form-label ${t.class}"\n            data-bs-title="${t.tooltip}">${t.label}</label>\n    `);return""!=t.tooltip&&saltos.bootstrap.__tooltip_helper(e),e},saltos.bootstrap.__field.image=t=>{saltos.check_params(t,["id","class","value","alt","tooltip","width","height"]),""==t.class&&(t.class="img-fluid");var e=saltos.html(`\n        <img id="${t.id}" src="${t.value}" class="${t.class}" alt="${t.alt}"\n            data-bs-title="${t.tooltip}" width="${t.width}" height="${t.height}">\n    `);return""!=t.tooltip&&saltos.bootstrap.__tooltip_helper(e),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.excel=t=>{saltos.require("core/lib/handsontable/handsontable.full.min.css"),saltos.require("core/lib/handsontable/handsontable.full.min.js"),saltos.check_params(t,["id","class","data","rowHeaders","colHeaders","minSpareRows","contextMenu","rowHeaderWidth","colWidths","numcols","numrows"]);var e=saltos.html(`\n        <div style="width: 100%; height: 100%; overflow: auto">\n            <div id="${t.id}" class="${t.class}"></div>\n        </div>\n    `);t.numcols=parseInt(t.numcols),t.numrows=parseInt(t.numrows),t.numcols||(t.numcols=26),t.numrows||(t.numrows=20),""==t.data&&(t.data=[...Array(t.numrows)].map((e=>Array(t.numcols)))),""==t.rowHeaders&&(t.rowHeaders=!0),""==t.colHeaders&&(t.colHeaders=!0),""==t.minSpareRows&&(t.minSpareRows=0),""==t.contextMenu&&(t.contextMenu=!0),""==t.rowHeaderWidth&&(t.rowHeaderWidth=void 0),""==t.colWidths&&(t.colWidths=void 0);var a=e.querySelector("div");return saltos.when_visible(a,(()=>{new Handsontable(a,{data:t.data,rowHeaders:t.rowHeaders,colHeaders:t.colHeaders,minSpareRows:t.minSpareRows,contextMenu:t.contextMenu,rowHeaderWidth:t.rowHeaderWidth,colWidths:t.colWidths,afterChange:(e,s)=>{a.saltos_data=t.data}})})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.pdfjs=t=>{saltos.require("core/lib/pdfjs/pdf_viewer.min.css"),saltos.require("core/lib/pdfjs/pdf.min.mjs"),saltos.require("core/lib/pdfjs/pdf_viewer.min.mjs"),saltos.check_params(t,["id","class","value"]);var e=saltos.html(`\n        <div id="${t.id}" class="${t.class}">\n            <div class="viewerContainer">\n                <div class="pdfViewer"></div>\n            </div>\n        </div>\n    `);e.append(saltos.html("\n        <style>\n            .viewerContainer {\n                position: absolute;\n                width: 100%;\n                left: -9px;\n                top: -9px;\n            }\n            .viewerContainer .canvasWrapper {\n                box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1)!important;\n            }\n            .viewerContainer *,\n            .viewerContainer *::before,\n            .viewerContainer *::after {\n                box-sizing: content-box;\n            }\n        </style>\n    "));var a=e.querySelector(".viewerContainer");return saltos.when_visible(a,(()=>{pdfjsLib.GlobalWorkerOptions.workerSrc="core/lib/pdfjs/pdf.worker.min.mjs",pdfjsLib.getDocument(t.value).promise.then((t=>{if(t.numPages){var e=a,s=new pdfjsViewer.EventBus,o=new pdfjsViewer.PDFViewer({container:e,eventBus:s});s.on("pagesinit",(()=>{o.currentScaleValue="page-width"})),s.on("annotationlayerrendered",(()=>{e.querySelectorAll("a").forEach((t=>{t.setAttribute("target","_blank")}))})),o.removePageBorders=!0,o.setDocument(t),e.style.position="relative",window.addEventListener("resize",(()=>{o.currentScaleValue=2*o.currentScale,o.currentScaleValue="page-width"}))}}),((t,e)=>{saltos.show_error({text:t,code:0})}))})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.table=field=>{saltos.check_params(field,["class","id","checkbox"]),saltos.check_params(field,["header","data","footer"],[]);var obj=saltos.html(`\n        <table class="table table-striped table-hover ${field.class}"\n            id="${field.id}" style="margin-bottom: 0">\n        </table>\n    `);if(Object.keys(field.header).length){for(var key in obj.append(saltos.html("table","\n            <thead>\n                <tr>\n                </tr>\n            </thead>\n        ")),field.checkbox&&(obj.querySelector("thead tr").append(saltos.html("tr",'<th style="width: 1%"><input type="checkbox"/></th>')),obj.querySelector("thead input[type=checkbox]").addEventListener("change",(t=>{var e=t.target;obj.querySelectorAll("tbody input[type=checkbox]").forEach((t=>{t.checked!=e.checked&&t.click()}))})),obj.querySelector("thead input[type=checkbox]").addEventListener("click",(t=>{t.stopPropagation()})),obj.querySelector("thead input[type=checkbox]").parentNode.addEventListener("click",(t=>{t.target.querySelector("input[type=checkbox]").click(),t.stopPropagation()}))),field.header){var val=field.header[key];if("object"==typeof val&&null!==val)var th=saltos.html("tr",`<th>${val.label}</th>`);else var th=saltos.html("tr",`<th>${val}</th>`);val.hasOwnProperty("align")&&th.classList.add("text-"+val.align),obj.querySelector("thead tr").append(th)}field.data.length&&field.data[0].hasOwnProperty("actions")&&obj.querySelector("thead tr").append(saltos.html("tr",'<th style="width: 1%"></th>'))}if(field.data.length){obj.append(saltos.html("table","\n            <tbody>\n            </tbody>\n        ")),Object.keys(field.header).length&&obj.querySelector("tbody").classList.add("table-group-divider");var dropdown_close=()=>{obj.querySelectorAll(".show").forEach((t=>{t.classList.remove("show")}))};for(var key in field.data){var val=field.data[key],row=saltos.html("tbody","<tr></tr>");field.checkbox&&(row.append(saltos.html("tr",'<td><input type="checkbox"/></td>')),row.querySelector("input[type=checkbox]").addEventListener("change",(t=>{t.target.checked?t.target.parentNode.parentNode.classList.add("table-active"):t.target.parentNode.parentNode.classList.remove("table-active"),dropdown_close()})),row.querySelector("input[type=checkbox]").addEventListener("click",(t=>{t.stopPropagation()})),row.addEventListener("click",(t=>{var e=t.target.parentNode.querySelector("input[type=checkbox]");e&&e.click(),t.stopPropagation()})));var iterator=field.header;for(var key2 in Object.keys(iterator).length||(iterator=val),iterator){var val2=val[key2],td=saltos.html("tr","<td></td>");if("object"==typeof val2&&null!==val2)if(val2.hasOwnProperty("type")){var temp=saltos.bootstrap.field(val2);td.append(temp)}else{var temp="object without type";td.append(temp)}else{val2=saltos.toString(val2);var type="text";if(iterator[key2].hasOwnProperty("type")&&(type=iterator[key2].type),"icon"==type){var temp=saltos.html(`<i class="bi bi-${val2}"></i>`);td.append(temp)}else if("html"==type){var temp=saltos.html(val2);td.append(temp)}else if("text"==type)td.append(val2);else{var temp=`unknown type ${type}`;td.append(temp)}}iterator[key2].hasOwnProperty("align")&&td.classList.add("text-"+iterator[key2].align),row.append(td)}if(val.hasOwnProperty("actions")){var td=saltos.html("tr",'<td class="p-0 align-middle text-nowrap"></td>'),dropdown=val.actions.length>1;dropdown&&(td.append(saltos.html('\n                        <div>\n                            <button class="btn border-0 dropdown-toggle" type="button"\n                                data-bs-toggle="dropdown" aria-expanded="false">\n                            </button>\n                            <ul class="dropdown-menu">\n                            </ul>\n                        </div>\n                    ')),td.querySelector("ul").parentElement.addEventListener("show.bs.dropdown",dropdown_close));var first_action=!0;for(var key2 in val.actions){var val2=val.actions[key2];""==val2.url?val2.disabled=!0:val2.onclick=`saltos.open_window("#${val2.url}")`,first_action&&(val2.onclick&&(row.setAttribute("_onclick",val2.onclick),row.addEventListener("dblclick",(event=>{eval(event.target.parentElement.getAttribute("_onclick")),(document.selection&&document.selection.empty||window.getSelection)&&window.getSelection().removeAllRanges()}))),first_action=!1);var button=saltos.bootstrap.__field.button(val2);if(dropdown){button.classList.remove("btn"),button.classList.add("dropdown-item"),button.addEventListener("click",dropdown_close);var li=saltos.html("<li></li>");li.append(button),td.querySelector("ul").append(li)}else button.classList.add("border-0"),td.append(button)}row.append(td)}obj.querySelector("tbody").append(row)}}if(Object.keys(field.footer).length){if(obj.append(saltos.html("table",'\n            <tfoot class="table-group-divider">\n                <tr>\n                </tr>\n            </tfoot>\n        ')),field.data.length&&obj.querySelector("tfoot").classList.add("table-group-divider"),"object"==typeof field.footer){Object.keys(field.header).length!=Object.keys(field.footer).length&&console.log("field.header.length != field.footer.length"),field.checkbox&&obj.querySelector("tfoot tr").append(saltos.html("tr","<td></td>"));var iterator=field.header;for(var key in Object.keys(iterator).length||(iterator=field.footer),iterator){var val=field.footer[key];if("object"==typeof val&&null!==val)var td=saltos.html("tr",`<td>${val.value}</td>`);else var td=saltos.html("tr",`<td>${val}</td>`);iterator[key].hasOwnProperty("align")&&td.classList.add("text-"+iterator[key].align),obj.querySelector("tfoot tr").append(td)}field.data.length&&field.data[0].hasOwnProperty("actions")&&obj.querySelector("tfoot tr").append(saltos.html("tr","<td></td>"))}"string"==typeof field.footer&&obj.querySelector("tfoot tr").append(saltos.html("tr",`<td colspan="100" class="text-center">${field.footer}</td>`))}var old=obj;return obj=saltos.html('<div class="table-responsive"></div>'),obj.append(old),obj.append(saltos.html("\n        <style>\n            .table {\n                --bs-table-hover-bg: #fbec88;\n                --bs-table-active-bg: #fbec88;\n                --bs-table-hover-color: #373a3c;\n                --bs-table-active-color: #373a3c;\n            }\n        </style>\n    ")),obj=saltos.bootstrap.__label_combine(field,obj),obj},saltos.bootstrap.__field.alert=t=>{saltos.check_params(t,["class","id","title","text","body","close"]);var e=saltos.html(`\n        <div class="alert ${t.class}" role="alert" id="${t.id}"></div>\n    `);return""!=t.title&&e.append(saltos.html(`<h4>${t.title}</h4>`)),""!=t.text&&e.append(saltos.html(`<p>${t.text}</p>`)),""!=t.body&&e.append(saltos.html(t.body)),saltos.eval_bool(t.close)&&(e.classList.add("alert-dismissible"),e.classList.add("fade"),e.classList.add("show"),e.append(saltos.html('\n            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n        ')),e.append(saltos.html("\n            <style>\n                .alert-dismissible {\n                    padding-right: var(--bs-alert-padding-x);\n                }\n            </style>\n        "))),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.card=t=>{saltos.check_params(t,["id","image","alt","header","footer","title","text","body"]);var e=saltos.html(`<div class="card" id="${t.id}"></div>`);return""!=t.image&&e.append(saltos.html(`<img src="${t.image}" class="card-img-top" alt="${t.alt}">`)),""!=t.header&&e.append(saltos.html(`<div class="card-header">${t.header}</div>`)),e.append(saltos.html('<div class="card-body"></div>')),""!=t.title&&e.querySelector(".card-body").append(saltos.html(`<h5 class="card-title">${t.title}</h5>`)),""!=t.text&&e.querySelector(".card-body").append(saltos.html(`<p class="card-text">${t.text}</p>`)),""!=t.body&&e.querySelector(".card-body").append(saltos.html(t.body)),""!=t.footer&&e.append(saltos.html(`<div class="card-footer">${t.footer}</div>`)),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.chartjs=t=>{saltos.require("core/lib/chartjs/chart.umd.min.js"),saltos.check_params(t,["id","mode","data"]);var e=saltos.html(`<canvas id="${t.id}"></canvas>`);for(var a in t.data.datasets)t.data.datasets[a].borderWidth=1;var s=e;return saltos.when_visible(s,(()=>{new Chart(s,{type:t.mode,data:t.data})})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.tags=t=>{saltos.check_params(t,["id","value"]);var e=saltos.html("<div></div>");t.class="first",e.append(saltos.bootstrap.__field.hidden(t)),t.id_old=t.id,t.id_new=t.id+"_tags",t.id=t.id_new,t.value_old=t.value,t.value_array=t.value.split(","),""==t.value&&(t.value_array=[]),t.value="",t.class="last",e.append(saltos.bootstrap.__field.text(t)),t.id=t.id_old,t.value=t.value_old;var a=t=>{var a=saltos.html(`<span class="badge text-bg-primary mt-1 me-1 fs-6 fw-normal pe-2"\n            saltos-data="${t}">\n            ${t} <i class="bi bi-x-circle ps-1" style="cursor: pointer"></i>\n        </span>`);e.append(a),a.querySelector("i").addEventListener("click",(t=>{var a=t.target.parentNode,s=a.getAttribute("saltos-data"),o=e.querySelector("input.first"),l=o.value.split(","),r=[];for(var i in l)l[i]=l[i].trim(),l[i]!=s&&r.push(l[i]);o.value=r.join(","),a.remove()}))};for(var s in e.querySelector("input.last").addEventListener("keydown",(t=>{if(13==saltos.get_keycode(t)){var s=e.querySelector("input.first"),o=e.querySelector("input.last"),l=s.value.split(","),r=o.value,i=[];for(var d in l){if(l[d]=l[d].trim(),l[d]==r)return;""!=l[d]&&i.push(l[d])}a(r),i.push(r),s.value=i.join(","),o.value=""}})),t.value_array){var o=t.value_array[s].trim();a(o)}return saltos.when_visible(e,(()=>{document.querySelectorAll("label[for="+t.id_old+"]").forEach((e=>{e.setAttribute("for",t.id_new)}))})),e},saltos.bootstrap.__field.gallery=t=>{saltos.require("core/lib/venobox/venobox.min.css"),saltos.require("core/lib/venobox/venobox.min.js"),saltos.require("core/lib/masonry/masonry.pkgd.min.js"),saltos.require("core/lib/imagesloaded/imagesloaded.pkgd.min.js"),saltos.check_params(t,["id","class","images"]),""==t.class&&(t.class="col");var e=saltos.html(`\n        <div id="${t.id}" class="container-fluid">\n            <div class="row">\n            </div>\n        </div>\n    `);if("object"==typeof t.images)for(var a in t.images){var s=t.images[a];"string"==typeof s&&(s={image:s}),saltos.check_params(s,["image","title"]);var o=saltos.html(`\n                <div class="${t.class} p-1">\n                    <a href="${s.image}" class="venobox" data-gall="${t.id}" title="${s.title}">\n                        <img src="${s.image}" class="img-fluid img-thumbnail" />\n                    </a>\n                </div>\n            `);e.querySelector(".row").append(o)}var l=e.querySelector(".row");return saltos.when_visible(l,(()=>{var t=new Masonry(l,{percentPosition:!0});imagesLoaded(l).on("progress",(()=>{t.layout()})),new VenoBox})),e=saltos.bootstrap.__label_combine(t,e)},saltos.bootstrap.__field.placeholder=t=>(saltos.check_params(t,["id"]),saltos.html(`\n        <div id="${t.id}" class="w-100 h-100 placeholder-glow" aria-hidden="true">\n            <span class="w-100 h-100 placeholder"></span>\n        </div>\n    `)),saltos.bootstrap.__text_helper=t=>{saltos.check_params(t,["type","class","id","placeholder","value","disabled","readonly","required","autofocus","tooltip","style"]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled"),saltos.eval_bool(t.readonly)&&(t.readonly="readonly"),saltos.eval_bool(t.required)&&(t.required="required"),saltos.eval_bool(t.autofocus)&&(t.autofocus="autofocus");var e=saltos.html(`\n        <input type="${t.type}" class="form-control ${t.class}" id="${t.id}"\n            style="${t.style}" placeholder="${t.placeholder}"\n            value="${t.value}" ${t.disabled} ${t.readonly} ${t.required} ${t.autofocus}\n                data-bs-title="${t.tooltip}">\n    `);return""!=t.tooltip&&saltos.bootstrap.__tooltip_helper(e),e},saltos.bootstrap.__textarea_helper=t=>{saltos.check_params(t,["class","id","placeholder","value","disabled","readonly","required","autofocus","rows","tooltip"]),saltos.eval_bool(t.disabled)&&(t.disabled="disabled"),saltos.eval_bool(t.readonly)&&(t.readonly="readonly"),saltos.eval_bool(t.required)&&(t.required="required"),saltos.eval_bool(t.autofocus)&&(t.autofocus="autofocus");var e=saltos.html(`\n        <textarea class="form-control ${t.class}" id="${t.id}"\n            placeholder="${t.placeholder}" rows="${t.rows}"\n            ${t.disabled} ${t.readonly} ${t.required} ${t.autofocus}\n            data-bs-title="${t.tooltip}">${t.value}</textarea>\n    `);return""!=t.tooltip&&saltos.bootstrap.__tooltip_helper(e),e},saltos.bootstrap.__tooltip_helper=t=>{var e=new bootstrap.Tooltip(t,{trigger:"hover"});t.addEventListener("focus",(()=>{e.hide()})),t.addEventListener("click",(()=>{e.hide()}))},saltos.bootstrap.__label_helper=t=>{if(saltos.check_params(t,["label"]),""==t.label)return"";var e=saltos.copy_object(t);return delete e.class,saltos.bootstrap.__field.label(e)},saltos.bootstrap.__label_combine=(t,e)=>{var a=saltos.html("<div></div>");return a.append(saltos.bootstrap.__label_helper(t)),a.append(e),a=saltos.optimize(a)},saltos.bootstrap.menu=t=>{saltos.check_params(t,["class"]),saltos.check_params(t,["menu"],[]);var e=saltos.html(`<ul class="${t.class}"></ul>`);for(var a in t.menu){var s=t.menu[a];if(saltos.check_params(s,["name","icon","disabled","active","onclick","dropdown_menu_end"]),saltos.check_params(s,["menu"],[]),saltos.eval_bool(s.disabled)&&(s.disabled="disabled"),saltos.eval_bool(s.active)&&(s.active="active"),s.menu.length){saltos.eval_bool(s.dropdown_menu_end)&&(s.dropdown_menu_end="dropdown-menu-end");var o=saltos.html(`\n                <li class="nav-item dropdown">\n                    <button class="nav-link dropdown-toggle" role="button"\n                        data-bs-toggle="dropdown" aria-expanded="false">\n                        ${s.name}\n                    </button>\n                    <ul class="dropdown-menu ${s.dropdown_menu_end}">\n                    </ul>\n                </li>\n            `);for(var l in s.icon&&o.querySelector("button").prepend(saltos.html(`<i class="bi bi-${s.icon}"></i>`)),s.name&&s.icon&&o.querySelector("i").classList.add("me-1"),s.menu){var r=s.menu[l];if(saltos.check_params(r,["name","icon","disabled","active","onclick","divider"]),saltos.eval_bool(r.disabled)&&(r.disabled="disabled"),saltos.eval_bool(r.active)&&(r.active="active"),saltos.eval_bool(r.divider))var i=saltos.html('<li><hr class="dropdown-divider"></li>');else{i=saltos.html(`\n                        <li>\n                            <button class="dropdown-item ${r.disabled} ${r.active}">\n                                ${r.name}\n                            </button>\n                        </li>`);r.icon&&i.querySelector("button").prepend(saltos.html(`<i class="bi bi-${r.icon}"></i>`)),r.name&&r.icon&&i.querySelector("i").classList.add("me-1"),saltos.eval_bool(r.disabled)||saltos.addEventListener(i,"click",r.onclick)}o.querySelector("ul").append(i)}}else{o=saltos.html(`\n                <li class="nav-item">\n                    <button class="nav-link ${s.disabled} ${s.active}">${s.name}</button>\n                </li>\n            `);s.icon&&o.querySelector("button").prepend(saltos.html(`<i class="bi bi-${s.icon}"></i>`)),s.name&&s.icon&&o.querySelector("i").classList.add("me-1"),saltos.eval_bool(s.disabled)||saltos.addEventListener(o,"click",s.onclick)}e.append(o)}return e},saltos.bootstrap.navbar=t=>{saltos.check_params(t,["id","space"]),saltos.check_params(t,["brand"],{}),saltos.check_params(t.brand,["name","logo","width","height"]),saltos.check_params(t,["items"],[]);var e=saltos.html(`\n        <nav class="navbar navbar-expand-md navbar-dark bg-primary fixed-top">\n            <div class="container-fluid">\n                <div class="navbar-brand">\n                    <img src="${t.brand.logo}" alt="${t.brand.name}" width="${t.brand.width}"\n                        height="${t.brand.height}" class="d-inline-block align-text-top">\n                    ${t.brand.name}\n                </div>\n                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"\n                    data-bs-target="#${t.id}" aria-controls="${t.id}" aria-expanded="false"\n                    aria-label="Toggle navigation">\n                    <span class="navbar-toggler-icon"></span>\n                </button>\n                <div class="collapse navbar-collapse" id="${t.id}">\n                </div>\n            </div>\n        </nav>\n    `);for(var a in t.items){var s=t.items[a];e.querySelector(".collapse").append(s)}if(saltos.eval_bool(t.space)){var o=saltos.html("<div></div>");return o.append(e),o.append(saltos.html('<div class="pt-5 pb-2"></div>')),o}return e},saltos.bootstrap.__modal={},saltos.bootstrap.modal=t=>{if("close"==t)return"object"==typeof saltos.bootstrap.__modal.instance&&saltos.bootstrap.__modal.instance.hide();if("isopen"==t)return"object"==typeof saltos.bootstrap.__modal.obj&&saltos.bootstrap.__modal.obj.classList.contains("show");if(saltos.bootstrap.modal("isopen"))return!1;saltos.check_params(t,["id","class","title","close","body","footer","static"]);var e="";saltos.eval_bool(t.static)&&(e='data-bs-backdrop="static" data-bs-keyboard="false"');var a=saltos.html(`\n        <div class="modal fade" id="${t.id}" tabindex="-1" aria-labelledby="${t.id}_label"\n            aria-hidden="true" ${e}>\n            <div class="modal-dialog ${t.class}">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h1 class="modal-title fs-5" id="${t.id}_label">${t.title}</h1>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal"\n                            aria-label="${t.close}"></button>\n                    </div>\n                    <div class="modal-body">\n                    </div>\n                    <div class="modal-footer">\n                    </div>\n                </div>\n            </div>\n        </div>\n    `);document.body.append(a),a.querySelector(".modal-body").append(saltos.html(t.body)),a.querySelector(".modal-footer").append(t.footer);var s=new bootstrap.Modal(a);return saltos.bootstrap.__modal.obj=a,saltos.bootstrap.__modal.instance=s,a.addEventListener("shown.bs.modal",(t=>{a.querySelectorAll("[autofocus]").forEach((t=>{t.focus()}))})),a.addEventListener("hidden.bs.modal",(t=>{s.dispose(),a.remove()})),s.show(),!0},saltos.bootstrap.__offcanvas={},saltos.bootstrap.offcanvas=t=>{if("close"==t)return"object"==typeof saltos.bootstrap.__offcanvas.instance&&saltos.bootstrap.__offcanvas.instance.hide();if("isopen"==t)return"object"==typeof saltos.bootstrap.__offcanvas.obj&&saltos.bootstrap.__offcanvas.obj.classList.contains("show");if(saltos.bootstrap.offcanvas("isopen"))return!1;saltos.check_params(t,["id","class","title","close","body","static"]);var e="";saltos.eval_bool(t.static)&&(e='data-bs-backdrop="static" data-bs-keyboard="false"');var a=saltos.html(`\n        <div class="offcanvas ${t.class}" tabindex="-1" id="${t.id}"\n            aria-labelledby="${t.id}_label" ${e}>\n            <div class="offcanvas-header">\n                <h5 class="offcanvas-title" id="${t.id}_label">${t.title}</h5>\n                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"\n                    aria-label="${t.close}"></button>\n            </div>\n            <div class="offcanvas-body">\n            </div>\n        </div>\n    `);document.body.append(a),a.querySelector(".offcanvas-body").append(saltos.html(t.body));var s=new bootstrap.Offcanvas(a);return saltos.bootstrap.__offcanvas.obj=a,saltos.bootstrap.__offcanvas.instance=s,a.addEventListener("shown.bs.offcanvas",(t=>{a.querySelectorAll("[autofocus]").forEach((t=>{t.focus()}))})),a.addEventListener("hidden.bs.offcanvas",(t=>{s.dispose(),a.remove()})),s.show(),!0},saltos.bootstrap.toast=t=>{saltos.require("core/lib/md5/md5.min.js"),saltos.check_params(t,["id","class","close","title","subtitle","body"]),0==document.querySelectorAll(".toast-container").length&&document.body.append(saltos.html('<div\n            class="toast-container position-fixed bottom-0 end-0 p-3"></div>'));var e=md5(JSON.stringify(t));if(document.querySelector(`.toast[hash=x${e}]`))return!1;var a=saltos.html(`\n        <div id="${t.id}" class="toast ${t.class}" role="alert" aria-live="assertive"\n            aria-atomic="true" hash="x${e}">\n            <div class="toast-header">\n                <strong class="me-auto">${t.title}</strong>\n                <small>${t.subtitle}</small>\n                <button type="button" class="btn-close" data-bs-dismiss="toast"\n                    aria-label="${t.close}"></button>\n            </div>\n            <div class="toast-body">\n            </div>\n        </div>\n    `);document.querySelector(".toast-container").append(a),a.querySelector(".toast-body").append(t.body);var s=new bootstrap.Toast(a);return a.addEventListener("hidden.bs.toast",(t=>{s.dispose(),a.remove()})),s.show(),!0};
"use strict";saltos.hash={},saltos.hash.get=()=>{var t=document.location.hash;return t.length&&"#"==t.substr(0,1)&&(t=t.substr(1)),t},saltos.hash.set=t=>{t.length&&"#"!=t.substr(0,1)&&(t="#"+t),history.replaceState(null,null,"."+t)},saltos.hash.add=t=>{t.length&&"#"!=t.substr(0,1)&&(t="#"+t),history.pushState(null,null,"."+t)},saltos.hash.trigger=()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))},window.onhashchange=t=>{saltos.bootstrap.modal("close"),saltos.bootstrap.offcanvas("close"),saltos.form_app.screen("loading"),saltos.send_request(saltos.hash.get())},saltos.token={},saltos.token.get=()=>localStorage.getItem("saltos.token.token"),saltos.token.get_expires=()=>localStorage.getItem("saltos.token.expires"),saltos.token.get_autorenew=()=>1e3*localStorage.getItem("saltos.token.autorenew"),saltos.token.get_autocheck=()=>1e3*localStorage.getItem("saltos.token.autocheck"),saltos.token.set=t=>{localStorage.setItem("saltos.token.token",t.token),localStorage.setItem("saltos.token.expires",t.expires_at),localStorage.setItem("saltos.token.autorenew",t.autorenew_at),localStorage.setItem("saltos.token.autocheck",t.autocheck_at)},saltos.token.unset=()=>{localStorage.removeItem("saltos.token.token"),localStorage.removeItem("saltos.token.expires"),localStorage.removeItem("saltos.token.autorenew"),localStorage.removeItem("saltos.token.autocheck")},saltos.authenticate={},saltos.authenticate.authtoken=(t,e)=>{saltos.ajax({url:"index.php",data:JSON.stringify({action:"authtoken",user:t,pass:e}),method:"post",content_type:"application/json",async:!1,success:t=>{if(saltos.check_response(t))return"ok"==t.status?(saltos.token.set(t),void saltos.authenticate.autorenew(!0)):"ko"==t.status?(saltos.token.unset(),void saltos.authenticate.autorenew()):void saltos.show_error(t)},error:t=>{saltos.show_error({text:t.statusText,code:t.status})}})},saltos.authenticate.reauthtoken=()=>{saltos.ajax({url:"index.php",data:JSON.stringify({action:"reauthtoken"}),method:"post",content_type:"application/json",async:!1,success:t=>{if(saltos.check_response(t))return"ok"==t.status?(saltos.token.set(t),void saltos.authenticate.autorenew(!0)):"ko"==t.status?(saltos.token.unset(),void saltos.authenticate.autorenew()):void saltos.show_error(t)},error:t=>{saltos.show_error({text:t.statusText,code:t.status})},headers:{token:saltos.token.get()}})},saltos.authenticate.deauthtoken=()=>{saltos.ajax({url:"index.php",data:JSON.stringify({action:"deauthtoken"}),method:"post",content_type:"application/json",async:!1,success:t=>{if(saltos.check_response(t))return"ok"==t.status||"ko"==t.status?(saltos.token.unset(),void saltos.authenticate.autorenew()):void saltos.show_error(t)},error:t=>{saltos.show_error({text:t.statusText,code:t.status})},headers:{token:saltos.token.get()}})},saltos.authenticate.checktoken=()=>{saltos.ajax({url:"index.php",data:JSON.stringify({action:"checktoken"}),method:"post",content_type:"application/json",async:!1,success:t=>{if(saltos.check_response(t))return"ok"==t.status?(saltos.token.set(t),void saltos.authenticate.autorenew(!0)):"ko"==t.status?(saltos.token.unset(),void saltos.authenticate.autorenew()):void saltos.show_error(t)},error:t=>{saltos.show_error({text:t.statusText,code:t.status})},headers:{token:saltos.token.get()}})},saltos.authenticate.checkrenew=()=>{new Date(saltos.token.get_expires()).getTime()-(new Date).getTime()<saltos.token.get_autorenew()&&saltos.authenticate.reauthtoken()},saltos.authenticate.__autorenew_timer=null,saltos.authenticate.autorenew=t=>{t&&!saltos.authenticate.__autorenew_timer&&(saltos.authenticate.checkrenew(),saltos.authenticate.__autorenew_timer=setInterval(saltos.authenticate.checkrenew,saltos.token.get_autocheck())),!t&&saltos.authenticate.__autorenew_timer&&(clearInterval(saltos.authenticate.__autorenew_timer),saltos.authenticate.__autorenew_timer=null)},saltos.tabs={},saltos.tabs.listeners={},saltos.tabs.set_listener=(t,e)=>{saltos.tabs.listeners[t]=e},saltos.tabs.unset_listener=t=>{delete saltos.tabs.listeners[t]},saltos.tabs.send=(t,e)=>{localStorage.setItem("saltos.tabs.name",t),localStorage.setItem("saltos.tabs.data",e),localStorage.setItem("saltos.tabs.trigger",Math.random()),window.dispatchEvent(new StorageEvent("storage",{storageArea:localStorage,key:"saltos.tabs.trigger"}))},window.onstorage=t=>{if(t.storageArea==localStorage&&"saltos.tabs.trigger"==t.key){var e=localStorage.getItem("saltos.tabs.name"),s=localStorage.getItem("saltos.tabs.data");saltos.tabs.listeners.hasOwnProperty(e)&&saltos.tabs.listeners[e](s)}};
"use strict";saltos.show_error=a=>{console.log(a),"object"==typeof a?saltos.alert("Error "+a.code,a.text):document.body.append(saltos.html(`<pre class="m-3">${a}</pre>`))},saltos.alert=(a,t)=>{var e;saltos.bootstrap.modal({title:a,close:"Close",body:t,footer:(e=saltos.html("<div></div>"),e.append(saltos.bootstrap.field({type:"button",value:"Close",class:"btn-primary",onclick:()=>{saltos.bootstrap.modal("close")}})),e)})},saltos.check_response=a=>"object"!=typeof a?(saltos.show_error(a),!1):"object"!=typeof a.error||(saltos.show_error(a.error),!1),saltos.send_request=a=>{saltos.ajax({url:"index.php?"+a,success:a=>{saltos.check_response(a)&&saltos.process_response(a)},error:a=>{saltos.show_error({text:a.statusText,code:a.status})},headers:{token:saltos.token.get()}})},saltos.process_response=a=>{for(var t in a){var e=a[t];t=saltos.fix_key(t),"function"==typeof saltos.form_app[t]?saltos.form_app[t](e):(console.log("type "+t+" not found"),document.body.append(saltos.html("type "+t+" not found")))}},saltos.form_app={},saltos.__form_app={fields:[],data:{},templates:{}},saltos.form_app.data=a=>{if(a.hasOwnProperty("#attr")&&a["#attr"].hasOwnProperty("template_id")){var t=a["#attr"].template_id;if(!Array.isArray(a.value))return void console.log("data for template "+t+" is not an array of rows");for(var e in a.value){var s=a.value[e];parseInt(e)&&saltos.form_app.layout(saltos.form_app.__layout_template_helper(t,e)),saltos.form_app.data(saltos.form_app.__data_template_helper(t,s,e))}}else if(Array.isArray(a))console.log("data is an array instead of an object of key and val pairs");else for(var e in a){null===(s=a[e])&&(s="");var r=document.getElementById(e);r&&(r.value=s,"checkbox"==r.type&&(r.checked=!!s));var o=saltos.__form_app.fields.find((a=>a.id==e));void 0!==o&&(o.value=s)}},saltos.form_app.__data_template_helper=(a,t,e)=>{for(var s in t){var r=t[s];delete t[s],t[a+"."+e+"."+s]=r}return t},saltos.form_app.__layout_template_helper=(a,t)=>{var e=saltos.copy_object(saltos.__form_app.templates[a]);for(var s in e.value){var r=e.value[s];if(r["#attr"].hasOwnProperty("id")){var o=r["#attr"].id;r["#attr"].id=a+"."+t+"."+o}}return e},saltos.form_app.layout=(a,t)=>{if(a.hasOwnProperty("#attr")&&a["#attr"].hasOwnProperty("template_id")){var e=a["#attr"].template_id;delete(i=saltos.copy_object(a))["#attr"].template_id,saltos.__form_app.templates[e]=i,a=saltos.form_app.__layout_template_helper(e,0)}a=saltos.form_app.__layout_auto_helper(a);var s=[];for(var r in a){var o=a[r];r=saltos.fix_key(r);var l={},p=o;if(saltos.is_attr_value(o)&&(l=o["#attr"],p=o.value),l.hasOwnProperty("type")||(l.type=r),"layout"==r){var n=saltos.form_app.layout({value:p,"#attr":l},"div");s.push(n)}else if(["container","col","row","div"].includes(r)){n=saltos.bootstrap.field(l);var i=saltos.form_app.layout(p,"arr");for(var d in i)n.append(i[d]);s.push(n)}else{if("object"==typeof p)for(var _ in p)l.hasOwnProperty(_)||(l[_]=p[_]);else l.hasOwnProperty("value")||(l.value=p);if(saltos.check_params(l,["id","source"]),""==l.id&&(l.id=saltos.uniqid()),saltos.__form_app.fields.push(l),""!=l.source){n=saltos.bootstrap.field({type:"placeholder",id:l.id});saltos.__source_helper(l)}else n=saltos.bootstrap.field(l);s.push(n)}}if("arr"==t)return s;var c=saltos.html("<div></div>");for(var d in s)c.append(s[d]);if(c=saltos.optimize(c),"div"==t)return c;document.body.append(c),(n=document.querySelector("[autofocus]"))&&n.focus()},saltos.form_app.__layout_auto_helper=a=>{if(a.hasOwnProperty("value")&&a.hasOwnProperty("#attr")){var t=a["#attr"],e=a.value;if(saltos.check_params(t,["auto","cols_per_row"]),saltos.check_params(t,["container_class","row_class","col_class"]),saltos.check_params(t,["container_style","row_style","col_style"]),""==t.cols_per_row&&(t.cols_per_row=1/0),"true"==t.auto){var s=[];for(var r in e)s.push([r,e[r]]);a={container:{value:{},"#attr":{class:t.container_class,style:t.container_style}}};for(var o=0,l=0,p=1;s.length;){var n=s.shift();p&&(o++,a.container.value["row#"+o]={value:{},"#attr":{class:t.row_class,style:t.row_style}}),l++;var i=t.col_class,d=t.col_style;n[1].hasOwnProperty("#attr")&&(n[1]["#attr"].hasOwnProperty("col_class")&&(i=n[1]["#attr"].col_class),n[1]["#attr"].hasOwnProperty("col_style")&&(d=n[1]["#attr"].col_style)),"hidden"==saltos.fix_key(n[0])&&(i="d-none",d=""),a.container.value["row#"+o].value["col#"+l]={value:{},"#attr":{class:i,style:d}},a.container.value["row#"+o].value["col#"+l].value[n[0]]=n[1],l>=t.cols_per_row?(l=0,p=1):p=0}}else a=e}return a},saltos.form_app.style=a=>{for(var t in a){var e=a[t];if("inline"==(t=saltos.fix_key(t))){var s=document.createElement("style");s.innerHTML=e,document.head.append(s)}"file"==t&&saltos.require(e)}},saltos.form_app.javascript=a=>{for(var t in a){var e=a[t];if("inline"==(t=saltos.fix_key(t))){var s=document.createElement("script");s.innerHTML=e,document.body.append(s)}"file"==t&&saltos.require(e)}},saltos.form_app.title=a=>{saltos.hasOwnProperty("x_powered_by")?document.title=a+" - "+saltos.x_powered_by:document.title=a},saltos.form_app.screen=a=>{var t;return"loading"==a?!(t=document.getElementById("loading"))&&(t=saltos.html('\n            <div id="loading" class="w-100 h-100 position-fixed top-0 start-0 opacity-75">\n                <div class="spinner-border position-fixed top-50 start-50" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n            </div>\n        '),document.querySelector("html").getAttribute("data-bs-theme")?(t.classList.add("bg-dark"),t.classList.add("text-light")):(t.classList.add("bg-light"),t.classList.add("text-dark")),document.body.append(t),!0):"unloading"==a?!!(t=document.getElementById("loading"))&&(t.remove(),!0):"clear"==a&&(document.body.innerHTML="",!0)},saltos.form_app.navbar=a=>{if(a["#attr"]=saltos.parse_data(a["#attr"]),(a=saltos.join_attr_value(a)).hasOwnProperty("items")){for(var t in a.items){var e=a.items[t];if("menu"==saltos.fix_key(t)){var s="",r=[];for(var o in saltos.is_attr_value(e)&&(e["#attr"].hasOwnProperty("class")&&(s=e["#attr"].class),e=e.value),e){if("string"==typeof(d=e[o]).value)r.push(d["#attr"]);else if(d.value.hasOwnProperty("menu")){var l=[];for(var p in d.value.menu){var n=d.value.menu[p];l.push(n["#attr"])}r.push({...d["#attr"],menu:l})}}a.items[t]=saltos.bootstrap.menu({class:s,menu:r})}else if("form"==saltos.fix_key(t)){s="";saltos.is_attr_value(e)&&(e["#attr"].hasOwnProperty("class")&&(s=e["#attr"].class),e=e.value);var i=saltos.html(`<form class='${s}' onsubmit='return false'></form>`);for(var o in e){var d;(d=e[o])["#attr"].type=saltos.fix_key(o),i.append(saltos.bootstrap.field(d["#attr"]))}a.items[t]=i}}}i=saltos.bootstrap.navbar(a);document.body.append(i)},saltos.__source_helper=a=>{saltos.check_params(a,["id","source"]),""!=a.source&&saltos.ajax({url:"index.php?"+a.source,success:t=>{if(saltos.check_response(t)){for(var e in a.source="",t)a[e]=t[e];document.getElementById(a.id).replaceWith(saltos.bootstrap.field(a))}},error:a=>{saltos.show_error({text:a.statusText,code:a.status})},headers:{token:saltos.token.get()}})},saltos.get_data=a=>{saltos.__form_app.data={};var t=["text","color","date","time","datetime-local","hidden","textarea","checkbox","password","file","select-one"];for(var e in saltos.__form_app.fields){var s=saltos.__form_app.fields[e];if(!s.hasOwnProperty("ignore")||"true"!=s.ignore){var r=document.getElementById(s.id);if(r&&t.includes(r.type)){var o=r.value,l=s.value.toString();"textarea"==r.type?(o=o.replace(/\r\n|\r/g,"\n"),l=l.replace(/\r\n|\r/g,"\n")):"integer"==s.type?(o=parseInt(o),l=parseInt(l),isNaN(o)&&(o=0),isNaN(l)&&(l=0)):"float"==s.type&&(o=parseFloat(o),l=parseFloat(l),isNaN(o)&&(o=0),isNaN(l)&&(l=0)),(o!=l||a)&&(saltos.__form_app.data[s.id]=o)}}}return saltos.__form_app.data=saltos.__get_data_ids_helper(saltos.__form_app.data),saltos.__form_app.data=saltos.parse_data(saltos.__form_app.data),saltos.__form_app.data},saltos.__get_data_ids_helper=a=>{for(var t in a){var e=t.split(".");if(3==e.length&&"id"!=e[2]&&(e[2]="id",e=e.join("."),!a.hasOwnProperty(e))){var s=document.getElementById(e);if(s){var r=s.value;""!=r&&(a[e]=r)}}}return a},saltos.parse_data=a=>{for(var t in a){var e=t.split(".");if(2==e.length){var s=e[0],r=e[1],o=a[t];a.hasOwnProperty(s)||(a[s]={}),a[s][r]=o,delete a[t]}if(3==e.length){s=e[0],r=e[1];var l=e[2];o=a[t];a.hasOwnProperty(s)||(a[s]={}),a[s].hasOwnProperty(r)||(a[s][r]={}),a[s][r][l]=o,delete a[t]}}return a},saltos.check_required=()=>{var a=null;return document.querySelectorAll("[required]").forEach((t=>{t.classList.remove("is-valid"),t.classList.remove("is-invalid"),""==t.value?(t.classList.add("is-invalid"),a||(a=t)):t.classList.add("is-valid")})),!a||(a.focus(),!1)},saltos.form_disabled=a=>{saltos.__form_helper("disabled",a)},saltos.form_readonly=a=>{saltos.__form_helper("readonly",a)},saltos.__form_helper=(a,t)=>{var e=["text","color","date","time","datetime-local","hidden","textarea","checkbox","password","file","select-one"];for(var s in saltos.__form_app.fields){var r=saltos.__form_app.fields[s],o=document.getElementById(r.id);o&&e.includes(o.type)&&(t?o.setAttribute(a,""):o.removeAttribute(a))}},saltos.parentNode_search=(a,t)=>{for(var e=0;e<100&&!(a=a.parentNode).classList.contains(t);e++);return a},(()=>{var a=window.matchMedia("(prefers-color-scheme: dark)"),t=a=>{document.querySelector("html").setAttribute("data-bs-theme",a.matches?"dark":"")};t(a),a.addEventListener("change",t),saltos.token.get()&&saltos.authenticate.checktoken(),saltos.token.get()?(["","app/login"].includes(saltos.hash.get())&&saltos.hash.set("app/dashboard"),saltos.hash.trigger()):saltos.send_request("app/login")})();
