"use strict";var saltos=saltos||{};saltos.init_error=function(){window.onerror=function(t,a,r,s,i){if(!isset(i)||!isset(i.stack))i={stack:"unknown"};var n={action:"adderror",jserror:t,details:"Error on file "+a+":"+r+":"+s+", userAgent is "+navigator.userAgent,backtrace:i.stack};$.ajax({url:"index.php",data:JSON.stringify(n),type:"post"})}},saltos.addlog=function(t){var a={action:"addlog",msg:t};$.ajax({url:"index.php",data:JSON.stringify(a),type:"post"})},saltos.check_params=function(t,a,r){for(var s in isset(r)||(r=""),a)isset(t[a[s]])||(t[a[s]]=r)},saltos.uniqid=function(){return"id"+Math.floor(1e6*Math.random())},saltos.when_visible=function(t,a,r){$(t).is("[id]")||$(t).attr("id","fix"+saltos.uniqid());var s="#"+$(t).attr("id"),i=setInterval((function(){var t=$(s);$(t).length?$(t).is(":visible")&&(clearInterval(i),a(r)):clearInterval(i)}),100)},jQuery,saltos.init_error();
"use strict";saltos.form_field=function(e){if(saltos.check_params(e,["type","id","label","class","placeholder","value","disabled","readonly","required"]),e.disabled&&(e.disabled="disabled"),e.readonly&&(e.readonly="readonly"),e.required&&(e.required="required"),["label","checkbox","switch"].includes(e.type))return saltos.__form_field[e.type](e);if(""==e.label)return saltos.__form_field[e.type](e);var a=$("<div></div>");return $(a).append(saltos.__form_field.label(e)),$(a).append("<div></div>"),$("div:last",a).append(saltos.__form_field[e.type](e)),a},saltos.__form_field={},saltos.__form_field.container=function(e){return saltos.check_params(e,["container"]),""==e.container&&(e.container="container-fluid"),$(`<div class="${e.container}"></div>`)},saltos.__form_field.row=function(e){return saltos.check_params(e,["row"]),""==e.row&&(e.row="row"),$(`<div class="${e.row}"></div>`)},saltos.__form_field.col=function(e){return saltos.check_params(e,["col"]),""==e.col&&(e.col="col"),$(`<div class="${e.col}"></div>`)},saltos.__form_field.text=function(e){return $(`\n        <input type="${e.type}" class="form-control ${e.class}" id="${e.id}" placeholder="${e.placeholder}" value="${e.value}" ${e.disabled} ${e.readonly} ${e.required}>\n    `)},saltos.__form_field.hidden=function(e){return e.type="hidden",saltos.__form_field.text(e)},saltos.__form_field.integer=function(e){e.type="text";var a=saltos.__form_field.text(e),t=$(a).get(0);return IMask(t,{mask:Number,signed:!0,scale:0}),a},saltos.__form_field.float=function(e){e.type="text";var a=saltos.__form_field.text(e),t=$(a).get(0);return IMask(t,{mask:Number,signed:!0,radix:".",mapToRadix:[","],scale:99}),a},saltos.__form_field.color=function(e){return e.class="form-control-color",saltos.__form_field.text(e)},saltos.__form_field.date=function(e){return saltos.__form_field.text(e)},saltos.__form_field.time=function(e){return saltos.__form_field.text(e)},saltos.__form_field.datetime=function(e){return e.type="datetime-local",saltos.__form_field.text(e)},saltos.__form_field.__textarea=function(e){return saltos.check_params(e,["rows"]),$(`\n        <textarea class="form-control ${e.class}" id="${e.id}" placeholder="${e.placeholder}" rows="${e.rows}" ${e.disabled} ${e.readonly} ${e.required}>${e.value}</textarea>\n    `)},saltos.__form_field.textarea=function(e){var a=saltos.__form_field.__textarea(e),t=$(a).get(0);return saltos.when_visible(t,(function(e){$(e).autogrow()}),t),a},saltos.__form_field.ckeditor=function(e){var a=saltos.__form_field.__textarea(e),t=$(a).get(0);return saltos.when_visible(t,(function(e){ClassicEditor.create(e).catch((e=>{console.error(e)}))}),t),a},saltos.__form_field.codemirror=function(e){saltos.check_params(e,["mode"]);var a=saltos.__form_field.__textarea(e),t=$(a).get(0);return saltos.when_visible(t,(function(a){var t=CodeMirror.fromTextArea(a,{mode:e.mode,styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0});$(a).next().addClass("form-control").height("auto"),t.on("change",t.save)}),t),a},saltos.__form_field.iframe=function(e){return saltos.check_params(e,["height"]),$(`\n        <iframe src="${e.value}" id="${e.id}" frameborder="0" class="form-control ${e.class}" style="height:${e.height}"></iframe>\n    `)},saltos.__form_field.select=function(e){saltos.check_params(e,["rows","multiple","size"]),""!=e.multiple&&(e.multiple="multiple"),""!=e.size&&(e.size=`size="${e.size}"`);var a=$(`\n        <select class="form-select ${e.class}" id="${e.id}" ${e.disabled} ${e.required} ${e.multiple} ${e.size}></select>\n    `);for(var t in e.rows){var s=e.rows[t],o="";e.value.toString()==s.value.toString()&&(o="selected"),$(a).append(`<option value="${s.value}" ${o}>${s.label}</option>`)}return a},saltos.__form_field.multiselect=function(e){saltos.check_params(e,["rows","size"]);var a=$('\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col px-0">\n                </div>\n                <div class="col col-auto my-auto">\n                </div>\n                <div class="col px-0">\n                </div>\n            </div>\n        </div>\n    '),t=[],s=[],o=e.value.split(",");for(var r in e.rows){var i=e.rows[r];o.includes(i.value.toString())?s.push(i):t.push(i)}return $(".col:eq(0)",a).append(saltos.__form_field.hidden(e)),$(".col:eq(0)",a).append(saltos.__form_field.select({class:e.class,id:e.id+"_a",disabled:e.disabled,multiple:!0,size:e.size,rows:t,value:""})),$(".col:eq(1)",a).append(saltos.__form_field.button({class:"btn-primary bi-chevron-double-right mb-3",id:e.id+"_c",disabled:e.disabled,value:"",onclick:function(){$("#"+e.id+"_a option:selected").each((function(){$("#"+e.id+"_b").append(this)}));var a=[];$("#campo19_b option").each((function(){a.push($(this).val())})),$("#"+e.id).val(a.join(","))}})),$(".col:eq(1)",a).append("<br/>"),$(".col:eq(1)",a).append(saltos.__form_field.button({class:"btn-primary bi-chevron-double-left",id:e.id+"_d",disabled:e.disabled,value:"",onclick:function(){$("#"+e.id+"_b option:selected").each((function(){$("#"+e.id+"_a").append(this)}));var a=[];$("#campo19_b option").each((function(){a.push($(this).val())})),$("#"+e.id).val(a.join(","))}})),$(".col:eq(2)",a).append(saltos.__form_field.select({class:e.class,id:e.id+"_b",disabled:e.disabled,multiple:!0,size:e.size,rows:s,value:""})),a},saltos.__form_field.checkbox=function(e){e.value=parseInt(e.value),isNaN(e.value)&&(e.value=0);var a="";e.value&&(a="checked");var t="",s="";"switch"==e.type&&(t="form-switch",s='role="switch"');var o=$(`\n        <div class="form-check ${t}">\n            <input class="form-check-input" type="checkbox" ${s} id="${e.id}" value="${e.value}" ${e.disabled} ${e.readonly} ${a}>\n            <label class="form-check-label" for="${e.id}">${e.label}</label>\n        </div>\n    `);return $("input",o).on("change",(function(){this.value=this.checked?1:0})),o},saltos.__form_field.switch=function(e){return saltos.__form_field.checkbox(e)},saltos.__form_field.button=function(e){saltos.check_params(e,["onclick"]);var a=$(`<button type="button" class="btn ${e.class}" id="${e.id}" ${e.disabled}>${e.value}</button>`);return $(a).on("click",e.onclick),a},saltos.__form_field.password=function(e){var a=$(`\n        <div class="input-group">\n            <input type="password" class="form-control ${e.class}" id="${e.id}" placeholder="${e.placeholder}" value="${e.value}" ${e.disabled} ${e.readonly} ${e.required} aria-label="${e.placeholder}" aria-describedby="${e.id}_b">\n            <button class="btn btn-outline-secondary bi-eye-slash" type="button" id="${e.id}_b"></button>\n        </div>\n    `);return $("button",a).on("click",(function(){var e=$(this).prev().get(0);"password"==e.type?(e.type="text",$(this).removeClass("bi-eye-slash").addClass("bi-eye")):"text"==e.type&&(e.type="password",$(this).removeClass("bi-eye").addClass("bi-eye-slash"))})),a},saltos.__form_field.file=function(e){saltos.check_params(e,["multiple"]),""!=e.multiple&&(e.multiple="multiple");var a=$(`<div>\n        <input type="file" class="form-control ${e.class}" id="${e.id}" ${e.disabled} ${e.required} ${e.multiple}>\n        <table class="table table-striped table-hover d-none">\n            <tbody>\n            </tbody>\n        </table>\n    </div>`),t=function(e){var a=[],t=$(e).next();$("tr",t).each((function(){a.push($(this).data("data"))})),$(e).data("data",a)};return $("input",a).on("change",(async function(){for(var e=this,a=this.files,s=$(this).next(),o=0;o<a.length;o++){var r={action:"addfiles",files:[]};r.files[0]={id:saltos.uniqid(),name:a[o].name,size:a[o].size,type:a[o].type,data:"",error:"",file:"",hash:""},$(s).removeClass("d-none");var i=$(`\n                <tr id="${r.files[0].id}">\n                    <td>${r.files[0].name}</td>\n                    <td class="w-25 align-middle">\n                        <div class="progress">\n                            <div class="progress-bar" role="progressbar" aria-label="Example with label" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>\n                        </div>\n                    </td>\n                    <td class="p-0" style="width: 1%"><button class="btn bi-trash" type="button"></button></td>\n                </tr>\n            `);$(i).data("data",r.files[0]),$("button",i).on("click",(function(){var a=$(this).parent().parent(),o={action:"delfiles",files:[]};o.files[0]=a.data("data"),$.ajax({url:"index.php",data:JSON.stringify(o),type:"post",success:function(o,r,i){$(a).data("data",o[0]),""==o[0].file&&a.remove(),0==$("tr",s).length&&$(s).addClass("d-none"),t(e)},error:function(e,a,t){console.log(e.statusText)}})})),$("tbody",s).append(i),t(e);var l=new FileReader;for(l.readAsDataURL(a[o]);!l.result&&!l.error;)await new Promise((e=>setTimeout(e,1)));l.result&&(r.files[0].data=l.result,function(a,s){$.ajax({url:"index.php",data:JSON.stringify(a),type:"post",success:function(a,o,r){$(s).data("data",a[0]),t(e)},error:function(e,a,t){console.log(e.statusText)},progress:function(e){if(e.lengthComputable){var a=parseInt(e.loaded/e.total*100);$(".progress-bar",s).width(a+"%").attr("aria-valuenow",a)}}})}(r,i)),l.error&&(r.files[0].error=l.error.message,console.log(l.error.message))}})),a},saltos.__form_field.link=function(e){return e.class="btn-link",saltos.__form_field.button(e)},saltos.__form_field.label=function(e){return $(`<label for="${e.id}" class="form-label">${e.label}</label>`)},saltos.__form_field.image=function(e){return saltos.check_params(e,["alt"]),$(`\n        <img id="${e.id}" src="${e.value}" class="img-fluid ${e.class}" alt="${e.alt}">\n    `)},saltos.__form_field.excel=function(e){saltos.check_params(e,["data","rowHeaders","colHeaders","minSpareRows","contextMenu","rowHeaderWidth","colWidths"]);var a=$(`<div style="width:100%;height:100%;overflow:auto">\n        <div id="${e.id}" class="${e.class}"></div>\n    </div>`);""==e.data&&(e.data=[...Array(20)].map((e=>Array(26)))),""==e.rowHeaders&&(e.rowHeaders=!0),""==e.colHeaders&&(e.colHeaders=!0),""==e.minSpareRows&&(e.minSpareRows=0),""==e.contextMenu&&(e.contextMenu=!0),""==e.rowHeaderWidth&&(e.rowHeaderWidth=void 0),""==e.colWidths&&(e.colWidths=void 0);var t=$("div",a).get(0);return saltos.when_visible(t,(function(a){$(a).handsontable({data:e.data,rowHeaders:e.rowHeaders,colHeaders:e.colHeaders,minSpareRows:e.minSpareRows,contextMenu:e.contextMenu,rowHeaderWidth:e.rowHeaderWidth,colWidths:e.colWidths,afterChange:function(t,s){$(a).data("data",e.data)}})}),t),a},saltos.__form_field.pdfjs=function(e){var a=$(`\n        <div id="${e.id}" class="${e.class}"><div class="pdfViewer"></div></div>\n    `),t=$(a).get(0);return saltos.when_visible(t,(function(a){pdfjsLib.GlobalWorkerOptions.workerSrc="lib/pdfjs/pdf.worker.min.js",pdfjsLib.getDocument(e.value).promise.then((function(e){if(e.numPages){$(a).css("position","absolute");var t=a,s=new pdfjsViewer.EventBus,o=new pdfjsViewer.PDFViewer({container:t,eventBus:s});s.on("pagesinit",(function(){o.currentScaleValue="page-width"})),s.on("annotationlayerrendered",(function(){$("a",t).each((function(){$(this).attr("target","_blank")}))})),o.removePageBorders=!0,o.setDocument(e),$(a).css("position","relative"),$(window).on("resize",(function(){o.currentScaleValue=2*o.currentScale,o.currentScaleValue="page-width"}))}}),(function(e,a){console.log(e)}))}),t),a},saltos.__form_field.table=function(e){saltos.check_params(e,["header","data","footer","divider"]);var a=$(`\n        <table class="table table-striped table-hover ${e.class}" id="${e.id}">\n        </table>\n    `);if(""!=e.header)for(var t in $(a).append("\n            <thead>\n                <tr>\n                </tr>\n            </thead>\n        "),isset(e.divider[0])&&e.divider[0]&&$("thead",a).addClass("table-group-divider"),e.header)$("thead tr",a).append(`<th>${e.header[t]}</th>`);if(""!=e.data)for(var t in $(a).append("\n            <tbody>\n            </tbody>\n        "),isset(e.divider[1])&&e.divider[1]&&$("tbody",a).addClass("table-group-divider"),e.data){var s=$("<tr></tr>");for(var o in e.data[t])s.append(`<td>${e.data[t][o]}</td>`);$("tbody",a).append(s)}if(""!=e.footer)for(var t in $(a).append("\n            <tfoot>\n                <tr>\n                </tr>\n            </tfoot>\n        "),isset(e.divider[2])&&e.divider[2]&&$("tfoot",a).addClass("table-group-divider"),e.footer)$("tfoot tr",a).append(`<td>${e.footer[t]}</td>`);return a},saltos.__form_field.alert=function(e){return $(`\n        <div class="alert ${e.class}" role="alert">${e.value}</div>\n    `)},saltos.__form_field.card=function(e){saltos.check_params(e,["image","alt","header","footer","title","text","body"]);var a=$('\n        <div class="card">\n        </div>\n    ');return""!=e.image&&a.append(`\n            <img src="${e.image}" class="card-img-top" alt="${e.alt}">\n        `),""!=e.header&&a.append(`\n            <div class="card-header">${e.header}</div>\n        `),a.append('\n        <div class="card-body">\n        </div>\n    '),""!=e.title&&$(".card-body",a).append(`\n            <h5 class="card-title">${e.title}</h5>\n        `),""!=e.text&&$(".card-body",a).append(`\n            <p class="card-text">${e.text}</p>\n        `),""!=e.body&&$(".card-body",a).append(`\n            ${e.body}\n        `),""!=e.footer&&a.append(`\n            <div class="card-footer">${e.footer}</div>\n        `),a},saltos.__form_field.navbar=function(e){return $("TODO")},saltos.__form_field.modal=function(e){return $("TODO")},saltos.__form_field.offcanvas=function(e){return $("TODO")},saltos.__form_field.toasts=function(e){return $("TODO")},saltos.__form_field.chartjs=function(e){return $('<canvas id="myChart"></canvas>')};
"use strict";!function(e){saltos.init_error();var a=saltos.form_field({type:"container"}),t=saltos.form_field({type:"row"}),l=["text","integer","float","color","date","time","datetime","hidden","textarea","ckeditor","codemirror","multiselect","label","checkbox","switch","button","password","file","link","select","image","excel","pdfjs","iframe","table","alert","card","chartjs"];for(var o in l){var r=saltos.form_field({type:"col",col:"col-xl-3 col-md-4 col-sm-6 mb-3"}),i=l[o],s="",c="",d="",n="",m="",p="",u="",b="",f="",v="",h="",x="",g="",w="",y="";if("textarea"==i&&(s="Texto de prueba\n\nAdios"),"ckeditor"==i&&(s="Texto de prueba<br/><br/>Adios"),"codemirror"==i&&(s="<xml>\n\t<tag>valor</tag>\n</xml>",p="xml"),"iframe"==i&&(s="img/favicon.svg",b="600px"),"select"==i&&(c=[{label:"Uno",value:1},{label:"Dos",value:2},{label:"Tres",value:3}],s="2"),"multiselect"==i&&(c=[{label:"Uno",value:1},{label:"Dos",value:2},{label:"Tres",value:3},{label:"Cuatro",value:4},{label:"Cinco",value:5},{label:"Seis",value:6}],s="2,3,5"),"button"==i&&(d="btn-primary",s="Button text here"),"multiselect"==i&&(n=5),"button"==i&&(m=function(){alert("button onclick")}),"link"==i&&(s="https://www.saltos.org/portal/es/estadisticas",m=function(){window.open("https://www.saltos.org/portal/es/estadisticas")}),"file"==i&&(u=!0),"image"==i&&(s="img/favicon.svg"),"pdfjs"==i&&(s="data/files/test-josep-1.pdf"),"table"==i)f=[["Josep","Sanz",'<a href="#">654 123 789</a>'],["Jordi","Company","654 123 789"],["Andres","Diaz","654 123 789"],["Montse","Casc","654 123 789"],["Jordi","Sanz","654 123 789"]],v=["Name","Surname","Phone"],h=["","Total","3"],x=[!1,!0,!0];"alert"==i&&(d="alert-success",s="The alert message!!!"),"card"==i&&(v="Cabecera",h="Pie",g="Titulo",w="Texto del card",y='<a href="#">hola</a>');var T=saltos.form_field({type:i,id:"campo"+o,label:"Campo "+o+" ("+i+")",placeholder:"Escriba aqui",value:s,mode:p,size:n,rows:c,class:d,onclick:m,multiple:u,height:b,data:f,header:v,footer:h,divider:x,image:"",title:g,text:w,body:y});e(r).append(T),e(t).append(r)}a.append(t),e("body").append(a)}(jQuery);
