saltos.invoices={},saltos.invoices.init=e=>{if(["edit"].includes(e))for(var t in saltos.backup.__forms)for(var s in saltos.backup.__forms[t].fields){const n=saltos.backup.__forms[t].fields[s];["lines","taxes","totals"].includes(n.id)&&(n.data=[])}},saltos.invoices.colWidths_lines=e=>{if(0!=e)return 100;{const t=document.getElementById("lines").parentElement.offsetWidth-2;return Math.floor(t-500)}},saltos.invoices.cells_lines=(e,t,s)=>4==t?{type:"dropdown",source:document.getElementById("alltaxes").data.map(e=>e.value)}:5==t?{readOnly:!0}:{},saltos.invoices.colWidths_taxes=e=>{if(0!=e)return 100;{const t=document.getElementById("taxes").parentElement.offsetWidth-2;return Math.floor(t-200)}},saltos.invoices.cells_taxes=(e,t,s)=>({readOnly:!0}),saltos.invoices.colWidths_totals=e=>{const t=document.getElementById("taxes").parentElement.offsetWidth-2;return Math.floor(t/3)},saltos.invoices.cells_totals=(e,t,s)=>({readOnly:!0}),saltos.invoices.afterChange_lines=(e,t)=>{if("loadData"!=t){const i=document.getElementById("lines").data;for(var s in i){const u=i[s];saltos.core.is_number(u[1])?(u[1]=parseFloat(u[1]),saltos.core.is_number(u[2])?(u[2]=parseFloat(u[2]),saltos.core.is_number(u[3])||(u[3]=0),u[3]=parseFloat(u[3]),u[5]=u[1]*u[2]*(1-u[3]/100),u[5]=Math.round(100*u[5])/100):u[5]=null):u[5]=null}document.getElementById("lines").excel.updateSettings({});const r={},c=document.getElementById("alltaxes").data;for(var n in i){const m=i[n],f=m[4];if(saltos.core.is_number(f)){const v=m[5];if(saltos.core.is_number(v)){if(!(f in r)){const h=c.find(e=>e.value==f);if(!h)continue;r[f]=[h.name,0,0]}r[f][1]+=v}}}for(var o in r)r[o][2]=r[o][1]*o/100;for(var l in r)r[l][1]=Math.round(100*r[l][1])/100,r[l][2]=Math.round(100*r[l][2])/100;Object.keys(r).length?document.getElementById("taxes").set(Object.values(r)):document.getElementById("taxes").set([[null,null,null]]);const d=[0,0,0];for(var a in r)d[0]+=r[a][1],d[1]+=r[a][2];d[2]=d[0]+d[1],d[0]=Math.round(100*d[0])/100,d[1]=Math.round(100*d[1])/100,d[2]=Math.round(100*d[2])/100,Object.keys(r).length?document.getElementById("totals").set([d]):document.getElementById("totals").set([[null,null,null]])}};
//# sourceMappingURL=invoices.min.js.map